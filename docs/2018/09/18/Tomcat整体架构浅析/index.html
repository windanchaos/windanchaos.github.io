<!DOCTYPE html><html lang="zh"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>Tomcatæ•´ä½“æ¶æ„æµ…æ | Hexo</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Tomcatæ•´ä½“æ¶æ„æµ…æ</h1><a id="logo" href="/.">Hexo</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/me.html"><i class="fa fa-user"> Ãœber</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Tomcatæ•´ä½“æ¶æ„æµ…æ</h1><div class="post-meta">2018-09-18<span> | </span><span class="category"><a href="/categories/%E5%90%8E%E7%AB%AF%E6%A1%86%E6%9E%B6%E5%92%8C%E6%8A%80%E6%9C%AF/">åç«¯æ¡†æ¶å’ŒæŠ€æœ¯</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a class="disqus-comment-count" href="/2018/09/18/Tomcat%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E6%B5%85%E6%9E%90/#vcomment"><span class="valine-comment-count" data-xid="/2018/09/18/Tomcat%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E6%B5%85%E6%9E%90/"></span><span> Comment</span></a><div class="post-content"><p>è½¬è‡ªï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/cx520forever/article/details/52743166">https://blog.csdn.net/cx520forever/article/details/52743166</a><br>tomcatè¯¦è§£æ­é…ç€çœ‹ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/kismetv/p/7228274.html">https://www.cnblogs.com/kismetv/p/7228274.html</a></p>
<p>commentï¼šæœ¬æ–‡åŸºäºTomcat7.0.68</p>
<h1 id="1-æ•´ä½“ç»“æ„"><a href="#1-æ•´ä½“ç»“æ„" class="headerlink" title="1.æ•´ä½“ç»“æ„"></a>1.æ•´ä½“ç»“æ„</h1><p>æ¶æ„å›¾ï¼š<br><img src="/images/.net-uploads-201206-05-1338887929_7279.JPG.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<h2 id="1-1å„ç»„ä»¶è§£é‡Šï¼š"><a href="#1-1å„ç»„ä»¶è§£é‡Šï¼š" class="headerlink" title="1.1å„ç»„ä»¶è§£é‡Šï¼š"></a>1.1å„ç»„ä»¶è§£é‡Šï¼š</h2><p>ä»é¡¶å±‚å¼€å§‹ï¼š</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸éœ€è¦é…ç½®å¤šä¸ªService,conf&#x2F;server.xmlé»˜è®¤é…ç½®äº†ä¸€ä¸ªâ€œCatalinaâ€çš„</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Service</span>&gt;</span><br></pre></td></tr></table></figure>
<p>ã€‚<br><strong>Tomcatå°†Engineï¼ŒHostï¼ŒContextï¼ŒWrapperç»Ÿä¸€æŠ½è±¡æˆContainerã€‚</strong><br>Connectoræ¥å—åˆ°è¯·æ±‚åï¼Œä¼šå°†è¯·æ±‚äº¤ç»™Containerï¼ŒContainerå¤„ç†å®Œäº†ä¹‹åå°†ç»“æœè¿”å›ç»™Connector<br>ä¸‹é¢çœ‹Containerçš„ç»“æ„ï¼š<br><img src="/images/nblogs.com-blog-665375-201601-665375-20160119184849437-2014392220-.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p><img src="/images/-upload-picture-pic-124649-3f5d0ac0-1c40-3c78-9bed-e990f41e3b84.jpg.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"><br>Standard&#x2F;*XXXX&#x2F;*æ˜¯ç»„ä»¶æ¥å£çš„é»˜è®¤å®ç°ç±»ã€‚</p>
<p>Tomcat è¿˜æœ‰å…¶å®ƒç»„ä»¶ï¼Œå¦‚å®‰å…¨ç»„ä»¶ securityã€loggerã€sessionã€naming ç­‰å…¶å®ƒç»„ä»¶ã€‚è¿™äº›ç»„ä»¶å…±åŒä¸º Connector å’Œ Container æä¾›å¿…è¦çš„æœåŠ¡ã€‚</p>
<h2 id="1-2ç»„ä»¶çš„ç”Ÿå‘½çº¿Lifecycle"><a href="#1-2ç»„ä»¶çš„ç”Ÿå‘½çº¿Lifecycle" class="headerlink" title="1.2ç»„ä»¶çš„ç”Ÿå‘½çº¿Lifecycle"></a>1.2ç»„ä»¶çš„ç”Ÿå‘½çº¿Lifecycle</h2><p>Tomcatä¸­å¾ˆå¤šç»„ä»¶å…·æœ‰ç”Ÿå‘½å‘¨æœŸ,å¦‚åˆå§‹åŒ–ã€å¯åŠ¨ã€å…³é—­ï¼Œè¿™äº›ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå…·æœ‰å…±æ€§ï¼Œå› æ­¤Tomcatä¸­å°†å…¶æŠ½è±¡ä¸ºæ¥å£Lifecycleï¼Œæ¥æ§åˆ¶ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒé€šè¿‡ <strong>äº‹ä»¶æœºåˆ¶</strong> å®ç°å„ä¸ªå®¹å™¨é—´çš„å†…éƒ¨é€šè®¯ã€‚<br>Lifecycleæ¥å£çš„æ–¹æ³•ï¼š<br><img src="/images/dn.net-20161006125439657.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"><br>ç»§æ‰¿å…³ç³»å›¾ï¼š<br><img src="/images/dn.net-20161006124601442.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<span id="more"></span>
<p>StandardServerï¼ŒStandardServiceï¼ŒConnectorå’Œä¸Šé¢4ä¸ªå®¹å™¨ç­‰å¾ˆå¤šç»„ä»¶éƒ½å®ç°äº†Lifecycleï¼Œç»„ä»¶å®ç°è¿™ä¸ªæ¥å£å°±å¯ä»¥ç»Ÿä¸€è¢«æ‹¥æœ‰å®ƒçš„ç»„ä»¶æ§åˆ¶äº†ï¼Œè¿™æ ·ä¸€å±‚ä¸€å±‚çš„ç›´åˆ°ä¸€ä¸ª <strong>æœ€é«˜çº§çš„ç»„ä»¶</strong> å°±å¯ä»¥æ§åˆ¶ Tomcat ä¸­æ‰€æœ‰ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™ä¸ªæœ€é«˜çš„ç»„ä»¶å°±æ˜¯ **</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Server</span></span><br></pre></td></tr></table></figure>
<p>**ã€‚</p>
<h1 id="2-å¯åŠ¨æµç¨‹"><a href="#2-å¯åŠ¨æµç¨‹" class="headerlink" title="2.å¯åŠ¨æµç¨‹"></a>2.å¯åŠ¨æµç¨‹</h1><p>åœ¨binç›®å½•ä¸‹æ‰§è¡Œäº†.&#x2F;startup.sh æˆ–è€…æ‰§è¡Œ .&#x2F;catalina.bat startå‘½ä»¤æ—¶,å®é™…è°ƒç”¨äº†Bootstrapå¯åŠ¨ç±»çš„mainæ–¹æ³•ï¼Œå¹¶ä¼ é€’äº†startå‚æ•°ã€‚<br>Bootstrap&#x2F;#mainæ–¹æ³•çš„å¯åŠ¨æµç¨‹ï¼š<br>å‚è€ƒ<a target="_blank" rel="noopener" href="http://blog.csdn.net/Zerohuan/article/details/50752635#t6">http://blog.csdn.net/Zerohuan/article/details/50752635/#t6</a><br>é™„ä¸Šåˆ«äººæ€»ç»“çš„ä¸€å¼ å¯åŠ¨æ—¶åºå›¾ï¼š<br><img src="/images/dn.net-20150327153152547-watermark-2-text-aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYzkyOTgzMzYyM2x2Y2hh-font-5a6L5L2T-fontsize-400-fill-I0JBQkFCMA==-dissolve-70-gravity-Center.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"><br>è¡¥å……å¦‚ä¸‹ï¼š</p>
<ul>
<li>å…³äºConnectoråˆå§‹åŒ–å’Œå¯åŠ¨çš„æ›´å¤šç»†èŠ‚ï¼Œå¯å‚è€ƒæœ¬äººå¦ä¸€ç¯‡blog <a target="_blank" rel="noopener" href="http://blog.csdn.net/cx520forever/article/details/52198050">http://blog.csdn.net/cx520forever/article/details/52198050</a></li>
</ul>
<h1 id="3-pipeline-valveæœºåˆ¶"><a href="#3-pipeline-valveæœºåˆ¶" class="headerlink" title="3.pipeline valveæœºåˆ¶"></a>3.pipeline valveæœºåˆ¶</h1><h2 id="3-1åè¯è§£é‡Š"><a href="#3-1åè¯è§£é‡Š" class="headerlink" title="3.1åè¯è§£é‡Š"></a>3.1åè¯è§£é‡Š</h2><h2 id="3-2æ€»ä½“åˆ†æ"><a href="#3-2æ€»ä½“åˆ†æ" class="headerlink" title="3.2æ€»ä½“åˆ†æ"></a>3.2æ€»ä½“åˆ†æ</h2><p>å››ä¸ªåŸºæœ¬å®¹å™¨å¯¹è±¡é‡Œé¢éƒ½æœ‰ä¸€ä¸ªpipelineåŠvalveæ¨¡å—ï¼Œæ˜¯å®¹å™¨ç±»å¿…é¡»å…·æœ‰çš„æ¨¡å—ï¼Œå¯¹è±¡ç”Ÿæˆæ—¶setè¯¥å±æ€§ã€‚Pipelineå°±åƒæ˜¯æ¯ä¸ªå®¹å™¨çš„é€»è¾‘æ€»çº¿ã€‚åœ¨pipelineä¸ŠæŒ‰ç…§é…ç½®çš„é¡ºåºï¼ŒåŠ è½½å„ä¸ªvalveã€‚é€šè¿‡pipelineå®Œæˆå„ä¸ªvalveä¹‹é—´çš„è°ƒç”¨ï¼Œå„ä¸ªvalveå®ç°å…·ä½“çš„åº”ç”¨é€»è¾‘ã€‚<br>tomcatç»„ä»¶å›¾ï¼š<br><img src="/images/dn.net-20161006212818345.png" alt="tomcatç»„ä»¶å›¾"><br>ä»ä¸Šå›¾ä¸­çœ‹åˆ°ï¼Œåœ¨Connectoræ¥æ”¶åˆ°ä¸€æ¬¡è¿æ¥å¹¶è½¬åŒ–æˆHttpServletRequestè¯·æ±‚å¯¹è±¡åï¼Œ<strong>è¯·æ±‚ä¼ é€’å¦‚ä¸‹</strong>ï¼š<br>Connectorâ€“&gt;Engineçš„Pipelineçš„ValveAä¸­â€“&gt;Engine Valveâ€“&gt;Host Pipelineçš„Error Report Valveå’ŒHost Valueâ€“&gt;Context Valveâ€“&gt;Wrapper Valveä¸­ï¼Œåœ¨è¿™é‡Œä¼šç»è¿‡ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼ˆFilter Chainï¼‰â€“&gt;Servletä¸­ã€‚<br>Servletå¤„ç†å®Œæˆåä¸€æ­¥æ­¥è¿”å›ï¼Œæœ€åConnectoræ‹¿åˆ°responseã€‚</p>
<h2 id="3-3æ¥å£åŠé»˜è®¤å®ç°"><a href="#3-3æ¥å£åŠé»˜è®¤å®ç°" class="headerlink" title="3.3æ¥å£åŠé»˜è®¤å®ç°"></a>3.3æ¥å£åŠé»˜è®¤å®ç°</h2><p>æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•:<br><img src="/images/dn.net-20161007001421097.png" alt="æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•"><br>ä¸€ä¸ªpipelineåŒ…å«å¤šä¸ªValveï¼Œè¿™äº›é˜€å…±åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»å«åŸºç¡€é˜€ï¼ˆé€šè¿‡getBasicã€setBasicæ–¹æ³•è°ƒç”¨ï¼‰ï¼Œä¸€ç±»æ˜¯æ™®é€šé˜€ï¼ˆé€šè¿‡addValveã€removeValveè°ƒç”¨ï¼‰ã€‚ç®¡é“éƒ½æ˜¯åŒ…å«åœ¨å®¹å™¨ä¸­ï¼Œæ‰€ä»¥æœ‰getContainerå’ŒsetContaineræ–¹æ³•ã€‚ä¸€ä¸ªç®¡é“ä¸€èˆ¬æœ‰ä¸€ä¸ªåŸºç¡€é˜€ï¼ˆé€šè¿‡setBasicæ·»åŠ ï¼‰ï¼Œå¯ä»¥æœ‰0åˆ°å¤šä¸ªæ™®é€šé˜€ï¼ˆé€šè¿‡addValveæ·»åŠ ï¼‰ã€‚<br>isAsyncSupportedï¼šå½“ç®¡é“ä¸­çš„æ‰€æœ‰é˜€é—¨éƒ½æ”¯æŒå¼‚æ­¥æ—¶è¿”å›tureï¼Œå¦åˆ™è¿”å›false<br>è¯¥æ¥å£çš„æ ‡å‡†å®ç°æ˜¯ï¼š**</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.<span class="property">apache</span>.<span class="property">catalina</span>.<span class="property">core</span>.<span class="property">StandardPipeline</span></span><br></pre></td></tr></table></figure>
<p>**<br>Engineã€Hostã€ContextåŠWrapperçš„pipelineå±æ€§éƒ½ç»§æ‰¿è‡ªçˆ¶ç±»ContainerBaseã€‚</p>
<p>æ¥å£æ–¹æ³•:<br><img src="/images/dn.net-20161007002724932.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"><br>é‡ç‚¹å…³æ³¨setNextã€getNextã€invokeè¿™ä¸‰ä¸ªæ–¹æ³•ï¼Œé€šè¿‡setNextè®¾ç½®è¯¥é˜€çš„ä¸‹ä¸€é˜€ï¼Œé€šè¿‡getNextè¿”å›è¯¥é˜€çš„ä¸‹ä¸€ä¸ªé˜€çš„å¼•ç”¨ï¼Œinvokeæ–¹æ³•åˆ™æ‰§è¡Œè¯¥é˜€å†…éƒ¨è‡ªå®šä¹‰çš„è¯·æ±‚å¤„ç†ä»£ç ã€‚<br>ValveBaseï¼šæ˜¯Valveæ¥å£çš„åŸºæœ¬å®ç°<br>å››å¤§å®¹å™¨ç±»réƒ½æœ‰å„è‡ªç¼ºçœçš„æ ‡å‡†valveå®ç°ã€‚å®ƒä»¬åˆ†åˆ«æ˜¯</p>
<p><img src="/images/dn.net-20161007003208809.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>Valveå®ç°äº†å…·ä½“ä¸šåŠ¡é€»è¾‘å•å…ƒã€‚å¯ä»¥å®šåˆ¶åŒ–valveï¼ˆå®ç°ç‰¹å®šæ¥å£ï¼‰ï¼Œç„¶åé…ç½®åœ¨server.xmlé‡Œã€‚æ¯å±‚å®¹å™¨éƒ½å¯ä»¥é…ç½®ç›¸åº”çš„valveï¼Œå½“åªåœ¨å…¶ä½œç”¨åŸŸå†…æœ‰æ•ˆã€‚ä¾‹å¦‚engineå®¹å™¨é‡Œçš„valveåªå¯¹å…¶åŒ…å«çš„æ‰€æœ‰hosté‡Œçš„åº”ç”¨æœ‰æ•ˆã€‚<br>é…ç½®ä¸¾ä¾‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Engine</span> name=<span class="string">&quot;Catalina&quot;</span> defaultHost=<span class="string">&quot;localhost&quot;</span>&gt;  </span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;MyValve0&quot;</span>/&gt;</span></span>  </span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;MyValve1&quot;</span>/&gt;</span></span>  </span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;MyValve2&quot;</span>/&gt;</span></span>  </span><br><span class="line">   â€¦â€¦  </span><br><span class="line">  &lt;<span class="title class_">Host</span> name=<span class="string">&quot;localhost&quot;</span>  appBase=<span class="string">&quot;webapps&quot;</span>&gt;  </span><br><span class="line">  &lt;/<span class="title class_">Host</span>&gt;  </span><br><span class="line">&lt;/<span class="title class_">Engine</span>&gt;</span><br></pre></td></tr></table></figure>

<p>å½“åœ¨server.xmlæ–‡ä»¶ä¸­é…ç½®äº†ä¸€ä¸ªå®šåˆ¶åŒ–valveæ—¶ï¼Œä¼šè°ƒç”¨pipelineå¯¹è±¡çš„addValveæ–¹æ³•ï¼Œå°†valveä»¥é“¾è¡¨æ–¹å¼ç»„ç»‡èµ·æ¥ï¼Œä»£ç å¦‚ä¸‹;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title class_">Override</span></span><br><span class="line">    public <span class="keyword">void</span> <span class="title function_">addValve</span>(<span class="params">Valve valve</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Validate that we can add this Valve</span></span><br><span class="line">        <span class="keyword">if</span> (valve <span class="keyword">instanceof</span> <span class="title class_">Contained</span>)</span><br><span class="line">            ((<span class="title class_">Contained</span>) valve).<span class="title function_">setContainer</span>(<span class="variable language_">this</span>.<span class="property">container</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Start the new component if necessary</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">getState</span>().<span class="title function_">isAvailable</span>()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (valve <span class="keyword">instanceof</span> <span class="title class_">Lifecycle</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ((<span class="title class_">Lifecycle</span>) valve).<span class="title function_">start</span>();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (<span class="title class_">LifecycleException</span> e) &#123;</span><br><span class="line">                    log.<span class="title function_">error</span>(<span class="string">&quot;StandardPipeline.addValve: start: &quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add this Valve to the set associated with this Pipeline</span></span><br><span class="line">        <span class="comment">//å°†é…ç½®çš„valveæ·»åŠ åˆ°é“¾è¡¨ä¸­ï¼Œå¹¶ä¸”æ¯ä¸ªå®¹å™¨çš„æ ‡å‡†valveåœ¨é“¾è¡¨çš„å°¾ç«¯ </span></span><br><span class="line">        <span class="keyword">if</span> (first == <span class="literal">null</span>) &#123;</span><br><span class="line">            first = valve;</span><br><span class="line">            valve.<span class="title function_">setNext</span>(basic);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title class_">Valve</span> current = first;</span><br><span class="line">            <span class="keyword">while</span> (current != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (current.<span class="title function_">getNext</span>() == basic) &#123;</span><br><span class="line">                    current.<span class="title function_">setNext</span>(valve);</span><br><span class="line">                    valve.<span class="title function_">setNext</span>(basic);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                current = current.<span class="title function_">getNext</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        container.<span class="title function_">fireContainerEvent</span>(<span class="title class_">Container</span>.<span class="property">ADD_VALVE_EVENT</span>, valve);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>valveæŒ‰ç…§å®¹å™¨ä½œç”¨åŸŸçš„é…ç½®é¡ºåºæ¥ç»„ç»‡valveï¼Œæ¯ä¸ªvalveéƒ½è®¾ç½®äº†æŒ‡å‘ä¸‹ä¸€ä¸ªvalveçš„nextå¼•ç”¨ã€‚åŒæ—¶ï¼Œæ¯ä¸ªå®¹å™¨ç¼ºçœçš„æ ‡å‡†valveéƒ½å­˜åœ¨äºvalveé“¾è¡¨å°¾ç«¯ï¼Œæœ€åè¢«è°ƒç”¨ã€‚<br>Pipelineå†…éƒ¨ç»´æŠ¤firstå’Œbasicä¸¤ä¸ªé˜€ï¼Œå…¶å®ƒç›¸å…³é˜€é€šè¿‡getNextæ¥è·å–ã€‚</p>
<p><strong>æ ‡å‡†valveçš„è°ƒç”¨é€»è¾‘å›¾ï¼š</strong><br><img src="/images/dn.net-20161007004829253.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"><br>ä»StandardEngineValveå¼€å§‹ï¼Œ **æ‰€æœ‰çš„åŸºç¡€é˜€çš„å®ç°æœ€åéƒ½ä¼šè°ƒç”¨å…¶ä¸‹ä¸€çº§å®¹å™¨ï¼Œæ‰€æœ‰çš„æ™®é€šé˜€éƒ½ä¼šæ‰§è¡Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getNext</span>().<span class="title function_">invoke</span>(request, response);</span><br></pre></td></tr></table></figure>
<p>**ï¼Œä¸€ç›´åˆ°StandardWrapperValveï¼Œå®Œæˆè¯·æ±‚å¤„ç†è¿‡ç¨‹ã€‚å› ä¸ºWrapperæ˜¯å¯¹ä¸€ä¸ªServletçš„åŒ…è£…ï¼Œæ‰€ä»¥å®ƒçš„åŸºç¡€é˜€å†…éƒ¨è°ƒç”¨çš„è¿‡æ»¤å™¨é“¾çš„doFilteræ–¹æ³•å’ŒServletçš„serviceæ–¹æ³•ã€‚<br>ä¸Šè¿°æœºåˆ¶ä¿è¯äº†è¯·æ±‚ä¼ é€’åˆ°servletå»å¤„ç†ã€‚</p>
<p>å½“é‡‡ç”¨tomcaté»˜è®¤åˆå§‹é…ç½®æ—¶ï¼ŒValveé“¾å¦‚ä¸‹ï¼š<br><img src="/images/dn.net-20161007005430411.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"><br>è¿™äº›é˜€é—¨Valveé€šè¿‡invokeæ–¹æ³•å½¼æ­¤ä¸²è”èµ·æ¥ï¼Œæœ€ç»ˆæ„æˆçš„æ‰§è¡Œé¡ºåºååˆ†ç±»ä¼¼äºä¸€ä¸ªç®¡é“ã€‚</p>
<h1 id="4-Tomcatä¸­çš„è®¾è®¡æ¨¡å¼"><a href="#4-Tomcatä¸­çš„è®¾è®¡æ¨¡å¼" class="headerlink" title="4.Tomcatä¸­çš„è®¾è®¡æ¨¡å¼"></a>4.Tomcatä¸­çš„è®¾è®¡æ¨¡å¼</h1><h2 id="4-1æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#4-1æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="4.1æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>4.1æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h2><p><strong>æŠŠé€šç”¨çš„éª¨æ¶æ­¥éª¤æŠ½è±¡åˆ°çˆ¶ç±»ä¸­ï¼Œå­ç±»å»å®ç°ç‰¹å®šçš„æŸäº›æ­¥éª¤ã€‚</strong><br>ä¸¾ä¾‹ï¼š<br>å¦‚LifecycleBaseç±»ä¸­initå’Œstartæ–¹æ³•ï¼Œå…¶ä¸­çš„nitInternalå’ŒstartInternalæ–¹æ³•æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œæ‰€æœ‰å®¹æ˜“éƒ½ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿äº†LifecycleBaseï¼Œåœ¨åˆå§‹åŒ–å’Œå¯åŠ¨æ—¶è¢«æ¯ä¸ªå®¹å™¨ä¼šè°ƒç”¨å…¶initå’Œstartæ–¹æ³•ï¼Œè¿™äº›æŠ½è±¡æ–¹æ³•éƒ½æ˜¯åœ¨å­ç±»ä¸­å®ç°çš„ã€‚</p>
<h2 id="4-2è´£ä»»é“¾æ¨¡å¼"><a href="#4-2è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="4.2è´£ä»»é“¾æ¨¡å¼"></a>4.2è´£ä»»é“¾æ¨¡å¼</h2><h2 id="4-3è§‚å¯Ÿè€…æ¨¡å¼"><a href="#4-3è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="4.3è§‚å¯Ÿè€…æ¨¡å¼"></a>4.3è§‚å¯Ÿè€…æ¨¡å¼</h2><p>Tomcaté€šè¿‡LifecycleListenerå¯¹ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç»„ä»¶Lifecycleè¿›è¡Œç›‘å¬ï¼Œå„ä¸ªç»„ä»¶åœ¨å…¶ç”Ÿå‘½æœŸä¸­ä¼šæœ‰å„ç§è¡Œä¸ºï¼Œè€Œè¿™äº›è¡Œä¸ºéƒ½ä¼šè§¦å‘ç›¸åº”çš„äº‹ä»¶ï¼ŒTomcatå°±æ˜¯é€šè¿‡ä¾¦å¬è¿™äº›äº‹ä»¶è¾¾åˆ°å¯¹è¿™äº›è¡Œä¸ºè¿›è¡Œæ‰©å±•çš„ç›®çš„ã€‚åœ¨çœ‹ç»„ä»¶çš„initå’Œstartè¿‡ç¨‹ä¸­ä¼šçœ‹åˆ°å¤§é‡å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fireLifecycleEvent</span>(<span class="variable constant_">CONFIGURE_START_EVENT</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„ä»£ç ï¼Œè¿™å°±æ˜¯å¯¹æŸä¸€ç±»å‹äº‹ä»¶çš„è§¦å‘ï¼Œå¦‚æœä½ æƒ³åœ¨å…¶ä¸­åŠ å…¥è‡ªå·±çš„è¡Œä¸ºï¼Œå°±åªç”¨æ³¨å†Œç›¸åº”ç±»å‹çš„äº‹ä»¶å³å¯ã€‚</p>
</div><div class="tags"><a href="/tags/FromCSDN"><i class="fa fa-tag">FromCSDN</i></a></div><div class="post-nav"><a class="pre" href="/2018/09/29/crontab%20%E5%9C%A8GUI%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%89%A7%E8%A1%8Cwebdriver/">crontab åœ¨GUIç¯å¢ƒä¸‹æ‰§è¡Œwebdriver</a><a class="next" href="/2018/09/10/%E3%80%90%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80%E3%80%91%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%B8%8E%E6%95%B0%E3%80%81%E5%AD%97/">ã€è®¡ç®—æœºç†è®ºåŸºç¡€ã€‘äºŒè¿›åˆ¶ä¸æ•°ã€å­—</a></div><div id="vcomment"></div><script src="//cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == 'true' ? true : false;
var verify = 'false' == 'true' ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'0indNw0niJU8jN2a1E43bDW7-gzGzoHsz',
  appKey:'toErPcjDI3431WvXQVKoy0rC',
  placeholder:'Just so so',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10'
})
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="https://windanchaos.github.io"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="Ãœber"><img src="/images/avatar.jpeg"/></a><p>ç‰©æœ‰æœ¬æœ«ï¼Œäº‹æœ‰ç»ˆå§‹ã€‚çŸ¥æ‰€å…ˆåï¼Œåˆ™è¿‘é“çŸ£ï¼</p><a class="info-icon" href="https://blog.csdn.net/windanchaos" title="CSDN" target="_blank" style="margin-inline:5px"> <i class="fa fa-CSDN-square" style="margin-inline:5px"></i></a><a class="info-icon" href="mailto:454522630@qq.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/windanchaos" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://gitee.com/windanchaos" title="Gitee" target="_blank" style="margin-inline:5px"> <i class="fa fa-gitee-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">Javaç¼–ç¨‹è¯­è¨€</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/">Linuxç®¡ç†ç»´æŠ¤</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/">MySQLæ•°æ®åº“</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">pythonç¼–ç¨‹è¯­è¨€</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E5%92%8C%E6%8A%80%E6%9C%AF/">å‰ç«¯æ¡†æ¶å’ŒæŠ€æœ¯</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%8E%E7%AB%AF%E6%A1%86%E6%9E%B6%E5%92%8C%E6%8A%80%E6%9C%AF/">åç«¯æ¡†æ¶å’ŒæŠ€æœ¯</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/">æ€§èƒ½æµ‹è¯•</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/">æŒç»­é›†æˆ</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">æ•°æ®ç»“æ„ä¸ç®—æ³•</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%96%B9%E6%B3%95%E4%B8%8E%E7%AE%A1%E7%90%86/">æ–¹æ³•ä¸ç®¡ç†</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E6%96%87/">æ‚æ–‡</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8B%E8%AF%95%E7%9A%84%E6%A1%86%E6%9E%B6%E5%92%8C%E6%8A%80%E6%9C%AF/">æµ‹è¯•çš„æ¡†æ¶å’ŒæŠ€æœ¯</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E5%A4%A7%E6%9D%82%E7%83%A9/">ç”Ÿæ´»å¤§æ‚çƒ©</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%82%A1%E7%A5%A8%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93/">è‚¡ç¥¨é‡åŒ–äº¤æ˜“</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/">è‡ªåŠ¨åŒ–æµ‹è¯•</a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E5%9F%BA%E7%A1%80/">è®¡ç®—æœºç§‘å­¦åŸºç¡€</a><span class="category-list-count">10</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/FromCSDN/" style="font-size: 15px;">FromCSDN</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/10/11/JDK%E4%B8%ADJUC%E5%8C%85%E7%94%B1%E6%B5%85%E5%85%A5%E6%B7%B1%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94atomic%E5%8C%85/">JDKä¸­JUCåŒ…ç”±æµ…å…¥æ·±åŸç†â€”â€”atomicåŒ…</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/06/22/ELF%E5%AD%A6%E4%B9%A0%E4%B8%80/">ELFå­¦ä¹ ä¸€</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/07/SpringBoot%E4%B9%8B%E5%8D%9A%E5%AE%A2%E5%AE%9E%E6%88%98/">SpringBootä¹‹åšå®¢å®æˆ˜</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/17/shell%E4%B8%89%E5%89%91%E5%AE%A2%E5%AE%9E%E6%88%98/">shellä¸‰å‰‘å®¢å®æˆ˜</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/16/mybatis%E5%85%A5%E4%B8%AA%E9%97%A8/">mybatiså…¥ä¸ªé—¨</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/23/SpringBoot%E5%85%A5%E9%97%A8%E7%B3%BB%E5%88%97%E4%B8%80/">SpringBootå…¥é—¨ç³»åˆ—ä¸€</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/23/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%8C/">Javaå¤šçº¿ç¨‹ç¼–ç¨‹æ ¸å¿ƒæŠ€æœ¯è¯»ä¹¦ç¬”è®°äºŒ</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/20/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B8%80/">Javaå¤šçº¿ç¨‹ç¼–ç¨‹æ ¸å¿ƒæŠ€æœ¯è¯»ä¹¦ç¬”è®°ä¸€</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/19/Spring%E6%A1%86%E6%9E%B6%E5%85%A5%E4%B8%AA%E9%97%A8/">Springæ¡†æ¶å…¥ä¸ªé—¨</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/16/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/">javaåŠ¨æ€ä»£ç†</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2022 <a href="/." rel="nofollow">Hexo.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>