<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="docs/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="docs/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="docs/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="docs/images/logo.svg" color="#222">

<link rel="stylesheet" href="docs/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"windanchaos.github.io","root":"docs/","images":"docs/images","scheme":"Mist","darkmode":true,"version":"8.13.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="docs/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://windanchaos.github.io/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale">
<meta property="article:author" content="windanchaos">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://windanchaos.github.io/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo</title>
  






  <noscript>
    <link rel="stylesheet" href="docs/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="docs/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-首页"><a href="docs/" rel="section"><i class="home fa-fw"></i>首页</a></li><li class="menu-item menu-item-分类"><a href="docs/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li><li class="menu-item menu-item-归档"><a href="docs/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-标签"><a href="docs/tags/" rel="section"><i class="tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-关于"><a href="docs/about/me.html" rel="section"><i class="user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="windanchaos"
      src="docs/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">windanchaos</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="docs/archives/">
          <span class="site-state-item-count">111</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="docs/categories/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="docs/tags/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/windanchaos" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;windanchaos" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/windanchaos" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;windanchaos" rel="noopener" target="_blank"><i class="gitee fa-fw"></i>Gitee</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:454722630@qq.com" title="E-Mail → mailto:454722630@qq.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/windanchaos" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;windanchaos" rel="noopener" target="_blank"><i class="weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/windanchaos" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;windanchaos" rel="noopener" target="_blank"><i class="CSDN fa-fw"></i>CSDN</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2020/03/09/jenkins%E6%9E%B6%E6%9E%84%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2020/03/09/jenkins%E6%9E%B6%E6%9E%84%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">jenkins架构和源码分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-03-09 17:00:42" itemprop="dateCreated datePublished" datetime="2020-03-09T17:00:42+08:00">2020-03-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" itemprop="url" rel="index"><span itemprop="name">持续集成</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文是结合写于2015年的博客<a target="_blank" rel="noopener" href="https://blog.csdn.net/sogouauto/article/details/46507267">jenkins源码分析</a>获取脉络，结合自己的研究完成，较原文有所拓展和深入。</p>
<h2 id="jenkins框架"><a href="#jenkins框架" class="headerlink" title="jenkins框架"></a>jenkins框架</h2><p><img data-src="docs/images/architecture_jenkins.png" alt="architecture_jenkins"></p>
<h2 id="jenkins的Model对象"><a href="#jenkins的Model对象" class="headerlink" title="jenkins的Model对象"></a>jenkins的Model对象</h2><p>jenkin(实际是传承Hudson的)Model对象jenkin平台的基石，它们hold住了某一个（job、project、executor、user、buildable item、test result）的数据和状态。</p>
<p>每个Model对象可以和多个views绑定，view使用了Jelly来渲染HTML和对象。</p>
<p>Model的可执行性是通过绑定Actions对象到Model。</p>
<p>Model如是描述对象存在时，是通过绑定Descriptor对象到Model。</p>
<p>每个Model对象和一个URL对象绑定。<br>Stapler通过类似JSF表达式的方式来解决URL和Model Object的绑定问题。Stapler同时处理一个model和URL，然后根据object计算URL，一直重复这个动作，直到命中某个静态资源、可执行方法、视图（jsp、jelly、groovy等）。</p>
<p>命中可执行方法举例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Scenario: browser sends &quot;POST /project/jaxb/testResult HTTP/1.1&quot;</span><br><span class="line"></span><br><span class="line">evaluate(&lt;root object&gt;, &quot;/project/jaxb/testResult&quot;)</span><br><span class="line">-&gt; evaluate(&lt;root object&gt;.getProject(&quot;jaxb&quot;), &quot;/testResult&quot;)</span><br><span class="line">-&gt; evaluate(&lt;jaxb project object&gt;, &quot;/testResult&quot;)</span><br><span class="line">-&gt; evaluate(&lt;jaxb project object&gt;.getTestResult())</span><br></pre></td></tr></table></figure>
<p>命中视图举例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.jvnet.hudson.project.testResul -&gt; /org/jvnet/hudson/project/testResult/index.jelly</span><br><span class="line"></span><br><span class="line">命中之后，response.forward(this,&quot;/org/jvnet/hudson/project/testResult/index.jelly&quot;,request)</span><br></pre></td></tr></table></figure>
<h2 id="jenkins用了stapler"><a href="#jenkins用了stapler" class="headerlink" title="jenkins用了stapler"></a>jenkins用了stapler</h2>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="docs/2020/03/09/jenkins%E6%9E%B6%E6%9E%84%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2020/03/06/%E4%B8%80%E7%A7%8DVPN%E8%87%AA%E5%8A%A8%E8%AE%BE%E7%BD%AE%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2020/03/06/%E4%B8%80%E7%A7%8DVPN%E8%87%AA%E5%8A%A8%E8%AE%BE%E7%BD%AE%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">一种VPN自动设置的解决方案</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-03-06 19:11:20" itemprop="dateCreated datePublished" datetime="2020-03-06T19:11:20+08:00">2020-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" itemprop="url" rel="index"><span itemprop="name">持续集成</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>将之前写过的一个小工具做了一些优化，开源出来。起了个没有任何意义的ppter。</p>
<h1 id="ppter概述"><a href="#ppter概述" class="headerlink" title="ppter概述"></a>ppter概述</h1><h2 id="为什么叫ppter"><a href="#为什么叫ppter" class="headerlink" title="为什么叫ppter"></a>为什么叫ppter</h2><p>任性，没有意义，听着挺好听，嗯就这样。</p>
<p>项目地址： <a target="_blank" rel="noopener" href="https://github.com/windanchaos/ppter">https://github.com/windanchaos/ppter</a> </p>
<h2 id="可用场景"><a href="#可用场景" class="headerlink" title="可用场景"></a>可用场景</h2><p>多地办公，没有固定IP，需办公区对办公区建立VPN，办公区和阿里云建立VPN的场景。</p>
<p>能节省的费用就是两条固定IP的费用。拒我了解的一个固定IP的电信一年30万左右，移动的要10来万。对于小公司来说，一年还是能节约不少钱了。</p>
<p>市面上的其他解决方案，我并不太清楚，如果有更优的免费方案，欢迎告知。</p>
<h2 id="文件说明"><a href="#文件说明" class="headerlink" title="文件说明"></a>文件说明</h2><ul>
<li>aliapi.py 阿里云部分产品api的封装</li>
<li>ConfigProvider.py 配置相关，读取config.ini转成需要的数据类型 </li>
<li>Jobs.py 运行的进程 </li>
<li>Dockerfile docker image镜像构建文件 </li>
<li>requirement 项目依赖</li>
<li>config.ini 配置相关</li>
<li>getDnsInfo.py 获取域名解析信息工具 </li>
<li>ppter_vpn.py vpn相关代码</li>
<li>ppter_vps.py vps相关代码</li>
<li>ppter_dns.py dns解析相关</li>
</ul>
<h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><p>使用独立于办公区内部环境的阿里云（或其他共有云），部署redis作为ip交换媒介。<br><img data-src="docs/images/clip_image001.png" alt="clip_image001"></p>
<h1 id="前置动作"><a href="#前置动作" class="headerlink" title="前置动作"></a>前置动作</h1><ul>
<li>修改正确的config.ini</li>
<li>修改正确vpn配置</li>
</ul>
<p>具体参考<a href="#%E5%90%AF%E5%8A%A8%E5%89%8D%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9%E7%9A%84%E9%85%8D%E7%BD%AE">下文</a>。</p>
<h1 id="容器安装"><a href="#容器安装" class="headerlink" title="容器安装"></a>容器安装</h1><h2 id="docker的安装和配置优化"><a href="#docker的安装和配置优化" class="headerlink" title="docker的安装和配置优化"></a>docker的安装和配置优化</h2><p>其中user是可以操作docker的普通账户，换成自己的即可</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- more --&gt;</span><br><span class="line">bash installDocker.sh user</span><br></pre></td></tr></table></figure>
<h2 id="监控程序启动操作"><a href="#监控程序启动操作" class="headerlink" title="监控程序启动操作"></a>监控程序启动操作</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">镜像打包</span></span><br><span class="line">docker build -t dns_monitor .</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动容器进程</span></span><br><span class="line">docker run -it -d -v `pwd`/config.ini:/root/config.ini --name monitor dns_monitor</span><br></pre></td></tr></table></figure>

<h1 id="直接安装"><a href="#直接安装" class="headerlink" title="直接安装"></a>直接安装</h1><p>使用的python3。</p>
<h2 id="依赖安装"><a href="#依赖安装" class="headerlink" title="依赖安装"></a>依赖安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install redis request configparser base64</span><br></pre></td></tr></table></figure>

<h2 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h2><p><strong>不同环境</strong>独立执行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup python3 Jobs.py &gt; log.log &amp;</span><br></pre></td></tr></table></figure>

<p>程序会做以下动作：</p>
<ul>
<li>5分钟定时获取一次外网IP地址，并同步到redis上</li>
<li>对比IP地址是否有变化，有就执行dns解析、阿里云ipes、本地路由vpn配置变更。ip地址包括本地ip变化和连接端的ip变动。A和B的IP任意变动都会触发本地路由vpn配置。</li>
</ul>
<h1 id="启动前需要修改的配置"><a href="#启动前需要修改的配置" class="headerlink" title="启动前需要修改的配置"></a>启动前需要修改的配置</h1><p>config.ini的文件内容，大部分顾名思义。</p>
<h2 id="Credentials"><a href="#Credentials" class="headerlink" title="Credentials"></a>Credentials</h2><p>需要配置具有阿里云vps 、dns操作权限的id和secret。</p>
<h2 id="域名解析的配置"><a href="#域名解析的配置" class="headerlink" title="域名解析的配置"></a>域名解析的配置</h2><p>[dns] 下的domain设置</p>
<ul>
<li><p>一个｛’RecordId’:’xxx’,’RR’:’record’｝就是一条记录</p>
</li>
<li><p>用’|’符号作分隔符。多条记录：｛’RecordId’:’4154842768102400’,’RR’:’recordA’｝|｛’RecordId’:’4154842768102400’,’RR’:’recordB’｝</p>
<p>其中RR标识map.baidu.com 中的map。</p>
</li>
<li><p>按规则添加即可，删除也是</p>
</li>
</ul>
<p>如何获取domain的recordId和RR（主机记录）？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 getDnsInfo.py</span><br></pre></td></tr></table></figure>

<p>执行后会打印‘baidu.com’的所有解析信息。复制粘贴到json在线解析，找到需要的解析信息。</p>
<p>如果要换域名就修改getDnsInfo.py的内容。</p>
<h2 id="vpn的设置"><a href="#vpn的设置" class="headerlink" title="vpn的设置"></a>vpn的设置</h2><p>前三个参数是路由器的登录地址和账户密码。</p>
<p>redisLocalVpnName 是redis中IP地址的本地标识。</p>
<p>redisRemoteVpnName 是vpn连接远端的标识。</p>
<p>A、B环境的名字需要互换。</p>
<p>A环境的配置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redisLocalVpnName = A</span><br><span class="line">redisRemoteVpnName = B</span><br></pre></td></tr></table></figure>

<p>B环境的配置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redisLocalVpnName = B</span><br><span class="line">redisRemoteVpnName = A</span><br></pre></td></tr></table></figure>
<p>vpn 的配置数据这里没有做到配置文件中，在updata_vpn.py中修改vpn_data，默认vpn-config[0]是对阿里云的vpn设置。vpn-config[1:]之后的是本地对本地的设置。<br>这类数据可能不同路由器，值是不一样的。需要自己去抓包了解一下了。</p>
<h2 id="VPS设置"><a href="#VPS设置" class="headerlink" title="VPS设置"></a>VPS设置</h2><p>不同环境名字区别开即可。</p>
<p>详细的配置在update_vps.py中，主要修改CreateVpnConnection参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CreateVpnConnection = &#123;<span class="string">&#x27;Action&#x27;</span>: <span class="string">&#x27;CreateVpnConnection&#x27;</span>, <span class="string">&#x27;RegionId&#x27;</span>: <span class="string">&#x27;cn-hangzhou&#x27;</span>,</span><br><span class="line">                       <span class="string">&#x27;VpnGatewayId&#x27;</span>: <span class="string">&#x27;XXXXXXX&#x27;</span>, \</span><br><span class="line">                       <span class="string">&#x27;LocalSubnet&#x27;</span>: <span class="string">&#x27;172.16.128.0/20&#x27;</span>, <span class="string">&#x27;RemoteSubnet&#x27;</span>: <span class="string">&#x27;10.189.51.0/24&#x27;</span>,</span><br><span class="line">                       <span class="string">&#x27;IpsecConfig&#x27;</span>:<span class="built_in">str</span>(&#123;<span class="string">&#x27;IpsecAuthAlg&#x27;</span>:<span class="string">&#x27;sha1&#x27;</span>&#125;),</span><br><span class="line">                       <span class="string">&#x27;IkeConfig&#x27;</span>: <span class="built_in">str</span>(&#123;<span class="string">&#x27;Psk&#x27;</span>: <span class="string">&#x27;XXXXXXX&#x27;</span>,<span class="string">&#x27;IkeAuthAlg&#x27;</span>: <span class="string">&#x27;sha1&#x27;</span>&#125;), <span class="string">&#x27;CustomerGatewayId&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;Name&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>网关的名字是设置的name取第二个字符（不含）之后的字符，比如现在name为tohzh，则对应网关名hzh。</p>
<p>Psk 要设置成自己定义的值。</p>
<p>特别注意，用户网关如果没有和ipsce关联，就不要提前设置，否则无法新建。</p>
<h2 id="开源小总结"><a href="#开源小总结" class="headerlink" title="开源小总结"></a>开源小总结</h2><p>1、requests类库是个优秀的开发语言级别的“浏览器”库，基本上不用费神去操作cookies之类的，畅快的request就好；</p>
<p>2、程序持续运行，异常抛出后继续运行的机制设置对程序进程稳定性很重要，异常抛出一般接不住就用所有异常类父类：BaseException</p>
<p>3、学会了一项新的技能，在服务器上控制台上做调试。可参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaohai2003ly/p/8529472.html">这篇文章</a>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pdb test.py</span><br></pre></td></tr></table></figure>

<p>如果要简单说，下面wsn三个我用了比较实用。我在码代码过程中，遇到一个问题，始终不知道为什么在服务器上运行失败，而本地是ok的。调试后发现是配置文件没有换（服务器上是请求url有单引号，解析不出来）<br>w：（where）打印当前执行堆栈 </p>
<p>s：（step）执行下一条命令 </p>
<p>n：（next）执行下一条语句 </p>
<p>4、docker是个好东西</p>
<p>5、扒拉一个系统的运行过程，才能结合自己的需求去做优化和修改。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2019/12/20/%E4%B8%AD%E5%B0%8F%E5%9E%8B%E7%BD%91%E7%AB%99%E7%9A%84%E5%AE%B9%E9%87%8F%E8%A7%84%E5%88%92%E7%BA%B2%E8%A6%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2019/12/20/%E4%B8%AD%E5%B0%8F%E5%9E%8B%E7%BD%91%E7%AB%99%E7%9A%84%E5%AE%B9%E9%87%8F%E8%A7%84%E5%88%92%E7%BA%B2%E8%A6%81/" class="post-title-link" itemprop="url">中小型网站的容量规划纲要</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-12-20 00:16:01" itemprop="dateCreated datePublished" datetime="2019-12-20T00:16:01+08:00">2019-12-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" itemprop="url" rel="index"><span itemprop="name">持续集成</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>作为使用第三方（阿里云）的我司来说，我个人觉得很多钱是浪费了。在知乎上有人讨论自建和上云哪个省钱，其实还是要看在公有云上怎么用，公有云很多资源具有召之即来挥之即去的特性，实际上是可以最大限度的去压榨的。做容量规划的目的，很简单，向规划要资源利用率、投入产出比，算的是笔经济账。对个人而言，替公司节约几十甚至上百万的费用，这种贡献自然会得到丰厚的回报。对企业而言，节约了费用和开支，资源可以使用到其他地方，继而可以提高竞争力。所以，容量规划是必须而且重要的。</p>
<h1 id="容量规划步骤"><a href="#容量规划步骤" class="headerlink" title="容量规划步骤"></a>容量规划步骤</h1><p>我个人构思的步骤有如下，虽不成熟，但是独立思考所得。容量规划有个前置条件，即系统的性能瓶颈已经或者大部分都被识别，在做规划的时候尽量保守一些。大致步骤和关键点：</p>
<ul>
<li>确定系统资源消耗类型（计算密集耗cpu、数据密集吃内存、网络或读写密集吃io），掌握系统在某资源配置情况下，能够支持的并发数。建立各系统的并发模型。</li>
<li>掌握系统当前线上环境日常流量特征，并基于该特征制定一个流量模型。</li>
<li>基于流量模型定制一个资源的基准水位，以达到支持日常访问较合理的资源利用率。</li>
<li>核心服务的流量监控报警方案及自动扩容、缩容方案。</li>
</ul>
<h1 id="系统并发压测方案"><a href="#系统并发压测方案" class="headerlink" title="系统并发压测方案"></a>系统并发压测方案</h1><p>采集线上流量特征，建立流量模型、生成压测模型；</p>
<p>笔者是电商行业，所以对于高频的营销工具也需要单独压测，比如拼团购、限时折扣、拉人应用等。这些工具都是高并发、突发性流量的主要来源。</p>
<h1 id="资源利用率的判定"><a href="#资源利用率的判定" class="headerlink" title="资源利用率的判定"></a>资源利用率的判定</h1><p>理论上，在系统不崩溃、响应正常的前提下，资源利用率的平均值在80-90%，是最优的利用率，它最大限度的压榨了机器的价值。但是很明显，人工构建的系统，想要达到这种级别的利用率而系统一切ok的话，可能要投入更多的研发资源来优化，对于中小企业来说，可能就有点缘木求鱼了，毕竟业务才是王道。退而求其次的话，资源利用率降低一个档次，在60-80%，就是一个比较合理的利用率(压榨)了。</p>
<table>
<thead>
<tr>
<th>利用率%</th>
<th>级别</th>
<th>措施</th>
</tr>
</thead>
<tbody><tr>
<td>[0,30]</td>
<td>闲置</td>
<td>缩容减支</td>
</tr>
<tr>
<td>[30,50]</td>
<td>适当</td>
<td>观察</td>
</tr>
<tr>
<td>[50,70]</td>
<td>合理</td>
<td>观察</td>
</tr>
<tr>
<td>[70,90]</td>
<td>充分</td>
<td>警觉和扩容</td>
</tr>
<tr>
<td>[90,100]</td>
<td>过量</td>
<td>必须扩容</td>
</tr>
</tbody></table>
<h1 id="监控方案"><a href="#监控方案" class="headerlink" title="监控方案"></a>监控方案</h1><p>监控指标的确定：</p>
<ul>
<li>TCP连接指标</li>
<li>内存使用率指标</li>
<li>cpu使用率指标</li>
<li>磁盘IO指标</li>
<li>db的监控指标系列</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="docs/2019/12/20/%E4%B8%AD%E5%B0%8F%E5%9E%8B%E7%BD%91%E7%AB%99%E7%9A%84%E5%AE%B9%E9%87%8F%E8%A7%84%E5%88%92%E7%BA%B2%E8%A6%81/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2019/11/26/Supervisor%E6%BA%90%E7%A0%81%E7%A0%94%E7%A9%B6%E5%92%8C%E5%AD%A6%E4%B9%A0%E4%B8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2019/11/26/Supervisor%E6%BA%90%E7%A0%81%E7%A0%94%E7%A9%B6%E5%92%8C%E5%AD%A6%E4%B9%A0%E4%B8%80/" class="post-title-link" itemprop="url">Supervisor源码研究和学习</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-11-26 00:15:09" itemprop="dateCreated datePublished" datetime="2019-11-26T00:15:09+08:00">2019-11-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">计算机科学基础</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="出发点"><a href="#出发点" class="headerlink" title="出发点"></a>出发点</h1><p>最近，在构思一套内部环境服务的监控系统，起码的功能是能识别到业务进程异常（进程级别的），退出后自动拉起。<br>找到了supervisor，了解基本功能后，觉得它在分布式方面还存在不足之处，所有配置分散在单机上。鉴于它的技术符合目前需要练习python技术栈。所以，准备对其源代码进行解构、分析和学习。</p>
<h1 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h1><p>源码研究和学习，起码要对该工具如何使用有个基本的掌握。</p>
<p>Supervisor是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。它是通过fork&#x2F;exec的方式把这些被管理的进程当作supervisor的子进程来启动，这样只要在supervisor的配置文件中，把要管理的进程的可执行文件的路径写进去即可。也实现当子进程挂掉的时候，父进程可以准确获取子进程挂掉的信息的，可以选择是否自己启动和报警。supervisor还提供了一个功能，可以为supervisord或者每个子进程，设置一个非root的user，这个user就可以管理它对应的进程。</p>
<h2 id="medusa"><a href="#medusa" class="headerlink" title="medusa"></a>medusa</h2><p>它依赖第三方的<a target="_blank" rel="noopener" href="http://www.nightmare.com/medusa/">medusa</a>来处理网络请求。medusa的源码也值得学习和研究。</p>
<h2 id="supervisord"><a href="#supervisord" class="headerlink" title="supervisord"></a>supervisord</h2><p>类似于docker所在服务器运行的守护进程，负责响应客户端的命令行、受监控进程的监控、重启、受控子进程的标准输入输出的日志、生成和处理与子流程生命周期中相对应的“事件”。配置文件一般为&#x2F;etc&#x2F;supervisord.conf。</p>
<h2 id="supervisorctl"><a href="#supervisorctl" class="headerlink" title="supervisorctl"></a>supervisorctl</h2><p>控制台，和supervisord交互。通过控制台，用户可以连接到不同的supervisord进程（ 通过UNIX domain socket or an internet (TCP) socket），查看supervisord的控制进程的状态。读取&#x2F;etc&#x2F;supervisord.conf下的[supervisorctl]内容作为配置。</p>
<h2 id="Web-Server"><a href="#Web-Server" class="headerlink" title="Web Server"></a>Web Server</h2><p>supervisord的浏览器控制台。仅支持单机模式，就是说，N台服务器安装了supervisor的话，就有N个webServer，它们彼此之间并没有关联，所以也没有一个集中化的界面统一管理。</p>
<p>有个php的解决方案：<a target="_blank" rel="noopener" href="https://blog.csdn.net/geerniya/article/details/80107761">https://blog.csdn.net/geerniya/article/details/80107761</a></p>
<h2 id="XML-RPC-Interface"><a href="#XML-RPC-Interface" class="headerlink" title="XML-RPC Interface"></a>XML-RPC Interface</h2><p>The same HTTP server which serves the web UI serves up an XML-RPC interface that can be used to interrogate and control supervisor and the programs it runs.</p>
<h2 id="不足"><a href="#不足" class="headerlink" title="不足"></a>不足</h2><p>优点：<br>    - 可以将非后台运行程序后台运行<br>    - 自动监控，重启进程</p>
<p>缺点：<br>    - 不能管理后台运行程序<br>    - 对多进程服务，不能使用kill关闭</p>
<h1 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h1><p>源码分析步骤：</p>
<p>1、clone代码到本地；</p>
<p>2、本地做supervisord的配置</p>
<p>3、参考别写的源码文章，找到程序入口，阅读代码</p>
<p>4、debug若干次，追中代码运行逻辑</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="docs/2019/11/26/Supervisor%E6%BA%90%E7%A0%81%E7%A0%94%E7%A9%B6%E5%92%8C%E5%AD%A6%E4%B9%A0%E4%B8%80/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2019/11/24/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2019/11/24/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B%E5%8E%9F%E7%90%86/" class="post-title-link" itemprop="url">操作系统进程原理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-11-24 20:25:21" itemprop="dateCreated datePublished" datetime="2019-11-24T20:25:21+08:00">2019-11-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">计算机科学基础</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>这篇文章是研习supervisor源代码的副产品，主要理解supervisor的驱动原理和操作系统对进程管理的一些基本知识。</p>
<h1 id="理解什么是进程"><a href="#理解什么是进程" class="headerlink" title="理解什么是进程"></a>理解什么是进程</h1><p>百度百科定义如下：进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。在早期面向进程设计的计算机结构中，进程是程序的基本执行实体；在当代面向线程设计的计算机结构中，进程是线程的容器。程序是指令、数据及其组织形式的描述，进程是程序的实体。</p>
<p>进程是操作系统对资源的一个抽象。<br>操作系统是计算机的管家，掌控着计算机内部的一切资源的分配、调度、回收。<br>而进程可以理解为计算机资源调度的一个基本单元。用播放电影来举个形象的例子，进程就是电影一针一针的画面，而程序就是播放这部电影的一个统称，电影没开始播放前，得准备放映机（cpu），电影胶片（内存）。放音机齿轮转动就好比cpu的时钟脉冲，每秒扫过N个胶片(进程被调度），图像被光打到幕布上（计算机的输出设备）。</p>
<p>换一个角度看操作系统的进程，linux系统开机启动到系统启动完毕，从进程的角度看就是一生二、二生三、三生万物的感觉。我们面对的就是进程的一课大树，它的源头就是进程号为1(名叫systemd)的进程，<a target="_blank" rel="noopener" href="https://blog.csdn.net/feiyu5323/article/details/90707749">systemd</a>是Linux下的一种负责init的进程，那字母d就是daemon的标记，又比如apache的http服务，它的进程也有个字母d，httpd。可以运行pstree命令来体验一下这种子子孙孙无穷匮也。ps和systemctl命令也有类似效果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pstree</span><br><span class="line">ps axjf</span><br><span class="line">systemctl status</span><br></pre></td></tr></table></figure>
<h1 id="进程运行环境"><a href="#进程运行环境" class="headerlink" title="进程运行环境"></a>进程运行环境</h1><p>在Linux中，用户程序装入系统形成一个进程的实质是操作系统为用户程序提供一个完整的运行环境。进程的运行环境是由它的程序代码和程序运行所需要的数据结构以及硬件环境组成的。进程的运行环境主要包括：</p>
<ul>
<li><p>1.进程空间（内存）中的代码和数据、各种数据结构、进程堆栈和共享内存区等。</p>
</li>
<li><p>2.环境变量：提供进程运行所需的环境信息。</p>
</li>
<li><p>3.系统数据：进程空间中的对进程进行管理和控制所需的信息，包括进程任务结构体以及内核堆栈等。</p>
</li>
<li><p>4.进程访问设备或者文件时的权限。</p>
</li>
<li><p>5.各种硬件寄存器。</p>
</li>
<li><p>6.地址转换信息。</p>
</li>
</ul>
<h1 id="Linux下的进程模型"><a href="#Linux下的进程模型" class="headerlink" title="Linux下的进程模型"></a>Linux下的进程模型</h1><h2 id="从PCB中了解进程模型"><a href="#从PCB中了解进程模型" class="headerlink" title="从PCB中了解进程模型"></a>从PCB中了解进程模型</h2><p>一个进程在操作系统中执行，有两种状态：内核态和用户态。如果当前运行的是用户程序（用户代码），那么对应进程就处于用户），如果出现系统调用或者发生中断，那么对应进程就处于内核模式（核心态）。</p>
<p>为了描述控制进程的运行，系统中存放进程的管理和控制信息的数据结构称为进程控制块 PCB（Process Control Block），它是进程实体的一部分，是操作系统中最重要的记录性数据结构。它是进程管理和控制的最重要的数据结构，每一个进程均有一个 PCB，在创建进程时，建立 PCB，伴随进程运行的全过程，直到进程撤消而撤消。PCB 记录了操作系统所需的，用于描述进程的当前情况以及控制进程运行的全部信息（如打开的文件、挂起的信号、进程状态、地址空间等等）。在linux中这个PCB是一个叫做task_struct的结构体。</p>
<p>task_struct 在linux中，每一个进程都有一个进程描述符，这个”进程描述符”是一个结构体名字叫做task_struct，在task_struct里面保存了许多关于进程控制的信息。</p>
<p>task_struct是Linux内核的一种数据结构，它会被装载到RAM里并包含进程的信息。</p>
<p>每个进程都把它的信息放在task_struct这个数据结构里面，而task_struct包含以下内容：</p>
<h3 id="进程状态（State）"><a href="#进程状态（State）" class="headerlink" title="进程状态（State）"></a>进程状态（State）</h3><p>表示进程的状态， 在进程执行的时候，它会有一个状态，这个状态对于进程来说是很重要的一个属性。包括：可运行、可中断的等待状态、不可中断的等待状态、将死、暂停、换入&#x2F;换出。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="docs/2019/11/24/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B%E5%8E%9F%E7%90%86/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2019/09/27/%E5%B0%86%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E8%BD%AC%E6%8D%A2%E4%B8%BA%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2019/09/27/%E5%B0%86%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E8%BD%AC%E6%8D%A2%E4%B8%BA%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/" class="post-title-link" itemprop="url">将有序数组转换为二叉搜索树</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-09-27 23:52:24" itemprop="dateCreated datePublished" datetime="2019-09-27T23:52:24+08:00">2019-09-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近在刷leetcode算法的入门题，刷到二叉树，一开始浑浑噩噩，后来掌握了套路，自己搞定一个，而且很优雅，比留言中的大部分都优雅，嗯，写个日志自嗨一把。<br>所有刷题都提交到我的github上了，具体位置：<a target="_blank" rel="noopener" href="https://github.com/windanchaos/Java_Basic/tree/master/src/algorithm">windanchaos的github</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">题目要求：</span><br><span class="line">将一个按照升序排列的有序数组，转换为一棵高度平衡二叉搜索树。</span><br><span class="line"></span><br><span class="line">本题中，一个高度平衡二叉树是指一个二叉树每个节点 的左右两个子树的高度差的绝对值不超过 <span class="number">1</span>。</span><br><span class="line"></span><br><span class="line">示例:</span><br><span class="line"></span><br><span class="line">给定有序数组: [-<span class="number">10</span>,-<span class="number">3</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">9</span>],</span><br><span class="line"></span><br><span class="line">一个可能的答案是：[<span class="number">0</span>,-<span class="number">3</span>,<span class="number">9</span>,-<span class="number">10</span>,<span class="literal">null</span>,<span class="number">5</span>]，它可以表示下面这个高度平衡二叉搜索树：</span><br><span class="line"></span><br><span class="line">      <span class="number">0</span></span><br><span class="line">     / \</span><br><span class="line">   -<span class="number">3</span>   <span class="number">9</span></span><br><span class="line">   /   /</span><br><span class="line"> -<span class="number">10</span>  <span class="number">5</span></span><br><span class="line"></span><br><span class="line">来源：力扣（<span class="title class_">LeetCode</span>）</span><br><span class="line">链接：<span class="attr">https</span>:<span class="comment">//leetcode-cn.com/problems/convert-sorted-array-to-binary-search-tree</span></span><br><span class="line">著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</span><br></pre></td></tr></table></figure>

<p>我的解法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&lt;!-- more --&gt;</span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">执行用时 :1 ms, 在所有 Java 提交中击败了99.76%的用户</span></span><br><span class="line"><span class="comment">内存消耗 :37.2 MB, 在所有 Java 提交中击败了97.44%的用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    public <span class="title class_">TreeNode</span> <span class="title function_">sortedArrayToBST</span>(<span class="params">int[] nums</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.<span class="property">length</span>==<span class="number">0</span> || <span class="literal">null</span> == nums) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//只有一个元素的情况</span></span><br><span class="line">        <span class="keyword">if</span>(nums.<span class="property">length</span>==<span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(nums[<span class="number">0</span>]);</span><br><span class="line">        <span class="comment">//数量大于1，构建节点</span></span><br><span class="line">        <span class="title class_">TreeNode</span> root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(nums[nums.<span class="property">length</span>/<span class="number">2</span>]);</span><br><span class="line">        <span class="comment">//构建左右子树</span></span><br><span class="line">        root.<span class="property">left</span>=<span class="title function_">sortedArrayToBST</span>(<span class="title class_">Arrays</span>.<span class="title function_">copyOfRange</span>(nums,<span class="number">0</span>,nums.<span class="property">length</span>/<span class="number">2</span>));</span><br><span class="line">        root.<span class="property">right</span>=<span class="title function_">sortedArrayToBST</span>(<span class="title class_">Arrays</span>.<span class="title function_">copyOfRange</span>(nums,nums.<span class="property">length</span>/<span class="number">2</span>+<span class="number">1</span>,nums.<span class="property">length</span>));</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2019/09/03/%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2019/09/03/%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/" class="post-title-link" itemprop="url">缓存技术原理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-09-03 09:28:20" itemprop="dateCreated datePublished" datetime="2019-09-03T09:28:20+08:00">2019-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">计算机科学基础</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近在看一本讲数据库架构的英文书，书中很多次提及到一个叫缓存的词语，在我们商城的业务系统中也经常听到缓存这个词语。于是百度找到这篇文章。内心觉得总结很到位。转自：<a target="_blank" rel="noopener" href="http://www.sohu.com/a/272322730_505779">缓存技术原理</a></p>
<p>一、前言</p>
<p>应用中使用缓存技术，往往可以大大减少计算量，有效提升响应速度，让有限的资源服务更多的用户。但是，似乎还没有一种缓存方案可以满足所有的业务场景，我们需要根据自身的特殊场景和背景，选择最适合的缓存方案，尽量以最小的成本最快的效率达到最优的目的。本文将从多个方面对缓存进行分析，以便作为选择缓存方案的考量。<br>二、文章要点</p>
<p>三、缓存的理解 3.1 狭义的理解</p>
<p>缓存指的是 CPU 缓存，当 CPU 要读取一个数据时，首先从 CPU 缓存中查找，找到就立即读取并送给 CPU 处理；没有找到，就从速率相对较慢的内存中读取并送给 CPU 处理，同时把这个数据所在的数据块调入缓存中，可以使得以后对整块数据的读取都从缓存中进行，不必再调用内存。</p>
<p>3.2 广义的理解</p>
<p>凡是位于速度相差较大的两种硬件&#x2F;软件之间的，用于协调两者数据传输速度差异的结构，均可称之为缓存。</p>
<p>3.3 缓存的优点</p>
<p>如下，一个 Web 应用架构一般有如下几层：</p>
<p><img data-src="docs/images/5.cdn.sohucs.com-images-20181031-3d7fe68ac3fc46109c36d9e58246923a-.png"></p>
<p>在此架构的不同层级之间，都可以存在缓存。比如：</p>
<p>总结来说，缓存在如下三个方面做了提升：</p>
<p>四、CPU 缓存简介</p>
<p>CPU 缓存（Cache Memory）是位于 CPU与 内存之间的临时存储器，它的容量比内存小的多，但是交换速率却比内存要快得多。缓存的出现主要是为了解决 CPU 运算速率与内存读写速率不匹配的矛盾，因为 CPU 运算速率要比内存读写速率快很多，这样会使 CPU 花费很长时间等待数据到来或把数据写入内存。在缓存中的数据是内存中的一小部分，但这一小部分是短时间内 CPU 即将访问的，当 CPU 调用大量数据时，就可避开内存直接从缓存中调用，从而加快读取速率。由此可见，在 CPU 中加入缓存是一种高效的解决方案，这样整个内存储器（缓存+内存）就变成了既有缓存的高速率，又有内存的大容量的存储系统了。 缓存基本上都是采用 SRAM 存储器，存储器在计算机内部的组织方式如下图所示：</p>
<p><img data-src="docs/images/5.cdn.sohucs.com-images-20181031-d1d0170cbd9f4ee0a16f36ea08f42e24.jpeg.png"></p>
<p>越往上，存储器的容量越小、成本越高、速度越快。由于 CPU 和主存之间巨大的速度差异，系统设计者被迫在 CPU 寄存器和主存之间插入了一个小的 SRAM 高速缓存存储器称为 L1 缓存，大约可以在 2-4 个时钟周期（计算机中最小的时间单位）内访问。再后来发现 L1 高速缓存和主存之间还是有较大差距，又在 L1 高速缓存和主存之间插入了 L2 缓存，大约可以在 10 个时钟周期内访问。后面还新增了 L3 等，于是，在这样的模式下，在不断的演变中形成了现在的存储体系。<br>五、分布式缓存原理 5.1 本地缓存</p>
<p>本地缓存可能是大家用的最多的一种缓存方式了，如 Ehcache、Guava Cache 等，它是在应用中的缓存组件，其最大的优点是应用和 cache 是在同一个进程内部，请求缓存非常快速，没有过多的网络开销等，在单应用不需要集群支持或者集群情况下各节点无需互相通知的场景下使用本地缓存较合适； 同时，它的缺点也是因为缓存跟应用程序耦合，多个应用程序无法直接的共享缓存，各应用或集群的各节点都需要维护自己的单独缓存，对内存是一种浪费。</p>
<p>5.2 分布式缓存特性</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="docs/2019/09/03/%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2019/08/27/Systemd%20%E6%B7%BB%E5%8A%A0tomcat%E6%9C%8D%E5%8A%A1%EF%BC%8C%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%EF%BC%8C%E6%94%AF%E6%8C%81apr/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2019/08/27/Systemd%20%E6%B7%BB%E5%8A%A0tomcat%E6%9C%8D%E5%8A%A1%EF%BC%8C%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%EF%BC%8C%E6%94%AF%E6%8C%81apr/" class="post-title-link" itemprop="url">Systemd 添加tomcat服务，开机启动，支持apr</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-08-27 16:29:53" itemprop="dateCreated datePublished" datetime="2019-08-27T16:29:53+08:00">2019-08-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:44:42" itemprop="dateModified" datetime="2021-06-08T18:44:42+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" itemprop="url" rel="index"><span itemprop="name">持续集成</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>问题描述：<br>我们的tomcat启动了apr启动https端口，我设置了systemd的tomcat.service的文件，使用systemctl start tomcat，始终无法识别apr的环境变量。研究了一会后解决。<br>先贴tomcat.service最终设置，只需加一行配置即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="title class_">Unit</span>]</span><br><span class="line"><span class="title class_">Description</span>=java tomcat project</span><br><span class="line"><span class="title class_">After</span>=syslog.<span class="property">target</span> network.<span class="property">target</span></span><br><span class="line"></span><br><span class="line">[<span class="title class_">Service</span>]</span><br><span class="line"><span class="title class_">Type</span>=forking</span><br><span class="line"><span class="title class_">User</span>=user</span><br><span class="line"><span class="title class_">Group</span>=user</span><br><span class="line"><span class="title class_">EnvironmentFile</span>=<span class="regexp">/opt/</span>apache-tomcat/bin/config</span><br><span class="line"><span class="title class_">ExecStart</span>=<span class="regexp">/opt/</span>apache-tomcat/bin/startup.<span class="property">sh</span></span><br><span class="line"><span class="title class_">ExecReload</span>=</span><br><span class="line"><span class="title class_">ExecStop</span>=<span class="regexp">/arthas/</span>servers/apache-tomcat-<span class="number">8.5</span><span class="number">.4</span>-<span class="number">80</span>/bin/shutdown.<span class="property">sh</span></span><br><span class="line"><span class="title class_">PrivateTmp</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[<span class="title class_">Install</span>]</span><br><span class="line"><span class="title class_">WantedBy</span>=multi-user.<span class="property">target</span></span><br></pre></td></tr></table></figure>

<p><strong>关键点：</strong></p>
<p>EnvironmentFile&#x3D;&#x2F;opt&#x2F;apache-tomcat&#x2F;bin&#x2F;config 的设置。<br>文件内容如下，是启动tomcat的环境变量：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">LD_LIBRARY_PATH</span>=<span class="regexp">/usr/</span>local/apr/<span class="attr">lib</span>:$LD_LIBRARY_PATH</span><br></pre></td></tr></table></figure>

<p>原理：<br>1、&#x2F;etc&#x2F;profile或者&#x2F;etc&#x2F;security&#x2F;limit.d这些文件中配置的环境变量仅对通过pam登录的用户生效，而systemd是不读这些配置的，所以这就造成登录到终端时查看环境变量和手动启动应用都一切正常，但是systemd无法正常启动应用。<br>2、EnvironmentFile：该字段指定软件自己的环境参数。</p>
<p>参考：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/lizao2/article/details/81030380">https://blog.csdn.net/lizao2/article/details/81030380</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jhxxb/p/10654554.html">https://www.cnblogs.com/jhxxb/p/10654554.html</a></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="docs/2019/08/27/Systemd%20%E6%B7%BB%E5%8A%A0tomcat%E6%9C%8D%E5%8A%A1%EF%BC%8C%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%EF%BC%8C%E6%94%AF%E6%8C%81apr/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2019/08/09/git%E6%8D%A2%E8%A1%8C%E7%AC%A6%E5%86%B2%E7%AA%81CRLF%E3%80%81LF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2019/08/09/git%E6%8D%A2%E8%A1%8C%E7%AC%A6%E5%86%B2%E7%AA%81CRLF%E3%80%81LF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">git换行符冲突CRLF、LF的解决方案</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-08-09 14:51:32" itemprop="dateCreated datePublished" datetime="2019-08-09T14:51:32+08:00">2019-08-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index"><span itemprop="name">Linux管理维护</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>git在维护版本库的时候统一使用的是LF，这样就可以保证文件跨平台的时候保持一致。<br>在Linux下默认的换行符也是LF，那也就不存在什么问题。<br>在Windows下默认的换行符是CRLF，那么我们需要保证在文件提交到版本库的时候文件的换行符是LF，通常来说有两种方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 在工作区使用<span class="variable constant_">CRLF</span>，使用git commit提交的时候git帮你把所有的<span class="variable constant_">CRLF</span>转换为<span class="variable constant_">LF</span>。</span><br><span class="line">git config --<span class="variable language_">global</span> core.<span class="property">autocrlf</span> <span class="literal">true</span></span><br><span class="line"># 在工作区使用<span class="variable constant_">LF</span></span><br><span class="line">git config --<span class="variable language_">global</span> core.<span class="property">autocrlf</span> input</span><br><span class="line"># 避免文件中有混用换行符</span><br><span class="line">git config --<span class="variable language_">global</span> core.<span class="property">safecrlf</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>以上措施如果都不管用，尤其是莫名其妙的，git刚刚clone的代码库就存在图片换行符的问题，比如我的。<br><img data-src="docs/images/20190809144730689.jpg-x-oss-process=image-watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpbmRhbmNoYW9z,size_16,color_FFFFFF,t_70.png" alt="刚clone的代码库就存在换行符导致的问题"><br>那么你可以试试——————————————————————————升级你的git，是的，所有设置方案都试过后，这一招彻底解决。</p>
<p>这里下载：<a target="_blank" rel="noopener" href="https://github.com/git/git/releases?after=v2.21.0-rc1">https://github.com/git/git/releases?after=v2.21.0-rc1</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># centos自带<span class="title class_">Git</span>，<span class="number">7.</span>x版本自带git <span class="number">1.8</span><span class="number">.3</span><span class="number">.1</span>，安装新版本之前需要使用卸载。</span><br><span class="line">yum remove -y git</span><br><span class="line"># 依赖</span><br><span class="line">yum install -y curl-devel expat-devel gettext-devel openssl-devel zlib-devel  gcc perl-<span class="title class_">ExtUtils</span>-<span class="title class_">MakeMaker</span></span><br><span class="line">wget <span class="attr">https</span>:<span class="comment">//github.com/git/git/archive/v2.20.0.tar.gz</span></span><br><span class="line">tar xzf v2<span class="number">.20</span><span class="number">.0</span>.<span class="property">tar</span>.<span class="property">gz</span></span><br><span class="line">cd git-<span class="number">2.22</span><span class="number">.0</span></span><br><span class="line">make prefix=<span class="regexp">/usr/</span>local/git all</span><br><span class="line">make prefix=<span class="regexp">/usr/</span>local/git install</span><br><span class="line"># 创建软连接</span><br><span class="line">ln -s  /usr/local/git/bin/git /usr/bin/git</span><br><span class="line">git --version</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2019/07/21/%E7%BC%96%E7%A8%8B%E6%B1%82%EF%BC%9A%E2%88%911+%E2%88%912+%E2%80%A6%E2%80%A6+%E2%88%91100/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2019/07/21/%E7%BC%96%E7%A8%8B%E6%B1%82%EF%BC%9A%E2%88%911+%E2%88%912+%E2%80%A6%E2%80%A6+%E2%88%91100/" class="post-title-link" itemprop="url">编程求：∑1+∑2+……+∑100</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-07-21 22:04:20" itemprop="dateCreated datePublished" datetime="2019-07-21T22:04:20+08:00">2019-07-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/Java%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">Java编程语言</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近在践行代码，先把尚学堂的习题做完，遇到有点代表的就发个日志。<br>以下算法时间复杂度为N，还可以。这个好像是用了某种算法，具体叫动态规划法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    103.	【上机】编程求：∑1+∑2+……+∑100</span></span><br><span class="line"><span class="comment">    这里输入最大数100作为参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    public <span class="keyword">void</span> <span class="title function_">sigma</span>(<span class="params">int num</span>)&#123;</span><br><span class="line">        <span class="comment">//利用数组记录∑n的值,数组的index=n，特征：∑n=∑(n-1)+n</span></span><br><span class="line">        <span class="comment">//数组下标等于数字，数组index为0的丢弃</span></span><br><span class="line">        int[] array_tmp=<span class="keyword">new</span> int[num+<span class="number">1</span>];</span><br><span class="line">        int sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(int i=<span class="number">1</span>;i&lt;num+<span class="number">1</span>;i++)&#123;</span><br><span class="line">        	<span class="comment">//数组index为0时，默认值0，可直接迭代</span></span><br><span class="line">            array_tmp[i]=array_tmp[i-<span class="number">1</span>]+i;</span><br><span class="line">            sum=sum+array_tmp[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;∑1+∑2+……+∑&quot;</span>+num+<span class="string">&quot;的和为：&quot;</span>+sum);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>∑1+∑2+……+∑100的和为：171700</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="docs/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="docs/">1</a><span class="page-number current">2</span><a class="page-number" href="docs/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="docs/page/12/">12</a><a class="extend next" rel="next" href="docs/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">蜀ICP备19036728号 </a>
      <img src="docs/images/%E5%A4%87%E6%A1%88%E5%9B%BE%E6%A0%87.png" alt=""><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51012202000611" rel="noopener" target="_blank">川公网安备 51012202000611号 </a>
  </div>

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-dragon"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">windanchaos</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="docs/js/comments.js"></script><script src="docs/js/utils.js"></script><script src="docs/js/motion.js"></script><script src="docs/js/schemes/muse.js"></script><script src="docs/js/next-boot.js"></script><script src="docs/js/pjax.js"></script>

  





  




  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":"enable","home":"enable","archive":"enable","delay":true,"timeout":3000,"priority":true,"url":"https://windanchaos.github.io/page/2/"}</script>
  <script src="docs/js/third-party/quicklink.js"></script>

</body>
</html>
