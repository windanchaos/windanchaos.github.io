<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="docs/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="docs/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="docs/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="docs/images/logo.svg" color="#222">

<link rel="stylesheet" href="docs/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"windanchaos.github.io","root":"docs/","images":"docs/images","scheme":"Mist","darkmode":true,"version":"8.13.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="docs/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://windanchaos.github.io/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale">
<meta property="article:author" content="windanchaos">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://windanchaos.github.io/page/4/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh","comments":"","permalink":"","path":"page/4/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo</title>
  






  <noscript>
    <link rel="stylesheet" href="docs/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="docs/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-首页"><a href="docs/" rel="section"><i class="home fa-fw"></i>首页</a></li><li class="menu-item menu-item-分类"><a href="docs/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li><li class="menu-item menu-item-归档"><a href="docs/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-标签"><a href="docs/tags/" rel="section"><i class="tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-关于"><a href="docs/about/me.html" rel="section"><i class="user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="windanchaos"
      src="docs/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">windanchaos</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="docs/archives/">
          <span class="site-state-item-count">111</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="docs/categories/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="docs/tags/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/windanchaos" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;windanchaos" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/windanchaos" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;windanchaos" rel="noopener" target="_blank"><i class="gitee fa-fw"></i>Gitee</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:454722630@qq.com" title="E-Mail → mailto:454722630@qq.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/windanchaos" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;windanchaos" rel="noopener" target="_blank"><i class="weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/windanchaos" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;windanchaos" rel="noopener" target="_blank"><i class="CSDN fa-fw"></i>CSDN</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2018/08/15/shell%E4%B8%AD%E5%90%84%E7%A7%8D%E6%8B%AC%E5%8F%B7%E7%9A%84%E4%BD%9C%E7%94%A8%E8%AF%A6%E8%A7%A3()%E3%80%81(())%E3%80%81[]%E3%80%81[[]]%E3%80%81%7B%7D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2018/08/15/shell%E4%B8%AD%E5%90%84%E7%A7%8D%E6%8B%AC%E5%8F%B7%E7%9A%84%E4%BD%9C%E7%94%A8%E8%AF%A6%E8%A7%A3()%E3%80%81(())%E3%80%81%5B%5D%E3%80%81%5B%5B%5D%5D%E3%80%81%7B%7D/" class="post-title-link" itemprop="url">shell中各种括号的作用详解()、(())、[]、[[]]、{}</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-08-15 20:26:31" itemprop="dateCreated datePublished" datetime="2018-08-15T20:26:31+08:00">2018-08-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index"><span itemprop="name">Linux管理维护</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>①<strong>命令组</strong>。括号中的命令将会新开一个子shell顺序执行，所以括号中的变量不能够被脚本余下的部分使用。括号中多个命令之间用分号隔开，最后一个命令可以没有分号，各命令和括号之间不必有空格。</p>
<p>②<strong>命令替换</strong>。等同于<code>cmd</code>，shell扫描一遍命令行，发现了(cmd)结构，便将 (   c   m   d   )    结     构     ，     便     将(cmd)中的cmd执行一次，得到其标准输出，再将此输出放到原来命令。有些shell不支持，如tcsh。</p>
<p>③<strong>用于初始化数组</strong>。如：array&#x3D;(a b c d)</p>
<p>①<strong>整数扩展</strong>。这种扩展计算是整数型的计算，不支持浮点型。((exp))结构扩展并计算一个算术表达式的值，如果表达式的结果为0，那么返回的退出状态码为1，或者 是”假”，而一个非零值的表达式所返回的退出状态码将为0，或者是”true”。若是逻辑判断，表达式exp为真则为1,假则为0。</p>
<p>②只要括号中的运算符、表达式符合C语言运算规则，都可用在((exp))中，甚至是三目运算符。作不同进位(如二进制、八进制、十六进制)运算时，输出结果全都自动转化成了十进制。如：echo (   (   e   x   p   )   )    中     ，     甚     至     是     三     目     运     算     符     。     作     不     同     进     位    (    如     二     进     制     、     八     进     制     、     十     六     进     制    )    运     算     时     ，     输     出     结     果     全     都     自     动     转     化     成     了     十     进     制     。     如     ：    e   c   h   o((16&#x2F;#5f)) 结果为95 (16进位转十进制)</p>
<p>③单纯用 (( )) 也可<strong>重定义变量值</strong>，比如 a&#x3D;5; ((a++)) 可将 $a 重定义为6</p>
<p>④常用于<strong>算术运算比较</strong>，双括号中的变量可以不使用$符号前缀。括号内支持多个表达式用逗号分开。 只要括号中的表达式符合C语言运算规则,比如可以直接使用for((i&#x3D;0;i&lt;5;i++)), 如果不使用双括号, 则为for i in <code>seq 0 4</code>或者for i in {0..4}。再如可以直接使用if (($i&lt;5)), 如果不使用双括号, 则为if [ $i -lt 5 ]。</p>
<h2 id="二、中括号，方括号"><a href="#二、中括号，方括号" class="headerlink" title="二、中括号，方括号[]"></a>二、中括号，方括号[]</h2><p>①<strong>bash 的内部命令，[和test是等同的</strong>。如果我们不用绝对路径指明，通常我们用的都是bash自带的命令。if&#x2F;test结构中的左中括号是调用test的命令标识，右中括号是关闭条件判断的。这个命令把它的参数作为比较表达式或者作为文件测试，并且根据比较的结果来返回一个退出状态码。if&#x2F;test结构中并不是必须右中括号，但是新版的Bash中要求必须这样。</p>
<p>②Test和[]中可用的比较运算符只有&#x3D;&#x3D;和!&#x3D;，两者都是用于字符串比较的，不可用于整数比较，整数比较只能使用-eq，-gt这种形式。无论是字符串比较还是整数比较都不支持大于号小于号。如果实在想用，对于字符串比较可以使用转义形式，如果比较”ab”和”bc”：[ ab &lt; bc ]，结果为真，也就是返回状态为0。[ ]中的逻辑与和逻辑或使用-a 和-o 表示。</p>
<p>③<strong>字符范围</strong>。用作正则表达式的一部分，描述一个匹配的字符范围。作为test用途的中括号内不能使用正则。</p>
<p>④在一个array 结构的上下文中，中括号用来<strong>引用数组中每个元素的编号</strong>。</p>
<p>①**[[是 bash 程序语言的关键字**。并不是一个命令，[[ ]] 结构比[ ]结构更加通用。在[[和]]之间所有的字符都不会发生文件名扩展或者单词分割，但是会发生参数扩展和命令替换。</p>
<p>②<strong>支持字符串的模式匹配</strong>，使用&#x3D;~操作符时甚至支持shell的正则表达式。字符串比较时可以把右边的作为一个模式，而不仅仅是一个字符串，比如[[ hello &#x3D;&#x3D; hell? ]]，结果为真。[[ ]] 中匹配字符串或通配符，不需要引号。</p>
<p>③使用[[ … ]]条件判断结构，而不是[ … ]，能够防止脚本中的许多逻辑错误。比如，&amp;&amp;、||、&lt;和&gt; 操作符能够正常存在于[[ ]]条件判断结构中，但是如果出现在[ ]结构中的话，会报错。比如可以直接使用if [[ $a !&#x3D; 1 &amp;&amp; $a !&#x3D; 2 ]], 如果不适用双括号, 则为if [ $a -ne 1] &amp;&amp; [ $a !&#x3D; 2 ]或者if [ $a -ne 1 -a $a !&#x3D; 2 ]。</p>
<p>④bash把双中括号中的表达式看作一个单独的元素，并返回一个退出状态码。</p>
<p>例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($i&lt;<span class="number">5</span>) </span><br><span class="line"><span class="keyword">if</span> [ $i -lt <span class="number">5</span> ] </span><br><span class="line"><span class="keyword">if</span> [ $a -ne <span class="number">1</span> -a $a != <span class="number">2</span> ] </span><br><span class="line">&lt;!-- more --&gt;</span><br><span class="line"><span class="keyword">if</span> [ $a -ne <span class="number">1</span>] &amp;&amp; [ $a != <span class="number">2</span> ] </span><br><span class="line"><span class="keyword">if</span> [[ $a != <span class="number">1</span> &amp;&amp; $a != <span class="number">2</span> ]] </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq <span class="number">0</span> <span class="number">4</span>);<span class="keyword">do</span> echo $i;done </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">`seq 0 4`</span>;<span class="keyword">do</span> echo $i;done </span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++));<span class="keyword">do</span> echo $i;done </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;<span class="number">0.</span><span class="number">.4</span>&#125;;<span class="keyword">do</span> echo $i;done</span><br></pre></td></tr></table></figure>

<h2 id="三、大括号、花括号"><a href="#三、大括号、花括号" class="headerlink" title="三、大括号、花括号 {}"></a>三、大括号、花括号 {}</h2><p>①<strong>大括号拓展</strong>。(通配(globbing))将对大括号中的文件名做扩展。在大括号中，不允许有空白，除非这个空白被引用或转义。第一种：对大括号中的以逗号分割的文件列表进行拓展。如 touch {a,b}.txt 结果为a.txt b.txt。第二种：对大括号中以点点（..）分割的顺序文件列表起拓展作用，如：touch {a..d}.txt 结果为a.txt b.txt c.txt d.txt</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ls &#123;ex1,ex2&#125;.<span class="property">sh</span> </span><br><span class="line">ex1.<span class="property">sh</span> ex2.<span class="property">sh</span> </span><br><span class="line"># ls &#123;ex&#123;<span class="number">1.</span><span class="number">.3</span>&#125;,ex4&#125;.<span class="property">sh</span> </span><br><span class="line">ex1.<span class="property">sh</span> ex2.<span class="property">sh</span> ex3.<span class="property">sh</span> ex4.<span class="property">sh</span> </span><br><span class="line"># ls &#123;ex[<span class="number">1</span>-<span class="number">3</span>],ex4&#125;.<span class="property">sh</span> </span><br><span class="line">ex1.<span class="property">sh</span> ex2.<span class="property">sh</span> ex3.<span class="property">sh</span> ex4.<span class="property">sh</span></span><br></pre></td></tr></table></figure>

<p>②<strong>代码块</strong>，又被称为内部组，这个结构事实上创建了一个匿名函数 。与小括号中的命令不同，大括号内的命令不会新开一个子shell运行，即脚本余下部分仍可使用括号内变量。括号内的命令间用分号隔开，最后一个也必须有分号。{}的第一个命令和左括号之间必须要有一个空格。</p>
<p>var:−string, v   a   r   :   −   s   t   r   i   n   g    ,{var:+string},var:&#x3D;string, v   a   r   :&#x3D;   s   t   r   i   n   g    ,{var:?string}</p>
<p>①var:−string和 v   a   r   :   −   s   t   r   i   n   g     和{var:&#x3D;string}:若变量var为空，则用在命令行中用string来替换var:−string，否则变量var不为空时，则用变量var的值来替换 v   a   r   :   −   s   t   r   i   n   g     ，     否     则     变     量    v   a   r    不     为     空     时     ，     则     用     变     量    v   a   r    的     值     来     替     换{var:-string}；对于var:&#x3D;string的替换规则和 v   a   r   :&#x3D;   s   t   r   i   n   g     的     替     换     规     则     和{var:-string}是一样的，所不同之处是var:&#x3D;string若var为空时，用string替换 v   a   r   :&#x3D;   s   t   r   i   n   g     若    v   a   r    为     空     时     ，     用    s   t   r   i   n   g    替     换{var:&#x3D;string}的同时，把string赋给变量var： ${var:&#x3D;string}很常用的一种用法是，判断某个变量是否赋值，没有的话则给它赋上一个默认值。</p>
<p>② ${var:+string}的替换规则和上面的相反，即只有当var不是空的时候才替换成string，若var为空时则不替换或者说是替换成变量 var的值，即空值。(因为变量var此时为空，所以这两种说法是等价的)</p>
<p>③var:?string替换规则为：若变量var不为空，则用变量var的值来替换 v   a   r   :   ?   s   t   r   i   n   g     替     换     规     则     为     ：     若     变     量    v   a   r    不     为     空     ，     则     用     变     量    v   a   r    的     值     来     替     换{var:?string}；若变量var为空，则把string输出到标准错误中，并从脚本中退出。我们可利用此特性来检查是否设置了变量的值。</p>
<p>补充扩展：在上面这五种替换结构中string不一定是常值的，可用另外一个变量的值或是一种命令的输出。</p>
<p>模式匹配记忆方法：&#x2F;# 是去掉左边(在键盘上&#x2F;#在之左边) 之     左     边    )之右边)&#x2F;#和%中的单一符号是最小匹配，两个相同符号是最大匹配。</p>
<p>${var%pattern},${var%%pattern},${var&#x2F;#pattern},${var&#x2F;#&#x2F;#pattern}</p>
<p>第一种模式：${variable%pattern}，这种模式时，shell在variable中查找，看它是否一给的模式pattern结尾，如果是，就从命令行把variable中的内容去掉右边最短的匹配模式</p>
<p>第二种模式： ${variable%%pattern}，这种模式时，shell在variable中查找，看它是否一给的模式pattern结尾，如果是，就从命令行把variable中的内容去掉右边最长的匹配模式</p>
<p>第三种模式：${variable&#x2F;#pattern} 这种模式时，shell在variable中查找，看它是否一给的模式pattern开始，如果是，就从命令行把variable中的内容去掉左边最短的匹配模式</p>
<p>第四种模式： ${variable&#x2F;#&#x2F;#pattern} 这种模式时，shell在variable中查找，看它是否一给的模式pattern结尾，如果是，就从命令行把variable中的内容去掉右边最长的匹配模式</p>
<p>这四种模式中都不会改变variable的值，其中，只有在pattern中使用了<em>匹配符号时，%和%%，&#x2F;#和&#x2F;#&#x2F;#才有区别。结构中的pattern支持通配符，</em>表示零个或多个任意字符，?表示仅与一个任意字符匹配，[…]表示匹配中括号里面的字符，[!…]表示不匹配中括号里面的字符。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">var</span>=testcase </span><br><span class="line"># echo $var </span><br><span class="line">testcase </span><br><span class="line"># echo $&#123;<span class="keyword">var</span>%s*e&#125; </span><br><span class="line">testca </span><br><span class="line"># echo $var </span><br><span class="line">testcase </span><br><span class="line"># echo $&#123;<span class="keyword">var</span>%%s*e&#125; </span><br><span class="line">te </span><br><span class="line"># echo $&#123;<span class="keyword">var</span>#?e&#125; </span><br><span class="line">stcase </span><br><span class="line"># echo $&#123;<span class="keyword">var</span>##?e&#125; </span><br><span class="line">stcase </span><br><span class="line"># echo $&#123;<span class="keyword">var</span>##*e&#125; </span><br><span class="line"></span><br><span class="line"># echo $&#123;<span class="keyword">var</span>##*s&#125; </span><br><span class="line">e </span><br><span class="line"># echo $&#123;<span class="keyword">var</span>##test&#125; </span><br><span class="line"><span class="keyword">case</span></span><br></pre></td></tr></table></figure>

<p>var:num, v   a   r   :   n   u   m    ,{var:num1:num2},var&#x2F;pattern&#x2F;pattern, v   a   r    &#x2F;    p   a   t   t   e   r   n    &#x2F;    p   a   t   t   e   r   n    ,{var&#x2F;&#x2F;pattern&#x2F;pattern}</p>
<p>第一种模式：var:num，这种模式时，shell在var中提取第num个字符到末尾的所有字符。若num为正数，从左边0处开始；若num为负数，从右边开始提取字串，但必须使用在冒号后面加空格或一个数字或整个num加上括号，如 v   a   r   :   n   u   m     ，     这     种     模     式     时     ，    s   h   e   l   l    在    v   a   r    中     提     取     第    n   u   m    个     字     符     到     末     尾     的     所     有     字     符     。     若    n   u   m    为     正     数     ，     从     左     边    0    处     开     始     ；     若    n   u   m    为     负     数     ，     从     右     边     开     始     提     取     字     串     ，     但     必     须     使     用     在     冒     号     后     面     加     空     格     或     一     个     数     字     或     整     个    n   u   m    加     上     括     号     ，     如{var: -2}、var:1−3或 v   a   r   :   1   −   3     或{var:(-2)}。</p>
<p>第二种模式：var:num1:num2，num1是位置，num2是长度。表示从 v   a   r   :   n   u   m   1   :   n   u   m   2     ，    n   u   m   1    是     位     置     ，    n   u   m   2    是     长     度     。     表     示     从var字符串的第num1个位置开始提取长度为 n   u   m   1    个     位     置     开     始     提     取     长     度     为num2的子串。不能为负数。</p>
<p>第三种模式：${var&#x2F;pattern&#x2F;pattern}表示将var字符串的第一个匹配的pattern替换为另一个pattern。</p>
<p>第四种模式：${var&#x2F;&#x2F;pattern&#x2F;pattern}表示将var字符串中的所有能匹配的pattern替换为另一个pattern。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# <span class="keyword">var</span>=<span class="regexp">/home/</span>centos </span><br><span class="line">[root@centos ~]# echo $var </span><br><span class="line">/home/centos </span><br><span class="line">[root@centos ~]# echo $&#123;<span class="attr">var</span>:<span class="number">5</span>&#125; </span><br><span class="line">/centos </span><br><span class="line">[root@centos ~]# echo $&#123;<span class="attr">var</span>: -<span class="number">6</span>&#125; </span><br><span class="line">centos </span><br><span class="line">[root@centos ~]# echo $&#123;<span class="attr">var</span>:(-<span class="number">6</span>)&#125; </span><br><span class="line">centos </span><br><span class="line">[root@centos ~]# echo $&#123;<span class="attr">var</span>:<span class="number">1</span>:<span class="number">4</span>&#125; </span><br><span class="line">home </span><br><span class="line">[root@centos ~]# echo $&#123;<span class="keyword">var</span>/o/h&#125; </span><br><span class="line">/hhme/centos </span><br><span class="line">[root@centos ~]# echo $&#123;<span class="keyword">var</span><span class="comment">//o/h&#125; </span></span><br><span class="line">/hhme/cenths</span><br></pre></td></tr></table></figure>

<h2 id="四、符号-后的括号"><a href="#四、符号-后的括号" class="headerlink" title="四、符号$后的括号"></a>四、符号$后的括号</h2><p>（1）${a} 变量a的值, 在不引起歧义的情况下可以省略大括号。</p>
<p>（2）(cmd)命令替换，和‘cmd‘效果相同，结果为shell命令cmd的输，过某些Shell版本不支持 (   c   m   d   )    命     令     替     换     ，     和    ‘   c   m   d   ‘    效     果     相     同     ，     结     果     为    s   h   e   l   l    命     令    c   m   d    的     输     ，     过     某     些    S   h   e   l   l    版     本     不     支     持()形式的命令替换, 如tcsh。</p>
<p>（3）$((expression)) 和<code>exprexpression</code>效果相同, 计算数学表达式exp的数值, 其中exp只要符合C语言的运算规则即可, 甚至三目运算符和逻辑表达式都可以计算。</p>
<h2 id="五、使用"><a href="#五、使用" class="headerlink" title="五、使用"></a>五、使用</h2><p>（1）单小括号，(cmd1;cmd2;cmd3) 新开一个子shell顺序执行命令cmd1,cmd2,cmd3, 各命令之间用分号隔开, 最后一个命令后可以没有分号。</p>
<p>（2）单大括号，{ cmd1;cmd2;cmd3;} 在当前shell顺序执行命令cmd1,cmd2,cmd3, 各命令之间用分号隔开, 最后一个命令后必须有分号, 第一条命令和左括号之间必须用空格隔开。<br>对{}和()而言, 括号中的重定向符只影响该条命令， 而括号外的重定向符影响到括号中的所有命令。</p>
<p>原文地址：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/Q--T/archive/2017/09/06/7486872.html">http://www.cnblogs.com/Q–T/archive/2017/09/06/7486872.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2018/07/28/%E5%9B%BE%E7%81%B5%E6%9C%BA%E7%9A%84%E9%80%BB%E8%BE%91%E7%AD%89%E4%BB%B7%E5%BD%A2%E5%BC%8F%E2%80%94%E2%80%94lambda%E6%BC%94%E7%AE%97%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2018/07/28/%E5%9B%BE%E7%81%B5%E6%9C%BA%E7%9A%84%E9%80%BB%E8%BE%91%E7%AD%89%E4%BB%B7%E5%BD%A2%E5%BC%8F%E2%80%94%E2%80%94lambda%E6%BC%94%E7%AE%97%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">图灵机的逻辑等价形式——lambda演算简介</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-07-28 17:07:31" itemprop="dateCreated datePublished" datetime="2018-07-28T17:07:31+08:00">2018-07-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">计算机科学基础</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="译者述"><a href="#译者述" class="headerlink" title="译者述"></a>译者述</h1><p>才疏学浅，非数学专业，翻译尽量尊重原文，如有纰漏，海涵。</p>
<h1 id="论文摘要"><a href="#论文摘要" class="headerlink" title="论文摘要"></a>论文摘要</h1><p>这篇论文是一篇简短易懂的lambda演算介绍。λ-calculus（lambda演算）是Alonzo Church开创，最初是作为研究数学函数的可计算性的相关属性的工具，随着它的流行，其逐渐成为函数编程语言家族强有力的理论基础。这篇简介展示了利用lambda演算如何构建算数和逻辑的数学计算，以及如何定义递归函数（尽管lambda演算子中的函数是匿名的，因此它们不能被显示引用，我们仍然可以定义递归函数）。</p>
<h1 id="1-定义Definition"><a href="#1-定义Definition" class="headerlink" title="1 定义Definition"></a>1 定义Definition</h1><p>lambda演算子可以说是世界上最小的通用编程语言。lambda演算子由一个单一转换规则(变量替换，通常被叫做β-conversion，β变换)和一个单一函数定义系统构成。它在1930年代被Alonzo Church作为一个方法引入有效计算能力的概念的形式化中。lambda演算子是通用的，是因为任意可计算函数可以使用此形式表达和求值。因此它等价于图灵机（这也是为什么我费劲翻译原文的原因）。尽管如此，lambda演算子强调的是符号变换规则的使用，却并不关心实际机器是如何实现这些规则的。这是一个更接近软件而不是硬件的方法。</p>
<p>lambda演算子的核心概念是“表达式”（“expression”）。一个“名字”，也被叫做“变量”，是一个标示符，它可以是任意字母a, b, c… 一个表达式可能只是一个名字或者可能是一个函数（function）。函数使用希腊字母λ来来表示函数变量的名字。函数体（body）指定变量名如何排列。身份函数（The identity function），例如：字符串(λx.x）可以代表一个身份函数，字符串中的“λx”告诉我们函数的变量是“x”，“x”是被函数体不做任何改变的返回了。</p>
<p>函数可以被其他的函数使用。比如，函数A被用在了函数B中，可以写为“AB”的形式。注意在本文中，大写的字母被专门用来表示<strong>函数</strong>。实际上，Lambda演算中任何元素都可是函数，就连数字或者逻辑值都使用可以相互作用的函数来表示，它们是通过符号的字符串转换成另一种符号的字符串达到目的的。所以Lambda演算中没有类型一说，任何函数可以作用于其他函数。开发者的责任是保证计算指令的合理性。</p>
<p>表达式被第归的定义如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt; expression &gt; := &lt; name &gt;|&lt; <span class="keyword">function</span> &gt;|&lt; application &gt;</span><br><span class="line">&lt; <span class="keyword">function</span> &gt; := λ &lt; name &gt; . &lt; expression &gt;</span><br><span class="line">&lt; application &gt; := &lt; expression &gt;&lt; expression &gt;</span><br><span class="line"></span><br><span class="line">译文形式</span><br><span class="line">&lt;表达式&gt; := &lt;标识符&gt;|&lt;函数&gt;|&lt;应用&gt;       </span><br><span class="line">&lt;函数&gt; := λ&lt;标识符&gt; . &lt;表达式&gt;</span><br><span class="line">&lt;应用&gt; := &lt;表达式&gt;&lt;表达式&gt;</span><br><span class="line">译者注：应用(application )即给函数一个(实际)参数进行求值</span><br></pre></td></tr></table></figure>

<p>表达式可以使用括号来包裹以达到清晰表示的目的，比如“E”为一个表达式，”(E)“是等效的（译者加了引号）。另外，这门语言中仅有的两个关键字是”λ “和”.”。为了避免将带括号的表达式混淆，我们约定：函数应用从左边开始关联（左结合），也就是下方的组合表达式：</p>
<p>E 1E 2E 3 . . . E n  可以被下面连续表达式所表示：  (…((E 1E 2)E 3) . . . E n)</p>
<p>从 λ表达式的定义可见，一种优雅的函数表现形式是之前出现过的的字符串，带括号或者不带括号：</p>
<p>λx.x ≡ (λx.x)</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="docs/2018/07/28/%E5%9B%BE%E7%81%B5%E6%9C%BA%E7%9A%84%E9%80%BB%E8%BE%91%E7%AD%89%E4%BB%B7%E5%BD%A2%E5%BC%8F%E2%80%94%E2%80%94lambda%E6%BC%94%E7%AE%97%E7%AE%80%E4%BB%8B/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2018/07/21/Appium%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%90%86%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2018/07/21/Appium%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%90%86%E8%A7%A3/" class="post-title-link" itemprop="url">Appium的实现理解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-07-21 11:54:10" itemprop="dateCreated datePublished" datetime="2018-07-21T11:54:10+08:00">2018-07-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">自动化测试</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文转自：<a target="_blank" rel="noopener" href="https://testerhome.com/topics/7352">TesterHome的文章</a></p>
<p>本文针对appium(version:1.6.4-beta)「比较粗糙」的介绍了下它的源码的实现流程。难免有不妥支出，有任何问题，可直接沟通交流。<br>（本文中没有相应的测试）</p>
<h2 id="Appium的架构"><a href="#Appium的架构" class="headerlink" title="Appium的架构"></a>Appium的架构</h2><p><a target="_blank" rel="noopener" href="https://myersguo.github.io/public/appium-packages.png"></a><br><img data-src="docs/images/thub.io-public-appium-packages-.png" alt="appium"><br><a target="_blank" rel="noopener" href="https://myersguo.github.io/public/images/appium_ios.png"></a></p>
<p><img data-src="docs/images/thub.io-public-images-appium_ios-.png" alt="appium"><br><a target="_blank" rel="noopener" href="https://myersguo.github.io/public/images/apium_android.png"></a></p>
<p><img data-src="docs/images/thub.io-public-images-apium_android-.png" alt="appium"></p>
<p>下载appium的源码，并安装依赖：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone <span class="attr">https</span>:<span class="comment">//github.com/appium/appium.git</span></span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p>启动appium:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node .</span><br></pre></td></tr></table></figure>

<p>这个启动命令实际是执行的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node build\main.<span class="property">js</span></span><br></pre></td></tr></table></figure>
<p>(package.json中指定了main入口)：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"> <span class="string">&quot;main&quot;</span>: <span class="string">&quot;./build/lib/main.js&quot;</span>,</span><br><span class="line">&lt;!-- more --&gt;</span><br><span class="line">  <span class="string">&quot;bin&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;appium&quot;</span>: <span class="string">&quot;./build/lib/main.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>&#x2F;build&#x2F;main.js是由&#x2F;lib&#x2F;main.js经babel翻译后的结果，所以，我们来看下&#x2F;lib&#x2F;main.js来理解appium的流程。<br>(备注：由于appium源码执行都是执行的编译后的方法，即build目录下，因此如果你想要调试进行测试，需要在各个模块build目录下更改调试,如果更改源码，需要gulp transpile进行编译)</p>
<p><a target="_blank" rel="noopener" href="https://myersguo.github.io/public/images/appium_uml.png"></a><br><img data-src="docs/images/thub.io-public-images-appium_uml-.png" alt="appium uml"></p>
<p>appium server端实现了HTTP REST API接口，将client端发来的API请求，解析，发送给执行端。apium server,以及其他的driver（android,ios）都实现了basedriver类。basedriver定义了session的创建，命令的执行方式(cmd执行)。</p>
<p>appium server(appium driver)大致的流程为：</p>
<p>我们看一下<a target="_blank" rel="noopener" href="https://github.com/appium/appium/blob/master/lib/main.js">appium server的源码</a>实现。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; server <span class="keyword">as</span> baseServer &#125; <span class="keyword">from</span> <span class="string">&#x27;appium-base-driver&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> getAppiumRouter <span class="keyword">from</span> <span class="string">&#x27;./appium&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span> (args = <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="comment">//解析参数</span></span><br><span class="line">  <span class="keyword">let</span> parser = <span class="title function_">getParser</span>();</span><br><span class="line">  <span class="keyword">let</span> throwInsteadOfExit = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (args) &#123;</span><br><span class="line">    args = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, <span class="title function_">getDefaultArgs</span>(), args);</span><br><span class="line">    <span class="keyword">if</span> (args.<span class="property">throwInsteadOfExit</span>) &#123;</span><br><span class="line">      throwInsteadOfExit = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">delete</span> args.<span class="property">throwInsteadOfExit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    args = parser.<span class="title function_">parseArgs</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">logsinkInit</span>(args);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">preflightChecks</span>(parser, args, throwInsteadOfExit);</span><br><span class="line">  <span class="comment">//输出欢迎信息</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">logStartupInfo</span>(parser, args);</span><br><span class="line">  <span class="comment">//注册接口路由,参见(appium-base-driver\lib\jsonwp\Mjsonwp.js)</span></span><br><span class="line">  <span class="keyword">let</span> router = <span class="title function_">getAppiumRouter</span>(args);</span><br><span class="line">  <span class="comment">//express server类(appium-base-driver\lib\express\server.js)</span></span><br><span class="line">  <span class="comment">//将注册的路由，传递给express注册.</span></span><br><span class="line">  <span class="keyword">let</span> server = <span class="keyword">await</span> <span class="title function_">baseServer</span>(router, args.<span class="property">port</span>, args.<span class="property">address</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//是否为appium grid的node节点</span></span><br><span class="line">    <span class="keyword">if</span> (args.<span class="property">nodeconfig</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">registerNode</span>(args.<span class="property">nodeconfig</span>, args.<span class="property">address</span>, args.<span class="property">port</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">await</span> server.<span class="title function_">close</span>();</span><br><span class="line">    <span class="keyword">throw</span> err;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  process.<span class="title function_">once</span>(<span class="string">&#x27;SIGINT&#x27;</span>, <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`Received SIGINT - shutting down`</span>);</span><br><span class="line">    <span class="keyword">await</span> server.<span class="title function_">close</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  process.<span class="title function_">once</span>(<span class="string">&#x27;SIGTERM&#x27;</span>, <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">`Received SIGTERM - shutting down`</span>);</span><br><span class="line">    <span class="keyword">await</span> server.<span class="title function_">close</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">logServerPort</span>(args.<span class="property">address</span>, args.<span class="property">port</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> server;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment">//路由</span></span><br><span class="line"><span class="comment">//appium.js,下面会讲解路由解析</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getAppiumRouter</span> (args) &#123;</span><br><span class="line">  <span class="keyword">let</span> appium = <span class="keyword">new</span> <span class="title class_">AppiumDriver</span>(args);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">routeConfiguringFunction</span>(appium);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="URL路由解析"><a href="#URL路由解析" class="headerlink" title="URL路由解析"></a>URL路由解析</h4><p>上面说道，路由注册。所有支持的请求都<a target="_blank" rel="noopener" href="https://github.com/appium/appium-base-driver/blob/master/lib/mjsonwp/routes.js">METHOD_MAP</a>这个全局变量里面。它是一个path:commd的对象集合。路由执行过程是：</p>
<p>我们来详细看一下(routeConfiguringFunction)到底做了什么(appium-base-driver\lib\mjsonwp\Mjsonwp.js):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">routeConfiguringFunction</span> (driver) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!driver.<span class="property">sessionExists</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Drivers used with MJSONWP must implement `sessionExists`&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!(driver.<span class="property">executeCommand</span> || driver.<span class="property">execute</span>)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Drivers used with MJSONWP must implement `executeCommand` or `execute`&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// return a function which will add all the routes to the driver</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">app</span>) &#123;</span><br><span class="line">    <span class="comment">//[METHOD_MAP](#route_config),是所有的路由配置,key为path,value为method的数组</span></span><br><span class="line">   <span class="comment">//对METHOD_MAP的配置进行绑定</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> [path, methods] <span class="keyword">of</span> _.<span class="title function_">toPairs</span>(<span class="variable constant_">METHOD_MAP</span>)) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> [method, spec] <span class="keyword">of</span> _.<span class="title function_">toPairs</span>(methods)) &#123;</span><br><span class="line">        <span class="comment">// set up the express route handler</span></span><br><span class="line">        <span class="title function_">buildHandler</span>(app, method, path, spec, driver, <span class="title function_">isSessionCommand</span>(spec.<span class="property">command</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//路由绑定</span></span><br><span class="line"><span class="comment">//示例：</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  &#x27;/wd/hub/session&#x27;: &#123;</span></span><br><span class="line"><span class="comment">    POST: &#123;command: &#x27;createSession&#x27;, payloadParams: &#123;required: [&#x27;desiredCapabilities&#x27;], optional: [&#x27;requiredCapabilities&#x27;, &#x27;capabilities&#x27;]&#125;&#125;</span></span><br><span class="line"><span class="comment">  &#125;,</span></span><br><span class="line"><span class="comment">即:</span></span><br><span class="line"><span class="comment">method: POST</span></span><br><span class="line"><span class="comment">path: /wd/hub/session</span></span><br><span class="line"><span class="comment">spec: array</span></span><br><span class="line"><span class="comment">driver: appium</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">buildHandler</span> (app, method, path, spec, driver, isSessCmd) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="title function_">asyncHandler</span> = <span class="keyword">async</span> (<span class="params">req, res</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> jsonObj = req.<span class="property">body</span>;</span><br><span class="line">    <span class="keyword">let</span> httpResBody = &#123;&#125;;</span><br><span class="line">    <span class="keyword">let</span> httpStatus = <span class="number">200</span>;</span><br><span class="line">    <span class="keyword">let</span> newSessionId;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">//判断是否是创建session命令(包含createSession,getStatus,getSessions) </span></span><br><span class="line">      <span class="comment">//是否有session</span></span><br><span class="line">      <span class="keyword">if</span> (isSessCmd &amp;&amp; !driver.<span class="title function_">sessionExists</span>(req.<span class="property">params</span>.<span class="property">sessionId</span>)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> errors.<span class="title class_">NoSuchDriverError</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//设置了代理则透传</span></span><br><span class="line">      <span class="keyword">if</span> (isSessCmd &amp;&amp; <span class="title function_">driverShouldDoJwpProxy</span>(driver, req, spec.<span class="property">command</span>)) &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">doJwpProxy</span>(driver, req, res);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//命令是否支持</span></span><br><span class="line">      <span class="keyword">if</span> (!spec.<span class="property">command</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> errors.<span class="title class_">NotImplementedError</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//POST参数检查 </span></span><br><span class="line">      <span class="keyword">if</span> (spec.<span class="property">payloadParams</span> &amp;&amp; spec.<span class="property">payloadParams</span>.<span class="property">wrap</span>) &#123;</span><br><span class="line">        jsonObj = <span class="title function_">wrapParams</span>(spec.<span class="property">payloadParams</span>, jsonObj);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (spec.<span class="property">payloadParams</span> &amp;&amp; spec.<span class="property">payloadParams</span>.<span class="property">unwrap</span>) &#123;</span><br><span class="line">        jsonObj = <span class="title function_">unwrapParams</span>(spec.<span class="property">payloadParams</span>, jsonObj);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">checkParams</span>(spec.<span class="property">payloadParams</span>, jsonObj);</span><br><span class="line">      <span class="comment">//构造参数</span></span><br><span class="line">      <span class="keyword">let</span> args = <span class="title function_">makeArgs</span>(req.<span class="property">params</span>, jsonObj, spec.<span class="property">payloadParams</span> || []);</span><br><span class="line">      <span class="keyword">let</span> driverRes;</span><br><span class="line">      <span class="keyword">if</span> (validators[spec.<span class="property">command</span>]) &#123;</span><br><span class="line">        validators[spec.<span class="property">command</span>](...args);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//!!!!执行命令</span></span><br><span class="line">      <span class="comment">//捕获返回值</span></span><br><span class="line">      <span class="keyword">if</span> (driver.<span class="property">executeCommand</span>) &#123;</span><br><span class="line">        driverRes = <span class="keyword">await</span> driver.<span class="title function_">executeCommand</span>(spec.<span class="property">command</span>, ...args);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        driverRes = <span class="keyword">await</span> driver.<span class="title function_">execute</span>(spec.<span class="property">command</span>, ...args);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// unpack createSession response</span></span><br><span class="line">      <span class="keyword">if</span> (spec.<span class="property">command</span> === <span class="string">&#x27;createSession&#x27;</span>) &#123;</span><br><span class="line">        newSessionId = driverRes[<span class="number">0</span>];</span><br><span class="line">        driverRes = driverRes[<span class="number">1</span>];</span><br><span class="line">      &#125;</span><br><span class="line">      ...</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      [httpStatus, httpResBody] = <span class="title function_">getResponseForJsonwpError</span>(actualErr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (_.<span class="title function_">isString</span>(httpResBody)) &#123;</span><br><span class="line">      res.<span class="title function_">status</span>(httpStatus).<span class="title function_">send</span>(httpResBody);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (newSessionId) &#123;</span><br><span class="line">        httpResBody.<span class="property">sessionId</span> = newSessionId;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        httpResBody.<span class="property">sessionId</span> = req.<span class="property">params</span>.<span class="property">sessionId</span> || <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      res.<span class="title function_">status</span>(httpStatus).<span class="title function_">json</span>(httpResBody);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// add the method to the app</span></span><br><span class="line">  app[method.<span class="title function_">toLowerCase</span>()](path, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    B.<span class="title function_">resolve</span>(<span class="title function_">asyncHandler</span>(req, res)).<span class="title function_">done</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/appium/appium/blob/master/lib/appium.js">lib\appium.js</a></p>
<p>上面说了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appium server</span><br></pre></td></tr></table></figure>
<p>已经启动了，第一件事情，当然是创建<em><strong>session</strong></em>,然后把command交给这个session的不同driver去执行了。<br>appium先根据caps进行session创建（</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getDriverForCaps</span><br></pre></td></tr></table></figure>
<p>）,然后保存InnerDriver到当前session,以后每次执行命令(executeDCommand)会判断是否为appiumdriver的命令，不是则转给相应的driver去执行命令(android,ios等)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> createSession (caps, reqCaps) &#123;</span><br><span class="line">  caps = _.<span class="title function_">defaults</span>(_.<span class="title function_">clone</span>(caps), <span class="variable language_">this</span>.<span class="property">args</span>.<span class="property">defaultCapabilities</span>);</span><br><span class="line">  <span class="keyword">let</span> <span class="title class_">InnerDriver</span> = <span class="variable language_">this</span>.<span class="title function_">getDriverForCaps</span>(caps);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">printNewSessionAnnouncement</span>(<span class="title class_">InnerDriver</span>, caps);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">args</span>.<span class="property">sessionOverride</span> &amp;&amp; !!<span class="variable language_">this</span>.<span class="property">sessions</span> &amp;&amp; _.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">sessions</span>).<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> id <span class="keyword">of</span> _.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">sessions</span>)) &#123;</span><br><span class="line">      log.<span class="title function_">info</span>(<span class="string">`    Deleting session &#x27;<span class="subst">$&#123;id&#125;</span>&#x27;`</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">deleteSession</span>(id);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (ign) &#123;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> curSessions;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    curSessions = <span class="variable language_">this</span>.<span class="title function_">curSessionDataForDriver</span>(<span class="title class_">InnerDriver</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> errors.<span class="title class_">SessionNotCreatedError</span>(e.<span class="property">message</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> d = <span class="keyword">new</span> <span class="title class_">InnerDriver</span>(<span class="variable language_">this</span>.<span class="property">args</span>);</span><br><span class="line">  <span class="keyword">let</span> [innerSessionId, dCaps] = <span class="keyword">await</span> d.<span class="title function_">createSession</span>(caps, reqCaps, curSessions);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sessions</span>[innerSessionId] = d;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">attachUnexpectedShutdownHandler</span>(d, innerSessionId);</span><br><span class="line">  d.<span class="title function_">startNewCommandTimeout</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [innerSessionId, dCaps];</span><br><span class="line">&#125;</span><br><span class="line">  <span class="keyword">async</span> executeCommand (cmd, ...args) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isAppiumDriverCommand</span>(cmd)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">super</span>.<span class="title function_">executeCommand</span>(cmd, ...args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> sessionId = args[args.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">sessions</span>[sessionId].<span class="title function_">executeCommand</span>(cmd, ...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在basedriver中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">executeDCommand</span><br></pre></td></tr></table></figure>
<p>其实是调用类的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd</span><br></pre></td></tr></table></figure>
<p>定义的方法。</p>
<p>我们以</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uiautomator2</span><br></pre></td></tr></table></figure>
<p>(\appium-uiautomator2-driver\build\lib)为例看一下它的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd</span><br></pre></td></tr></table></figure>
<p>执行情况。</p>
<p>以</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getAttribute</span><br></pre></td></tr></table></figure>
<p>(appium-uiautomator2-driver\lib\commands\element.js)为例说明：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">commands.<span class="property">getAttribute</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">attribute, elementId</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">uiautomator2</span>.<span class="property">jwproxy</span>.<span class="title function_">command</span>(<span class="string">`/element/<span class="subst">$&#123;elementId&#125;</span>/attribute/<span class="subst">$&#123;attribute&#125;</span>`</span>, <span class="string">&#x27;GET&#x27;</span>, &#123;&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><em><strong>appium 通过adb forward将主机的HTTP请求转发到设备中</strong></em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">adb</span>.<span class="title function_">forwardPort</span>(<span class="variable language_">this</span>.<span class="property">opts</span>.<span class="property">systemPort</span>, <span class="variable constant_">DEVICE_PORT</span>);</span><br><span class="line"><span class="comment">//主机端口号:8200,8299</span></span><br><span class="line"><span class="comment">//设备端口号：6790</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2018/07/21/spotbugs%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%9A%84bug%E6%8F%8F%E8%BF%B0%E6%A6%82%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2018/07/21/spotbugs%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%9A%84bug%E6%8F%8F%E8%BF%B0%E6%A6%82%E8%BF%B0/" class="post-title-link" itemprop="url">spotbugs官方文档的bug描述概述</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-07-21 11:53:11" itemprop="dateCreated datePublished" datetime="2018-07-21T11:53:11+08:00">2018-07-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/Java%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">Java编程语言</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>spotbugs已经取代和继承了曾今的findbugs，已经按个人理解对bug的类别进行排序，重要的在前，不重要的在后。bug描述里的废话被我删了。<br>文档参考：<a target="_blank" rel="noopener" href="http://spotbugs.readthedocs.io/en/latest/bugDescriptions.html###">http://spotbugs.readthedocs.io/en/latest/bugDescriptions.html/#/#/#</a><br><img data-src="docs/images/dn.net-20180205154612867-watermark-2-text-aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2luZGFuY2hhb3M=-font-5a6L5L2T-fontsize-400-fill-I0JBQkFCMA==-dissolve-70-gravity-SouthEast.png" alt="这里写图片描述"></p>
<p>code that is vulnerable to attacks from untrusted code<br>代码有漏洞，可能被攻击。<br>必须要重要。</p>
<p>code flaws having to do with threads, locks, and volatiles<br>可能导致线程、死锁及不稳定的<br>必须很重要。</p>
<p>code that is not necessarily incorrect but may be inefficient<br>可能代码正确但是性能会有问题的地方<br>必须很重要。</p>
<p>A use of untrusted input in a way that could create a remotely exploitable security vulnerability.<br>非安全输入，可导致远程利用的安全漏洞。<br>很重要</p>
<p>Violations of recommended and essential coding practice. Examples include hash code and equals problems, cloneable idiom, dropped exceptions, Serializable problems, and misuse of finalize.</p>
<p>不是特别重要。</p>
<p>Probable bug - an apparent coding mistake resulting in code that was probably not what the developer intended.<br>逻辑大概就是：这个地方的正确性值得商榷，你最好来确认下会不会潜在的出现不是你预期的行为。<br>不是特别重要。</p>
<p>Experimental and not fully vetted bug patterns<br>看官方文档里的子bug类别描述，大概意思是说老兄，这个地方本程序查不出来，要么是类太大了之类，bug匹配模式不太适用，你自己再确认下。<br>不太重要。</p>
<p>code that is confusing, anomalous, or written in a way that leads itself to errors. Examples include dead local stores, switch fall through, unconfirmed casts, and redundant null check of value known to be null. More false positives accepted.<br>不是很重要，看公司要求。</p>
<p>code flaws having to do with internationalization and locale<br>代码没有遵守必要的本地化和国际化</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="docs/2018/07/21/spotbugs%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%9A%84bug%E6%8F%8F%E8%BF%B0%E6%A6%82%E8%BF%B0/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2018/07/21/%E5%BE%AE%E4%BF%A1%E9%89%B4%E6%9D%83%E7%8E%AF%E5%A2%83%E7%9A%84%E5%86%85%E7%BD%91%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2018/07/21/%E5%BE%AE%E4%BF%A1%E9%89%B4%E6%9D%83%E7%8E%AF%E5%A2%83%E7%9A%84%E5%86%85%E7%BD%91%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">微信鉴权环境的内网部署方案</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-07-21 11:52:54" itemprop="dateCreated datePublished" datetime="2018-07-21T11:52:54+08:00">2018-07-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index"><span itemprop="name">Linux管理维护</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文适用范围：<br>一、微信开发相关业务，涉及到微信第三方开发者鉴权、公众号鉴权业务；<br>二、没有固定IP的内网部署环境，尤其是测试环境。IP经常变动，导致鉴权失效。<br>三、本文写作时尚未解决主动定时拉取token的问题（跳板机的正向代理）</p>
<h1 id="开放平台主动推送ticket到内网的解决办法"><a href="#开放平台主动推送ticket到内网的解决办法" class="headerlink" title="开放平台主动推送ticket到内网的解决办法"></a>开放平台主动推送ticket到内网的解决办法</h1><p>解决方案核心思路：<br>使用带有固定IP的外网服务器，此处称：跳板服务器，作为内网服务器的端口转发服务器。和鉴权有关的域名解析到该服务器。<br>使用到的工具为nginx，具体的操作自己百度。<br>脚本实现：<br>1、内网一个服务器定时，30分钟获取一次外部IP地址，推送到跳板服务器的文本当中；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>bash</span><br><span class="line">#设置环境变量</span><br><span class="line">source /etc/profile</span><br><span class="line">curl <span class="attr">http</span>:\/\/www.<span class="property">baidu</span>.<span class="property">com</span>\/s?wd\=ip|grep <span class="string">&quot;本机IP&quot;</span>|awk -F <span class="string">&quot;&lt;/span&gt;&quot;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>|awk -F <span class="string">&quot;;&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> &gt; ip.<span class="property">txt</span></span><br><span class="line">ip_local=<span class="string">`cat ip.txt`</span></span><br><span class="line">sshpass -p $&#123;<span class="variable constant_">PASSWORD</span>&#125; ssh -p $&#123;<span class="variable constant_">PORT</span>&#125;-tt root@<span class="variable constant_">IP</span> <span class="string">&quot;echo $&#123;ip_local&#125; &gt; ip.txt&quot;</span></span><br></pre></td></tr></table></figure>

<p>获取本地IP的方法不止一种，我提供的是最复杂的。<br>2、跳板服务器定时任务，30分钟获取一次文本中IP地址情况，同nginx中的配置进行比较，不相等则批量替换IP地址后reload配置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>bash</span><br><span class="line">#设置环境变量</span><br><span class="line">source /etc/profile</span><br><span class="line">newIP=<span class="string">`sed -n 1p /home/user/ip.txt`</span></span><br><span class="line">echo $&#123;newIP&#125;</span><br><span class="line">temp_old_IP=<span class="string">`grep proxy_pass /etc/nginx/conf.d/mk.conf |tail -n 1|awk -F &#x27;:&#x27; &#x27;&#123;print $2&#125;&#x27;`</span></span><br><span class="line">#echo $temp_old_IP</span><br><span class="line">old_IP=$&#123;<span class="attr">temp_old_IP</span>:<span class="number">2</span>:$&#123;#temp_old_IP&#125;&#125;</span><br><span class="line">#echo $&#123;old_IP&#125;</span><br><span class="line"><span class="keyword">if</span> [[ $&#123;newIP&#125; != $&#123;old_IP&#125; ]] &amp;&amp; [[ -n $&#123;newIP&#125; ]]</span><br><span class="line">then</span><br><span class="line">        sed -i <span class="string">&quot;s/$&#123;old_IP&#125;/$&#123;newIP&#125;/g&quot;</span> /etc/nginx/conf.<span class="property">d</span>/mk-internal-T*conf</span><br><span class="line">&lt;!-- more --&gt;</span><br><span class="line">        cd /usr/sbin/</span><br><span class="line">        ./nginx -s reload</span><br><span class="line">        echo <span class="string">`date`</span> <span class="string">&#x27;New IP: &#x27;</span> $&#123;newIP&#125; &gt;&gt; <span class="regexp">/home/u</span>ser/ip_logs.<span class="property">log</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        echo <span class="string">`date`</span> <span class="string">&#x27;IP No Change: &#x27;</span> $&#123;old_IP&#125; &gt;&gt; <span class="regexp">/home/u</span>ser/ip_logs.<span class="property">log</span></span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>需要注意的是：<br>1、内网路由器需支持虚拟服务器的配置，将路由器的外网端口映射给内网服务器。<br>2、使用nginx的跳板服务器，需要<strong>定时</strong>获取到公司外部的IP地址变化，如发生变化则reload nginx的服务。我写了一个shell脚本，在内部测试服务器上运行，30分钟侦测一次外网IP，并将IP输入到跳板服务器上。跳板服务器，也定时去取这个IP并和nginx内的IP对比，不等就替换reload。<br>3、内网服务器也可以部署nginx再转一次，做到内网一个端口多次使用，前提是跳板服务器过去的请求带上域名。<br>4、如果链接带https，这个方案也是可行的。这里有一个坑，一般tomcat部署https，会把tomcat服务器端口在配置中redirect给443端口。这时候，就需要把这个redirect从tomcat配置中移走，让firewall去转发，否则从跳板过来的请求，会陷入死循环的redirect。（跳版443端口接收到请求，redirect给内网的外网IP—-&gt;映射给内网的tomcat端口—-&gt;redirect给tomcat的端口，如果tomcat再redirect给443，则会回到链路请求的开始，直到达到请求的限制次数）。</p>
<h1 id="内网主动拉取token设置IP白名单的问题"><a href="#内网主动拉取token设置IP白名单的问题" class="headerlink" title="内网主动拉取token设置IP白名单的问题"></a>内网主动拉取token设置IP白名单的问题</h1><p>最合理的解决方案自然是最底层的，服务器请求<a target="_blank" rel="noopener" href="https://open.weixin.qq.com/">https://open.weixin.qq.com/</a>的数据包走代理服务器（拥有固定IP），但是这种办法只是理论上，我们技术团队目前并没有找到具体如何操作（限于透出产出比较低）。<br>我基于能力范围，找到IP变动导致的微信开放平台手动添加白名单的替代方法。<br>思路：webdriver驱动浏览器，自动录入ip白名单。<br>实现代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"># -*- <span class="attr">coding</span>: utf-<span class="number">8</span> -*-</span><br><span class="line"># chromedriver同级目录下</span><br><span class="line"><span class="keyword">from</span> splinter <span class="keyword">import</span> <span class="title class_">Browser</span></span><br><span class="line"><span class="keyword">import</span> datetime, time</span><br><span class="line"><span class="keyword">from</span> urllib2 <span class="keyword">import</span> urlopen</span><br><span class="line"><span class="keyword">import</span> schedule</span><br><span class="line"></span><br><span class="line">def <span class="title function_">changIP</span>(ip):</span><br><span class="line">    browser = <span class="title class_">Browser</span>(<span class="string">&#x27;chrome&#x27;</span>, )</span><br><span class="line">    browser.<span class="property">driver</span>.<span class="title function_">set_window_size</span>(<span class="number">1600</span>, <span class="number">1000</span>)</span><br><span class="line">    browser.<span class="title function_">visit</span>(<span class="string">&quot;https://open.weixin.qq.com/&quot;</span>)</span><br><span class="line">    browser.<span class="title function_">find_by_id</span>(<span class="string">&quot;loginBarBt&quot;</span>).<span class="title function_">click</span>()</span><br><span class="line">    browser.<span class="title function_">find_by_name</span>(<span class="string">&quot;account&quot;</span>).<span class="title function_">fill</span>(u<span class="string">&quot;$&#123;account&#125;&quot;</span>)</span><br><span class="line">    browser.<span class="title function_">find_by_name</span>(<span class="string">&quot;passwd&quot;</span>).<span class="title function_">fill</span>(u<span class="string">&quot;$&#123;password&#125;&quot;</span>)</span><br><span class="line">    browser.<span class="title function_">find_by_text</span>(<span class="string">&quot;登录&quot;</span>)[<span class="number">2</span>].<span class="title function_">click</span>()</span><br><span class="line"></span><br><span class="line">    # <span class="variable constant_">MK</span>内网<span class="variable constant_">T6</span></span><br><span class="line">    browser.<span class="title function_">find_by_xpath</span>(<span class="string">&quot;//*[@data-param=&#x27;appid=wxfb1fb56deb2664a8&#x27;]&quot;</span>).<span class="title function_">click</span>()</span><br><span class="line">    time.<span class="title function_">sleep</span>(<span class="number">2</span>)</span><br><span class="line">    browser.<span class="property">windows</span>.<span class="property">current</span> = browser.<span class="property">windows</span>[<span class="number">1</span>]</span><br><span class="line">    n = <span class="number">200</span></span><br><span class="line">    <span class="keyword">while</span> <span class="title class_">True</span>:</span><br><span class="line">        browser.evaluate_script(<span class="string">&#x27;window.scrollTo(0,%d)&#x27;</span> % n)</span><br><span class="line">        <span class="keyword">if</span> browser.<span class="title function_">is_element_present_by_id</span>(<span class="string">&#x27;js_fastmodify_ip&#x27;</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    browser.<span class="title function_">find_by_id</span>(<span class="string">&#x27;js_fastmodify_ip&#x27;</span>).<span class="property">first</span>.<span class="title function_">click</span>()</span><br><span class="line">    time.<span class="title function_">sleep</span>(<span class="number">1</span>)</span><br><span class="line">    browser.<span class="title function_">find_by_xpath</span>(<span class="string">&quot;/html/body/div[6]/div/div[2]/textarea&quot;</span>).<span class="title function_">fill</span>(u<span class="string">&quot;%s&quot;</span> % ip)</span><br><span class="line">    browser.<span class="title function_">find_by_text</span>(<span class="string">&#x27;确定&#x27;</span>).<span class="title function_">click</span>()</span><br><span class="line">    time.<span class="title function_">sleep</span>(<span class="number">2</span>)</span><br><span class="line">    # 关闭当前标签页</span><br><span class="line">    browser.<span class="property">driver</span>.<span class="title function_">close</span>()</span><br><span class="line">    browser.<span class="property">windows</span>.<span class="property">current</span> = browser.<span class="property">windows</span>[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    # 退出浏览器</span><br><span class="line">    browser.<span class="title function_">quit</span>()</span><br><span class="line">#定时任务</span><br><span class="line">def <span class="title function_">job</span>():</span><br><span class="line">    new_ip = <span class="title function_">urlopen</span>(<span class="string">&#x27;http://ip.42.pl/raw&#x27;</span>).<span class="title function_">read</span>()</span><br><span class="line">    f = <span class="title function_">open</span>(<span class="string">&#x27;local_IP.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    old_ip_line = f.<span class="title function_">readlines</span>()</span><br><span class="line">    f.<span class="title function_">close</span>()</span><br><span class="line">    # 日志</span><br><span class="line">    log = <span class="title function_">open</span>(<span class="string">&#x27;local_IP_log.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    logtime = time.<span class="title function_">strftime</span>(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, time.<span class="title function_">localtime</span>())</span><br><span class="line">    <span class="keyword">for</span> ip <span class="keyword">in</span> <span class="attr">old_ip_line</span>:</span><br><span class="line">        old_ip = ip</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> new_ip != <span class="attr">old_ip</span>:</span><br><span class="line">        logs=logtime+<span class="string">&quot;=== IP change to &quot;</span> + new_ip + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        log.<span class="title function_">write</span>(logs)</span><br><span class="line">        log.<span class="title function_">close</span>()</span><br><span class="line">        f = <span class="title function_">open</span>(<span class="string">&#x27;local_IP.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">        f.<span class="title function_">write</span>(new_ip)</span><br><span class="line">        f.<span class="title function_">close</span>()</span><br><span class="line">        <span class="title function_">changIP</span>(new_ip)</span><br><span class="line">    <span class="attr">else</span>:</span><br><span class="line">        logs=logtime+<span class="string">&quot;=== IP do not change &quot;</span> + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        log.<span class="title function_">write</span>(logs)</span><br><span class="line">        log.<span class="title function_">close</span>()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    schedule.<span class="title function_">every</span>(<span class="number">15</span>).<span class="property">minutes</span>.<span class="title function_">do</span>(job)</span><br><span class="line">    <span class="keyword">while</span> <span class="title class_">True</span>:</span><br><span class="line">        schedule.<span class="title function_">run_pending</span>()</span><br><span class="line">        time.<span class="title function_">sleep</span>(<span class="number">300</span>)</span><br></pre></td></tr></table></figure>

<p>代码示意，实际上我们内网维护了大概有4个公共平台，改四次，还是蛮划算的。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2018/07/18/shell%20for%20%E5%BE%AA%E7%8E%AF%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2018/07/18/shell%20for%20%E5%BE%AA%E7%8E%AF%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">shell for 循环中实现异步处理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-07-18 14:29:44" itemprop="dateCreated datePublished" datetime="2018-07-18T14:29:44+08:00">2018-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:44:42" itemprop="dateModified" datetime="2021-06-08T18:44:42+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index"><span itemprop="name">Linux管理维护</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>理解异步，需要理解shell壳的原理，父shell和子shell进程之间关系。<br>shell什么情况下会产生子进程<br>下英文摘自info bash<br>1、后台执行命令 &amp;。If a command is terminated by the control operator ‘&amp;’, the shell executes the command asynchronously in a subshell.<br>2、管道命令 |。Each command in a pipeline is executed in its own subshell。<br>3、括号命令()。<br>Placing a list of commands between parentheses causes a subshell<br>environment to be created<br>4、执行外部脚本、程序：<br>When Bash finds such a file while searching the &#96;$PATH’ for a command, it spawns a subshell to execute it. In other words, executing filename ARGUMENTS is equivalent to executing bash filename ARGUMENTS</p>
<p>核心命令：<br>等待命令</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wait</span><br></pre></td></tr></table></figure>

<p>后台运行命令</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;</span><br></pre></td></tr></table></figure>

<p>代码块，fork子进程</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">（</span><br><span class="line">）</span><br></pre></td></tr></table></figure>

<p>实例代码：<br>在for循环中，异步执行 单元 ()&amp;：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;<span class="number">1.</span><span class="number">.5</span>&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&lt;!-- more --&gt;</span><br><span class="line">   echo $&#123;i&#125;</span><br><span class="line">   (</span><br><span class="line">     echo block one <span class="attr">sleep</span>:$&#123;i&#125;</span><br><span class="line">     echo block <span class="attr">one_start</span>:<span class="string">`date`</span></span><br><span class="line">     sleep $&#123;i&#125;          </span><br><span class="line">     echo block <span class="attr">one_end</span>:<span class="string">`date`</span></span><br><span class="line">   )&amp;</span><br><span class="line">     echo <span class="title class_">Main</span><span class="attr">_One</span>:$!</span><br><span class="line">   ( </span><br><span class="line">     echo block tow <span class="attr">sleep</span>:<span class="number">1</span></span><br><span class="line">     echo block <span class="attr">tow_start</span>:<span class="string">`date`</span></span><br><span class="line">     sleep <span class="number">1</span></span><br><span class="line">     echo block <span class="attr">tow</span>:<span class="string">`date`</span></span><br><span class="line">  )&amp;</span><br><span class="line">     echo <span class="title class_">Main</span><span class="attr">_Tow</span>:$!</span><br><span class="line">done</span><br><span class="line">echo <span class="attr">out</span>:$!</span><br></pre></td></tr></table></figure>

<p>以上测试结果显示，循环中(…)&amp;代码，后台运行后，就fork了一个子进行。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="title class_">Main</span><span class="attr">_One</span>:<span class="number">17976</span></span><br><span class="line">block one <span class="attr">sleep</span>:<span class="number">1</span>  #这里块一开始</span><br><span class="line"><span class="title class_">Main</span><span class="attr">_Tow</span>:<span class="number">17977</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="title class_">Main</span><span class="attr">_One</span>:<span class="number">17978</span></span><br><span class="line"><span class="title class_">Main</span><span class="attr">_Tow</span>:<span class="number">17980</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">block one <span class="attr">sleep</span>:<span class="number">2</span></span><br><span class="line"><span class="title class_">Main</span><span class="attr">_One</span>:<span class="number">17981</span></span><br><span class="line"><span class="title class_">Main</span><span class="attr">_Tow</span>:<span class="number">17983</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="title class_">Main</span><span class="attr">_One</span>:<span class="number">17984</span></span><br><span class="line"><span class="title class_">Main</span><span class="attr">_Tow</span>:<span class="number">17985</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="title class_">Main</span><span class="attr">_One</span>:<span class="number">17986</span></span><br><span class="line"><span class="title class_">Main</span><span class="attr">_Tow</span>:<span class="number">17987</span></span><br><span class="line"><span class="attr">out</span>:<span class="number">17987</span>  #这里整个脚本跑完</span><br><span class="line">block <span class="attr">one_start</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">29</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block one <span class="attr">sleep</span>:<span class="number">3</span></span><br><span class="line">block tow <span class="attr">sleep</span>:<span class="number">1</span> #这里block二开始执行</span><br><span class="line">block tow <span class="attr">sleep</span>:<span class="number">1</span></span><br><span class="line">block tow <span class="attr">sleep</span>:<span class="number">1</span></span><br><span class="line">block tow <span class="attr">sleep</span>:<span class="number">1</span></span><br><span class="line">block tow <span class="attr">sleep</span>:<span class="number">1</span></span><br><span class="line">block <span class="attr">one_start</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">29</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block one <span class="attr">sleep</span>:<span class="number">4</span></span><br><span class="line">block one <span class="attr">sleep</span>:<span class="number">5</span></span><br><span class="line">block <span class="attr">tow_start</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">29</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">tow_start</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">29</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">tow_start</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">29</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">tow_start</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">29</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">one_start</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">29</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">tow_start</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">29</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">one_start</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">29</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">one_start</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">29</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">one_end</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">30</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">tow</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">30</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">tow</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">30</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">tow</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">30</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">tow</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">30</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">tow</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">30</span> <span class="variable constant_">CST</span> <span class="number">2018</span> #block二 先结束</span><br><span class="line">block <span class="attr">one_end</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">31</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">one_end</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">32</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">one_end</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">33</span> <span class="variable constant_">CST</span> <span class="number">2018</span></span><br><span class="line">block <span class="attr">one_end</span>:<span class="title class_">Wed</span> <span class="title class_">Jul</span> <span class="number">18</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">34</span> <span class="variable constant_">CST</span> <span class="number">2018</span> #block一结束</span><br></pre></td></tr></table></figure>

<p>看到网上有人说for循环中，是使用的子进程进行操作，这个结论应该是不合实际的。<br>只有在显性的fork了子进程，才有这种现象。在没有fork子进程的时候，for循环是顺序执行，等待上一个循环结束才会继续执行。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2018/07/10/linux%20shell%E5%88%A4%E6%96%AD%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E6%9B%B4%E6%96%B0%E3%80%81%E4%BF%AE%E6%94%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2018/07/10/linux%20shell%E5%88%A4%E6%96%AD%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E6%9B%B4%E6%96%B0%E3%80%81%E4%BF%AE%E6%94%B9/" class="post-title-link" itemprop="url">linux shell判断文件是否更新、修改</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-07-10 19:49:06" itemprop="dateCreated datePublished" datetime="2018-07-10T19:49:06+08:00">2018-07-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:44:42" itemprop="dateModified" datetime="2021-06-08T18:44:42+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index"><span itemprop="name">Linux管理维护</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>核心命令：stat<br>如下函数，判断文件是否更新，传入文件路径，间隔时间（秒s），则输入文件在多少秒内是否被更新过。<br>函数会持续等待文件不再变化后停止。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">whether_changed</span>(<span class="params"></span>)&#123;</span><br><span class="line">    local file_path=$&#123;<span class="number">1</span>&#125;</span><br><span class="line">    local check_time=$&#123;<span class="number">2</span>&#125;</span><br><span class="line">    <span class="keyword">while</span> [[ <span class="literal">true</span> ]]; <span class="keyword">do</span></span><br><span class="line">        file_old_stat=<span class="string">&quot;`stat $&#123;file_path&#125;|grep Size`&quot;</span></span><br><span class="line">        sleep $&#123;check_time&#125;</span><br><span class="line">        file_new_stat=<span class="string">&quot;`stat $&#123;file_path&#125;|grep Size`&quot;</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">`echo <span class="subst">$&#123;file_old_stat&#125;</span>`</span> == <span class="string">`echo <span class="subst">$&#123;file_new_stat&#125;</span>`</span> ]]; then</span><br><span class="line">            echo <span class="string">&quot;### In $&#123;check_time&#125;s ,$&#123;file_path&#125; does not change ###&quot;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            echo <span class="string">&quot;#### Wait $&#123;check_time&#125;s ####&quot;</span></span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果要判断某文件自从上次修改以来是否有变更过，则可以将文件状态记录在一个文本中。下次提取比较即可。这里不提供实现。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2018/03/08/shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2018/03/08/shell%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" class="post-title-link" itemprop="url">shell正则表达式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-03-08 17:45:07" itemprop="dateCreated datePublished" datetime="2018-03-08T17:45:07+08:00">2018-03-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index"><span itemprop="name">Linux管理维护</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="正则表达式的分类"><a href="#正则表达式的分类" class="headerlink" title="正则表达式的分类"></a>正则表达式的分类</h1><h1 id="基本组成部分"><a href="#基本组成部分" class="headerlink" title="基本组成部分"></a>基本组成部分</h1><p>正则表达式的基本组成部分。<br><img data-src="docs/images/dn.net-20180308174914289-watermark-2-text-aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2luZGFuY2hhb3M=-font-5a6L5L2T-fontsize-400-fill-I0JBQkFCMA==-dissolve-70.png" alt="这里写图片描述"></p>
<h1 id="POSIX字符类"><a href="#POSIX字符类" class="headerlink" title="POSIX字符类"></a>POSIX字符类</h1><p>POSIX字符类是一个形如[:…:]的特殊元序列（meta sequence），他可以用于匹配特定的字符范围。<br><img data-src="docs/images/dn.net-20180308174928299-watermark-2-text-aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2luZGFuY2hhb3M=-font-5a6L5L2T-fontsize-400-fill-I0JBQkFCMA==-dissolve-70.png" alt="这里写图片描述"></p>
<h1 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h1><p>元字符（meta character）是一种Perl风格的正则表达式，只有一部分文本处理工具支持它，并不是所有的文本处理工具都支持。<br><img data-src="docs/images/dn.net-20180308174945870-watermark-2-text-aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2luZGFuY2hhb3M=-font-5a6L5L2T-fontsize-400-fill-I0JBQkFCMA==-dissolve-70.png" alt="这里写图片描述"></p>
<p>shell 除了有通配符之外，由shell 负责预先先解析后，将处理结果传给命令行之外，shell还有一系列自己的其他特殊字符<br><img data-src="docs/images/dn.net-20180308172720352-watermark-2-text-aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2luZGFuY2hhb3M=-font-5a6L5L2T-fontsize-400-fill-I0JBQkFCMA==-dissolve-70.png" alt="这里写图片描述"></p>
<h1 id="转义符"><a href="#转义符" class="headerlink" title="转义符"></a>转义符</h1><p>有时候，我们想让 通配符，或者元字符 变成普通字符，不需要使用它。那么这里我们就需要用到转义符了。 shell提供转义符有三种<br><img data-src="docs/images/dn.net-20180308173011390-watermark-2-text-aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2luZGFuY2hhb3M=-font-5a6L5L2T-fontsize-400-fill-I0JBQkFCMA==-dissolve-70.png" alt="这里写图片描述"></p>
<h1 id="shell解析脚本的过程"><a href="#shell解析脚本的过程" class="headerlink" title="shell解析脚本的过程"></a>shell解析脚本的过程</h1><p><img data-src="docs/images/gs.com-cnblogs_com-chengmo-WindowsLiveWriter-LinuxShell_142B8-1_2-.png" alt="这里写图片描述"><br>如果用双引号包括起来，shell检测跳过了1-4步和9-10步，单引号包括起来，shell检测就会跳过了1-10步。也就是说，双引号 只经过参数扩展、命令代换和算术代换就可以送入执行步骤，而单引号转义符直接会被送入执行步骤。而且，无论是双引号转义符还是单引号转义符在执行的时候能够告诉各个命令自身内部是一体的，但是其本身在执行时是并不是命令中文本的一部分。</p>
<p>本文参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/chengmo/archive/2010/10/17/1853344.html">https://www.cnblogs.com/chengmo/archive/2010/10/17/1853344.html</a><br><a target="_blank" rel="noopener" href="http://man.linuxde.net/docs/shell_regex.html">http://man.linuxde.net/docs/shell_regex.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2018/02/02/tomcat%20%E9%83%A8%E7%BD%B2https%20apr%E6%AD%A3%E7%A1%AE%E5%AE%89%E8%A3%85%EF%BC%8C%E5%90%AF%E5%8A%A8%E6%89%BE%E4%B8%8D%E5%88%B0apr%E7%9A%84%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2018/02/02/tomcat%20%E9%83%A8%E7%BD%B2https%20apr%E6%AD%A3%E7%A1%AE%E5%AE%89%E8%A3%85%EF%BC%8C%E5%90%AF%E5%8A%A8%E6%89%BE%E4%B8%8D%E5%88%B0apr%E7%9A%84%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">tomcat 部署https apr正确安装，启动找不到apr的问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-02-02 11:30:13" itemprop="dateCreated datePublished" datetime="2018-02-02T11:30:13+08:00">2018-02-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:44:42" itemprop="dateModified" datetime="2021-06-08T18:44:42+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index"><span itemprop="name">Linux管理维护</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>问题解决可以参考：<a target="_blank" rel="noopener" href="http://blog.csdn.net/felix_yujing/article/details/52385890">http://blog.csdn.net/felix_yujing&#x2F;article&#x2F;details&#x2F;52385890</a><br>也可以参考官网：<a target="_blank" rel="noopener" href="http://tomcat.apache.org/native-doc/">http://tomcat.apache.org/native-doc/</a></p>
<p>但是，我这个启动始终不对。一开始以为是安装有问题，尝试了几次，安装明显没有什么差错。<br>仔细看日志会发现，tomcat在启动过程中会去&#x2F;usr&#x2F;lib64等目录下去找apr，但是找不到。虽然source &#x2F;etc&#x2F;profile，但是明显报错的tomcat并没有去你设置的目录下面去找它所需要的库文件，明显这个source并未生效。</p>
<p>原理猜测：<br>以上操作，是root和普通用户在切换操作发生的。<br>&#x2F;etc&#x2F;profile在系统账户管理的原理上来说，需要用户登录才会生效。<br>su命令切换不是等于登录（这个是猜测，没有查看到权威说法，亲测猜测是对的）。所以tomcat启动的时候就不会去&#x2F;usr&#x2F;local&#x2F;apr&#x2F;lib目录下去找.so文件(<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangnengwu/p/7760606.html">动态链接库</a>)。</p>
<p>解决办法：<br>1、装完apr，主动退出ssh连接，重新用普通账户连接。<br>或者在普通账户下执行：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>

<p>2、把需要的文件拷贝到需要的目录，执行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/apr/lib/libtcnative-<span class="number">1.</span>* <span class="regexp">/usr/</span>lib64/</span><br></pre></td></tr></table></figure>

<p>我这个，几乎是全网回答最直接的了。毕竟是我亲测！</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://windanchaos.github.io/2018/01/23/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%EF%BC%88SLB%EF%BC%89%E4%BD%BF%E7%94%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E2%80%94%E2%80%94%E4%B8%80%E7%AF%87%E9%9B%86%E5%90%88%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%B8%BB%E8%A6%81%E5%86%85%E5%AE%B9%E7%9A%84%E6%96%87%E7%AB%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="docs/images/avatar.jpeg">
      <meta itemprop="name" content="windanchaos">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="docs/2018/01/23/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%EF%BC%88SLB%EF%BC%89%E4%BD%BF%E7%94%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E2%80%94%E2%80%94%E4%B8%80%E7%AF%87%E9%9B%86%E5%90%88%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%B8%BB%E8%A6%81%E5%86%85%E5%AE%B9%E7%9A%84%E6%96%87%E7%AB%A0/" class="post-title-link" itemprop="url">负载均衡（SLB）使用最佳实践——一篇集合负载均衡主要内容的文章</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-01-23 17:31:01" itemprop="dateCreated datePublished" datetime="2018-01-23T17:31:01+08:00">2018-01-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2021-06-08 18:39:48" itemprop="dateModified" datetime="2021-06-08T18:39:48+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="docs/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index"><span itemprop="name">Linux管理维护</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文转自：<a target="_blank" rel="noopener" href="https://yq.aliyun.com/articles/80055">https://yq.aliyun.com/articles/80055</a></p>
<p>可以加深目前生产环境和测试环境中nginx使用的理解。</p>
<h1 id="负载均衡（SLB）使用最佳实践"><a href="#负载均衡（SLB）使用最佳实践" class="headerlink" title="负载均衡（SLB）使用最佳实践"></a>负载均衡（SLB）使用最佳实践</h1><p><em>摘要：</em> 负载均衡（Server Load Balancer，下文简称 SLB）的引入，可以降低单台云服务器 ECS（下文简称 ECS）出现异常时对业务的冲击，提升业务的可用性。同时，结合弹性伸缩服务，通过动态调整后端服务器，可以快速对业务进行弹性调整（扩容或缩容），以快速应对业务的发展。<br>负载均衡（Server Load Balancer，下文简称 SLB）的引入，可以降低单台云服务器 ECS（下文简称 ECS）出现异常时对业务的冲击，提升业务的可用性。同时，结合弹性伸缩服务，通过动态调整后端服务器，可以快速对业务进行弹性调整（扩容或缩容），以快速应对业务的发展。</p>
<p>本文，会先对 SLB 的使用限制和常见误区进行说明，然后介绍 SLB 的使用最佳实践。</p>
<h1 id="SLB-基础原理"><a href="#SLB-基础原理" class="headerlink" title="SLB 基础原理"></a>SLB 基础原理</h1><p>在开始使用 SLB 之前，建议您务必阅读如下文章，了解 SLB 的相关基础原理：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://help.aliyun.com/knowledge_detail/39444.html">负载均衡技术原理浅析</a></li>
<li><a target="_blank" rel="noopener" href="https://help.aliyun.com/knowledge_detail/39455.html">负载均衡健康检查原理浅析</a></li>
<li><a target="_blank" rel="noopener" href="https://help.aliyun.com/knowledge_detail/39440.html">负载均衡网络流量路径说明</a></li>
<li><a target="_blank" rel="noopener" href="https://help.aliyun.com/knowledge_detail/39449.html">负载均衡高可用概要说明</a></li>
</ul>
<h1 id="SLB-使用限制"><a href="#SLB-使用限制" class="headerlink" title="SLB 使用限制"></a>SLB 使用限制</h1><p>在使用 SLB 进行业务部署之前，请您务必了解 SLB 的相关使用限制，以免对后续使用造成困扰或对业务造成影响。</p>
<h2 id="产品与业务规格限制"><a href="#产品与业务规格限制" class="headerlink" title="产品与业务规格限制"></a>产品与业务规格限制</h2><p>SLB 的相关资源或功能存在限制，部分可以通过提交工单申请调整。部分则没有例外，无法调整。详细说明，可以参阅 <a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/32459.html"><em>SLB 使用限制</em>。</a></p>
<p>另外，后续阿里云会推出性能保障型实例，对实例性能提供保障，用户可配置和查询其具体的性能指标，并可查看其实时运行数据。相关说明可以参阅 <a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/27657.html"><em>产品文档</em>。</a></p>
<h2 id="技术限制"><a href="#技术限制" class="headerlink" title="技术限制"></a>技术限制</h2><p>SLB 在技术层面还在逐步增强和完善，截止本文发稿，还存在如下技术限制：</p>
<h1 id="SLB-常见误区"><a href="#SLB-常见误区" class="headerlink" title="SLB 常见误区"></a>SLB 常见误区</h1><p>从历史案例看，用户在 SLB 的规划和使用过程中有很多常见误区。接下来逐一说明。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="docs/2018/01/23/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%EF%BC%88SLB%EF%BC%89%E4%BD%BF%E7%94%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E2%80%94%E2%80%94%E4%B8%80%E7%AF%87%E9%9B%86%E5%90%88%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%B8%BB%E8%A6%81%E5%86%85%E5%AE%B9%E7%9A%84%E6%96%87%E7%AB%A0/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="docs/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="docs/">1</a><span class="space">&hellip;</span><a class="page-number" href="docs/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="docs/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="docs/page/12/">12</a><a class="extend next" rel="next" href="docs/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">蜀ICP备19036728号 </a>
      <img src="docs/images/%E5%A4%87%E6%A1%88%E5%9B%BE%E6%A0%87.png" alt=""><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51012202000611" rel="noopener" target="_blank">川公网安备 51012202000611号 </a>
  </div>

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-dragon"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">windanchaos</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="docs/js/comments.js"></script><script src="docs/js/utils.js"></script><script src="docs/js/motion.js"></script><script src="docs/js/schemes/muse.js"></script><script src="docs/js/next-boot.js"></script><script src="docs/js/pjax.js"></script>

  





  




  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":"enable","home":"enable","archive":"enable","delay":true,"timeout":3000,"priority":true,"url":"https://windanchaos.github.io/page/4/"}</script>
  <script src="docs/js/third-party/quicklink.js"></script>

</body>
</html>
