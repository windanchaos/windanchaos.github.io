<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="宇弦">
<meta property="og:url" content="https:&#x2F;&#x2F;blog.windanchaos.tech&#x2F;page&#x2F;2&#x2F;index.html">
<meta property="og:site_name" content="宇弦">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://blog.windanchaos.tech/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>宇弦</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">宇弦</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-首页">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-分类">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-归档">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-关于">

    <a href="/about/me.html" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/windanchaos" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2018/11/17/%E6%9C%89%E6%84%9F%E4%BA%8E%E4%B8%80%E4%B8%AA%E6%82%AC%E8%80%8C%E6%9C%AA%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/17/%E6%9C%89%E6%84%9F%E4%BA%8E%E4%B8%80%E4%B8%AA%E6%82%AC%E8%80%8C%E6%9C%AA%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">有感于一个悬而未决的问题</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-17 21:52:07" itemprop="dateCreated datePublished" datetime="2018-11-17T21:52:07+08:00">2018-11-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index">
                    <span itemprop="name">Linux管理维护</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/11/17/%E6%9C%89%E6%84%9F%E4%BA%8E%E4%B8%80%E4%B8%AA%E6%82%AC%E8%80%8C%E6%9C%AA%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98/" class="post-meta-item leancloud_visitors" data-flag-title="有感于一个悬而未决的问题" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2018/11/17/%E6%9C%89%E6%84%9F%E4%BA%8E%E4%B8%80%E4%B8%AA%E6%82%AC%E8%80%8C%E6%9C%AA%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/11/17/%E6%9C%89%E6%84%9F%E4%BA%8E%E4%B8%80%E4%B8%AA%E6%82%AC%E8%80%8C%E6%9C%AA%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>我们新开启了一个项目。项目仍然使用tomcat作为容器发布，但是这次出现了高CPU占用的情况，当然使用了ssl证书，但是我们仍然遵照了生产其他tomcat的配置方式，使用的是apr（最初是nio，导致cpu资源无法释放）。这个tomcat还出现过几次假死。也在发现假死后把堆栈都输出以发现情况具体在哪里。但是，都没有解决。<br>由于是我在摆弄部署的事，研发leader跟我确认配置是否正确，把问题告诉了我，说CPU占用很高。我再三确认配置是正确后。凭借直觉（连接资源没有释放） ，用netstat -ap|grep PID。</p>
<p><img src="/images/20181029215037807.jpg-x-oss-process=image-watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpbmRhbmNoYW9z,size_16,color_FFFFFF,t_70.png" alt="在这里插入图片描述"></p>
<p>由于最近在自学java的socket编程，所以对socket的一些基本原理有所了解，知道socket是通过TCP连接的，建立通道，需要关闭通道，眨眼就该关闭，所以Close_wait的数量还是多了点，同时这个连接还是https建立的。一下就get到了点，我多次运行查看命令，Close_wait数量没有任何变化，理论上这个值应该是动态变化的，猜测这个地方有问题。顺藤摸瓜看看网上有没有人遇到过，百度关键“tomcat apr CLOSE_WAIT”，找到这篇博客“<a href="https://www.cnblogs.com/saaav/p/6258831.html%E2%80%9D" target="_blank" rel="noopener">https://www.cnblogs.com/saaav/p/6258831.html”</a><br>症状，基本和我们一样，接着基于博客的信息，我去排查我们tomcat的版本时间和bug修复时间，发现我们的版本是旧的，所以，升级tomcat版本就可以解决问题。而这种问题也可能是导致tomcat假死的真正原因，<a href="https://blog.csdn.net/lxlmj/article/details/53005021" target="_blank" rel="noopener">https://blog.csdn.net/lxlmj/article/details/53005021</a> 。<br>接着，在可复现的测试环境，替换tomcat版本。验证假设。<br>最后，验证通过在生产环境升级。</p>
<p>感慨：懂的基础越多，解决问题的思路越开阔。好好学习，天天向上。</p>
<p>后记：截图中的CLOSE_WAIT依然存在，从业务上确认是必要的。所以，发现问题的解决，在我的认知范围和水平内，只是偶然的，但毕竟我还是协助解决了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2018/10/09/%E8%8F%9C%E9%B8%9F%E5%8F%98%E4%B8%93%E5%AE%B6%EF%BC%9A%E7%BB%8F%E5%85%B8%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E4%B9%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/10/09/%E8%8F%9C%E9%B8%9F%E5%8F%98%E4%B8%93%E5%AE%B6%EF%BC%9A%E7%BB%8F%E5%85%B8%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E4%B9%A6/" class="post-title-link" itemprop="url">菜鸟变专家：经典计算机图书</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-09 00:57:49" itemprop="dateCreated datePublished" datetime="2018-10-09T00:57:49+08:00">2018-10-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">计算机科学基础</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/10/09/%E8%8F%9C%E9%B8%9F%E5%8F%98%E4%B8%93%E5%AE%B6%EF%BC%9A%E7%BB%8F%E5%85%B8%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E4%B9%A6/" class="post-meta-item leancloud_visitors" data-flag-title="菜鸟变专家：经典计算机图书" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2018/10/09/%E8%8F%9C%E9%B8%9F%E5%8F%98%E4%B8%93%E5%AE%B6%EF%BC%9A%E7%BB%8F%E5%85%B8%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E4%B9%A6/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/10/09/%E8%8F%9C%E9%B8%9F%E5%8F%98%E4%B8%93%E5%AE%B6%EF%BC%9A%E7%BB%8F%E5%85%B8%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E4%B9%A6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>“如果能时光倒流，回到过去，作为一个开发人员，你可以告诉自己在职业生涯初期应该读一本，你会选择哪本书呢？我希望这个书单列表内容丰富，可以涵盖很多东西。”</p>
<p>很多程序员响应，他们在推荐时也写下自己的评语。以前就有国内网友介绍这个程序员书单，不过都是推荐数 Top 10的书。其实除了前10本之外，推荐数前30左右的书籍都算经典，伯乐在线整理编译这个问答贴，同时摘译部分推荐人的评语。下面就按照各本书的推荐数排列。</p>
<p>（1） 《代码大全》史蒂夫·迈克康奈尔</p>
<p>推荐数：1684</p>
<p>code complete 代码大全</p>
<p>“优秀的编程实践的百科全书，《代码大全》注重个人技术，其中所有东西加起来，就是我们本能所说的“编写整洁的代码”。这本书有50页在谈论代码布局。” —— Joel Spolsky</p>
<p>对于新手来说，这本书中的观念有点高阶了。到你准备阅读此书时，你应该已经知道并实践过书中99%的观念。– esac</p>
<p>（2）《程序员修炼之道》</p>
<p>推荐数：1504</p>
<p>Pragmatic Programmer 程序员修炼之道</p>
<p>对于那些已经学习过编程机制的程序员来说，这是一本卓越的书。或许他们还是在校生，但对要自己做什么，还感觉不是很安全。就像草图和架构之间的差别。虽然你在学校课堂上学到的是画图，你也可以画的很漂亮，但如果你觉得你不太知道从哪儿下手，如果某人要你独自画一个P2P的音乐交换网络图，那这本书就适合你了。—— Joel</p>
<p>（3）《计算机程序的构造和解释》</p>
<p>推荐数：916</p>
<p>Structure and Interpretation of Computer Programs 计算机程序的构造和解释</p>
<p>就个人而言，这本书目前为止对我影响醉倒的一本编程书。</p>
<p>《代码大全》、《重构》和《设计模式》这些经典书会教给你高效的工作习惯和交易细节。其他像《人件集》、《计算机编程心理学》和《人月神话》这些书会深入软件开发的心理层面。其他书籍则处理算法。这些书都有自己所属的位置。</p>
<p>然而《计算机程序的构造和解释》与这些不同。这是一本会启发你的书，它会燃起你编写出色程序的热情；它还将教会你认识并欣赏美；它会让你有种敬畏，让你难以抑制地渴望学习更多的东西。其他书或许会让你成为一位更出色的程序员，但此书将一定会让你成为一名程序员。</p>
<p>同时，你将会学到其他东西，函数式编程（第三章）、惰性计算、元编程、虚拟机、解释器和编译器。</p>
<p>一些人认为此书不适合新手。个人认为，虽然我并不完全认同要有一些编程经验才能读此书，但我还是一定推荐给初学者。毕竟这本书是写给著名的6.001，是麻省理工学院的入门编程课程。此书或许需要多做努力（尤其你在做练习的时候，你也应当如此），但这个价是对得起这本书的。</p>
<p>你还不确信么？那就读读第一版的前言或序言。网上有免费的电子版。-Antti Sykäri</p>
<p>（4）《C程序设计语言》</p>
<p>推荐数：774</p>
<p>The C Programming Language C程序设计语言</p>
<p>这本书简洁易读，会教给你三件事：C 编程语言；如何像程序员一样思考；底层计算模型。（这对理解“底层”非常重要）—— Nathan</p>
<p>（5）《算法导论》</p>
<p>推荐数：671</p>
<p>Introduction to algorithms 算法导论</p>
<p>《代码大全》教你如何正确编程；《人月神话》教你如何正确管理；《设计模式》教你如何正确设计……</p>
<p>在我看来，代码只是一个工具，并非精髓。开发软件的主要部分是创建新算法或重新实现现有算法。其他部分则像重新组装乐高砖块或创建“管理”层。我依然梦想这样的工作，我的大部分时间（&gt;50%）是在写算法，其他“管理”细节则留给其他人…… —— Ran Biron</p>
<p>（6）《重构：改善既有代码的设计》</p>
<p>推荐数：617</p>
<p>Refactor 重构：改善既有代码的设计</p>
<p>我想我不得不推荐《重构》：改进现有代码的设计。—— Martin</p>
<p>我必须承认，我最喜欢的编程语录是出自这本书：任何一个傻瓜都能写出计算机能理解的程序，而优秀的程序员却能写出别人能读得懂的程序。—— Martin Fowler</p>
<p>（7）《设计模式》</p>
<p>推荐数：617</p>
<p>Design Patterns 设计模式</p>
<p>就我而言，我认为四人帮编著的《设计模式》是一本极为有用的书。虽然此书并不像其他建议一样有关“元”编程，但它强调封装诸如模式一类的优秀编程技术，因而鼓励其他人提出新模式和反模式（antipatterns），并运用于编程对话中。—— Chris Jester-Young</p>
<p>（8）《人月神话》</p>
<p>推荐数：588</p>
<p>The Mythical Man-Month 人月神话</p>
<p>（9）《计算机程序设计艺术》</p>
<p>推荐数：542</p>
<p>The Art of Computer Programming 计算机程序设计艺术</p>
<p>这是高德纳倾注心血写的一本书。—— Peter Coulton</p>
<p>（10） 《编译原理》（龙书）</p>
<p>推荐数：462</p>
<p>Compilers: Principles, Techniques, and Tools 编译原理：原理、技术与工具</p>
<p>我很奇怪，居然没人提到龙书。（或许已有推荐，我没有看到）。我从没忘过此书的第一版封面。此书让我知道了编译器是多么地神奇绝妙。- DB</p>
<p>（11）《深入浅出设计模式》</p>
<p>推荐数：445</p>
<p>我知道四人帮的《设计模式》是一本标准书，但倒不如先看看这部大部头，此书更为简易。一旦你了解了解了基本原则，可以去看四人帮的那本圣经了。- Calanus</p>
<p>（12）《哥德尔、艾舍尔、巴赫书：集异璧之大成》</p>
<p>推荐数：437</p>
<p>如果下昂真正深入阅读，我推荐道格拉斯·侯世达（Douglas Hofstadter）的《哥德尔、艾舍尔、巴赫书》。他极为深入研究了程序员每日都要面对的问题：递归、验证、证明和布尔代数。这是一本很出色的读物，难度不大，偶尔有挑战，一旦你要鏖战到底，将是非常值得的。 – Jonik</p>
<p>（13）《代码整洁之道》</p>
<p>推荐数：329</p>
<p>虽然《代码整洁之道》和《代码大全》有很多共同之处，但它有更为简洁更为实际的清晰例子。 – Craig P. Motlin</p>
<p>（14）《Effective C++》和《More Effective C++》</p>
<p>推荐数：297</p>
<p>在我职业生涯早期，Scott Meyer的《Effective C++》和后续的《More Effective C++》都对我的编程能力有着直接影响。正如当时的一位朋友所说，这些书缩短你培养编程技能的过程，而其他人可能要花费数年。</p>
<p>去年对我影响最大的一本书是《大教堂与市集》，该书教会我很有关开源开发过程如何运作，和如何处理我代码中的Bug。 – John Channing</p>
<p>（15）《编程珠玑》</p>
<p>推荐数：282</p>
<p>尽管我不得不羞愧地承认，书中一半的东西我都没有理解，但我真的推荐《编程珠玑》，书中有些令人惊奇的东西。 – Matt Warren</p>
<p>（16）《修改代码的艺术》by Michael Feathers</p>
<p>我认为没有任何一本书能向这本书一样影响了我的编程观点。它明确地告诉你如何处理其他人的代码，含蓄地教会你避免哪些（以及为什么要避免）。- Wolfbyte</p>
<p>同意。很多开发人员讨论用干净的石板来编写软件。但我想几乎所有开发人员的某些时候是在吃其他开发人员的狗食。– Bernard Dy</p>
<p>（17）《编码：隐匿在计算机软硬件背后的语言》</p>
<p>我推荐Charles Petzold的《编码》。在这个充满工具和IDE的年代，很多复杂度已经从程序员那“抽取”走了，这本书一本开眼之作。 – hemil</p>
<p>（18）《禅与摩托车维修艺术 / Zen and the Art of Motorcycle Maintenance》</p>
<p>对我影响最大的那本书是 Robert Pirsig 的《禅与摩托车维修艺术》。不管你做什么事，总是要力求完美，彻底了解你手中的工具和任务，更为重要的是，要有乐趣（因为如果你做事有乐趣，一切将自发引向更好的结果）。 – akr</p>
<p>（编注：关于这本书，也可以看看阮一峰的读后感。）</p>
<p>（19）《Peopleware / 人件集:人性化的软件开发》</p>
<p>Demarco 和 Lister 表明，软件开发中的首要问题是人，并非技术。他们的答案并不简单，只是令人难以置信的成功。第二版新增加了八章内容。 – Eduardo Molteni</p>
<p>（20）《Coders at Work / 编程人生》</p>
<p>一本非常有影响力的书，可以从中学到一些业界顶级人士的经验，了解他们如何思考并工作。 – Jahanzeb Farooq</p>
<p>（21）《Surely You’re Joking, Mr. Feynman! / 别闹了，费曼先生！》</p>
<p>虽然这本书可能有点偏题，但不管你信不信，这本书曾在计算机科学专业课程的阅读列表之上。一个优秀的角色模型，一本有关好奇心的优秀书籍。 – mike511</p>
<p>（22）《Effective Java 中文版》</p>
<p>此书第二版教你如何编写漂亮并高效的代码，虽然这是一本Java书，但其中有很多跨语言的理念。 – Marcio Aguiar</p>
<p>（23）《Patterns of Enterprise Application Architecture / 企业应用架构模式》</p>
<p>很奇怪，还没人推荐 Martin Fowler 的《企业应用架构模式》- levi rosol</p>
<p>（24）《The Little Schemer》和《The Seasoned Schemer》 nmiranda</p>
<p>这两本是LISP的英文书，尚无中文版。美国东北大学网站上也有电子版。</p>
<p>（25）《交互设计之路》英文名：《The Inmates Are Running The Asylum: Why High Tech Products Drive Us Crazy and How to Restore the Sanity》该书作者：Alan Cooper，人称Visual Basic之父，交互设计之父。</p>
<p>本书是基于众多商务案例，讲述如何创建更好的、高客户忠诚度的软件产品和基于软件的高科技产品的书。本书列举了很多真实可信的实际例子，说明目前在软件产品和基于软件的高科技产品中，普遍存在着“难用”的问题。作者认为，“难用”问题是由这些产品中存在着的高度“认知摩擦”引起的，而产生这个问题的根源在于现今软件开发过程中欠缺了一个为用户利益着想的前期“交互设计”阶段。“难用”的产品不仅损害了用户的利益，最终也将导致企业的失败。本书通过一些生动的实例，让人信服地讲述了由作者倡导的“目标导向”交互设计方法在解决“难用”问题方面的有效性，证实了只有改变现有观念，才能有效地在开发过程中引入交互设计，将产品的设计引向成功。</p>
<p>本书虽然是一本面向商务人员而编写的书，但也适合于所有参与软件产品和基于软件的高科技产品开发的专业人士，以及关心软件行业和高科技行业现状与发展的人士阅读。</p>
<p>他还有另一本中文版著作：《About Face 3 交互设计精髓》</p>
<p>（26）《Why’s (Poignant) Guide to Ruby 》</p>
<p>如果你不是程序员，阅读此书可能会很有趣，但如果你已经是个程序员，可能会有点乏味。</p>
<p>（27）《Unix编程艺术》</p>
<p>It is useful regardless operating system you use. – J.F. Sebastian<br>不管你使用什么操作系统，这本书都很有用。 – J.F. Sebastian</p>
<p>（28）《Practices of an Agile Developer / 高效程序员的45个习惯：敏捷开发修炼之道》</p>
<p>45个习惯，分为7个方面：工作态度、学习、软件交付、反馈、编码、调试和协作。</p>
<p>每一个具体的习惯里，一开始提出一个谬论，然后展开分析，之后有正队性地提出正确的做法，并设身处地地讲出了正确做法给你个人的“切身感受”，最后列出几条注意事项，帮助你修正自己的做法（“平衡的艺术”）。</p>
<p>（29）《Test-Driven Development by Example. / 测试驱动开发》</p>
<p>前面已经提到的很多书都启发了我，并影响了我，但这本书每位程序员都应该读。它向我展示了单元测试和TDD的重要性，并让我很快上手。 – Curro</p>
<p>我不关心你的代码有多好或优雅。如果你没有测试，你或许就如同没有编写代码。这本书得到的推荐数应该更高些。人们讨论编写用户喜欢的软件，或既设计出色并健壮的高效代码，但如果你的软件有一堆bug，谈论那些东西毫无意义。– Adam Gent</p>
<p>（30）《Don’t Make Me Think / 点石成金:访客至上的网页设计秘笈》</p>
<p>取决于你所追求的目标。我喜欢《代码大全》是因纯编程，《点石成金》是一本有关UI设计的卓越书籍。 – Justin Standard</p>
<p>转载请注明：<a href="https://www.cwzj.com/" target="_blank" rel="noopener">《 菜鸟变专家：经典计算机图书 | 我爱计算机 》</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2018/09/29/crontab%20%E5%9C%A8GUI%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%89%A7%E8%A1%8Cwebdriver/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/29/crontab%20%E5%9C%A8GUI%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%89%A7%E8%A1%8Cwebdriver/" class="post-title-link" itemprop="url">crontab 在GUI环境下执行webdriver</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-29 20:46:32" itemprop="dateCreated datePublished" datetime="2018-09-29T20:46:32+08:00">2018-09-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index">
                    <span itemprop="name">Linux管理维护</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/09/29/crontab%20%E5%9C%A8GUI%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%89%A7%E8%A1%8Cwebdriver/" class="post-meta-item leancloud_visitors" data-flag-title="crontab 在GUI环境下执行webdriver" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2018/09/29/crontab%20%E5%9C%A8GUI%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%89%A7%E8%A1%8Cwebdriver/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/09/29/crontab%20%E5%9C%A8GUI%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%89%A7%E8%A1%8Cwebdriver/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Linux下，大部分的问题都跟环境有关。<br>crontab也不例外。<br>我的需求：crontab定时执行脚本，依据条件启动webdriver(selenium)去浏览器上做一些操作，而且是周期性的。我使用的是splinter框架驱动业务。</p>
<p>需要解决：<br>1、系统具备gui运行的环境。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y libXfont xorg-x11-fonts*</span><br></pre></td></tr></table></figure>

<p>2、sh脚本中在环境变量中增加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> DISPLAY=:<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>3、执行脚本中增加模拟，我的是python</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyvirtualdisplay <span class="keyword">import</span> Display</span><br><span class="line">display = Display(visible=<span class="number">0</span>, size=(<span class="number">800</span>, <span class="number">800</span>))  </span><br><span class="line">display.start()</span><br><span class="line"></span><br><span class="line">业务代码……</span><br></pre></td></tr></table></figure>

<p>4、下载和安装浏览器及webderveir的驱动。<br>centos添加源</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/yum.repos.d/google.repo</span><br></pre></td></tr></table></figure>

<p>添加如下内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[google]</span><br><span class="line">name=Google-x86_64</span><br><span class="line">baseurl=http:<span class="comment">//dl.google.com/linux/rpm/stable/x86_64</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">gpgcheck=<span class="number">0</span></span><br><span class="line">gpgkey=https:<span class="comment">//dl-ssl.google.com/linux/linux_signing_key.pub</span></span><br></pre></td></tr></table></figure>

<p>webderveir的略。</p>
<p>我的代码示例，有删减，留下的都是解决问题的核心代码：</p>
<p>脚本</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">export</span> DISPLAY=:<span class="number">0</span></span><br><span class="line">source /etc/profile</span><br><span class="line">....</span><br><span class="line">python /home/user/weixin_open_ip.py</span><br></pre></td></tr></table></figure>

<p>weixin_open_ip.py</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">...</span><br><span class="line"><span class="keyword">from</span> pyvirtualdisplay <span class="keyword">import</span> Display</span><br><span class="line"></span><br><span class="line">def changIP(ip):</span><br><span class="line">  	....</span><br><span class="line">	browser.quit()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    display = Display(visible=<span class="number">0</span>, size=(<span class="number">800</span>, <span class="number">800</span>))</span><br><span class="line">    display.start()</span><br><span class="line">    .....</span><br><span class="line">    changIP(new_ip)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2018/09/18/Tomcat%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E6%B5%85%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/18/Tomcat%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E6%B5%85%E6%9E%90/" class="post-title-link" itemprop="url">Tomcat整体架构浅析</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-18 10:31:20" itemprop="dateCreated datePublished" datetime="2018-09-18T10:31:20+08:00">2018-09-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%90%8E%E7%AB%AF%E6%A1%86%E6%9E%B6%E5%92%8C%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">后端框架和技术</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/09/18/Tomcat%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E6%B5%85%E6%9E%90/" class="post-meta-item leancloud_visitors" data-flag-title="Tomcat整体架构浅析" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2018/09/18/Tomcat%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E6%B5%85%E6%9E%90/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/09/18/Tomcat%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E6%B5%85%E6%9E%90/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转自：<a href="https://blog.csdn.net/cx520forever/article/details/52743166" target="_blank" rel="noopener">https://blog.csdn.net/cx520forever/article/details/52743166</a><br>tomcat详解搭配着看：<a href="https://www.cnblogs.com/kismetv/p/7228274.html" target="_blank" rel="noopener">https://www.cnblogs.com/kismetv/p/7228274.html</a></p>
<p>comment：本文基于Tomcat7.0.68</p>
<h1 id="1-整体结构"><a href="#1-整体结构" class="headerlink" title="1.整体结构"></a>1.整体结构</h1><p>架构图：<br><img src="/images/.net-uploads-201206-05-1338887929_7279.JPG.png" alt="这里写图片描述"></p>
<h2 id="1-1各组件解释："><a href="#1-1各组件解释：" class="headerlink" title="1.1各组件解释："></a>1.1各组件解释：</h2><p>从顶层开始：</p>
<p>一般情况下我们并不需要配置多个Service,conf/server.xml默认配置了一个“Catalina”的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Service&gt;</span><br></pre></td></tr></table></figure>
<p>。<br><strong>Tomcat将Engine，Host，Context，Wrapper统一抽象成Container。</strong><br>Connector接受到请求后，会将请求交给Container，Container处理完了之后将结果返回给Connector<br>下面看Container的结构：<br><img src="/images/nblogs.com-blog-665375-201601-665375-20160119184849437-2014392220-.png" alt="这里写图片描述"></p>
<p><img src="/images/-upload-picture-pic-124649-3f5d0ac0-1c40-3c78-9bed-e990f41e3b84.jpg.png" alt="这里写图片描述"><br>Standard/<em>XXXX/</em>是组件接口的默认实现类。</p>
<p>Tomcat 还有其它组件，如安全组件 security、logger、session、naming 等其它组件。这些组件共同为 Connector 和 Container 提供必要的服务。</p>
<h2 id="1-2组件的生命线Lifecycle"><a href="#1-2组件的生命线Lifecycle" class="headerlink" title="1.2组件的生命线Lifecycle"></a>1.2组件的生命线Lifecycle</h2><p>Tomcat中很多组件具有生命周期,如初始化、启动、关闭，这些组件的生命周期具有共性，因此Tomcat中将其抽象为接口Lifecycle，来控制组件的生命周期，它通过 <strong>事件机制</strong> 实现各个容器间的内部通讯。<br>Lifecycle接口的方法：<br><img src="/images/dn.net-20161006125439657.png" alt="这里写图片描述"><br>继承关系图：<br><img src="/images/dn.net-20161006124601442.png" alt="这里写图片描述"><br>StandardServer，StandardService，Connector和上面4个容器等很多组件都实现了Lifecycle，组件实现这个接口就可以统一被拥有它的组件控制了，这样一层一层的直到一个 <strong>最高级的组件</strong> 就可以控制 Tomcat 中所有组件的生命周期，这个最高的组件就是 **</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Server</span><br></pre></td></tr></table></figure>
<p>**。</p>
<h1 id="2-启动流程"><a href="#2-启动流程" class="headerlink" title="2.启动流程"></a>2.启动流程</h1><p>在bin目录下执行了./startup.sh 或者执行 ./catalina.bat start命令时,实际调用了Bootstrap启动类的main方法，并传递了start参数。<br>Bootstrap/#main方法的启动流程：<br>参考<a href="http://blog.csdn.net/Zerohuan/article/details/50752635#t6" target="_blank" rel="noopener">http://blog.csdn.net/Zerohuan/article/details/50752635/#t6</a><br>附上别人总结的一张启动时序图：<br><img src="/images/dn.net-20150327153152547-watermark-2-text-aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYzkyOTgzMzYyM2x2Y2hh-font-5a6L5L2T-fontsize-400-fill-I0JBQkFCMA==-dissolve-70-gravity-Center.png" alt="这里写图片描述"><br>补充如下：</p>
<ul>
<li>关于Connector初始化和启动的更多细节，可参考本人另一篇blog <a href="http://blog.csdn.net/cx520forever/article/details/52198050" target="_blank" rel="noopener">http://blog.csdn.net/cx520forever/article/details/52198050</a></li>
</ul>
<h1 id="3-pipeline-valve机制"><a href="#3-pipeline-valve机制" class="headerlink" title="3.pipeline valve机制"></a>3.pipeline valve机制</h1><h2 id="3-1名词解释"><a href="#3-1名词解释" class="headerlink" title="3.1名词解释"></a>3.1名词解释</h2><h2 id="3-2总体分析"><a href="#3-2总体分析" class="headerlink" title="3.2总体分析"></a>3.2总体分析</h2><p>四个基本容器对象里面都有一个pipeline及valve模块，是容器类必须具有的模块，对象生成时set该属性。Pipeline就像是每个容器的逻辑总线。在pipeline上按照配置的顺序，加载各个valve。通过pipeline完成各个valve之间的调用，各个valve实现具体的应用逻辑。<br>tomcat组件图：<br><img src="/images/dn.net-20161006212818345.png" alt="tomcat组件图"><br>从上图中看到，在Connector接收到一次连接并转化成HttpServletRequest请求对象后，<strong>请求传递如下</strong>：<br>Connector–&gt;Engine的Pipeline的ValveA中–&gt;Engine Valve–&gt;Host Pipeline的Error Report Valve和Host Value–&gt;Context Valve–&gt;Wrapper Valve中，在这里会经过一个过滤器链（Filter Chain）–&gt;Servlet中。<br>Servlet处理完成后一步步返回，最后Connector拿到response。</p>
<h2 id="3-3接口及默认实现"><a href="#3-3接口及默认实现" class="headerlink" title="3.3接口及默认实现"></a>3.3接口及默认实现</h2><p>接口中定义的方法:<br><img src="/images/dn.net-20161007001421097.png" alt="接口中定义的方法"><br>一个pipeline包含多个Valve，这些阀共分为两类，一类叫基础阀（通过getBasic、setBasic方法调用），一类是普通阀（通过addValve、removeValve调用）。管道都是包含在容器中，所以有getContainer和setContainer方法。一个管道一般有一个基础阀（通过setBasic添加），可以有0到多个普通阀（通过addValve添加）。<br>isAsyncSupported：当管道中的所有阀门都支持异步时返回ture，否则返回false<br>该接口的标准实现是：**</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.catalina.core.StandardPipeline</span><br></pre></td></tr></table></figure>
<p>**<br>Engine、Host、Context及Wrapper的pipeline属性都继承自父类ContainerBase。</p>
<p>接口方法:<br><img src="/images/dn.net-20161007002724932.png" alt="这里写图片描述"><br>重点关注setNext、getNext、invoke这三个方法，通过setNext设置该阀的下一阀，通过getNext返回该阀的下一个阀的引用，invoke方法则执行该阀内部自定义的请求处理代码。<br>ValveBase：是Valve接口的基本实现<br>四大容器类r都有各自缺省的标准valve实现。它们分别是</p>
<p><img src="/images/dn.net-20161007003208809.png" alt="这里写图片描述"></p>
<p>Valve实现了具体业务逻辑单元。可以定制化valve（实现特定接口），然后配置在server.xml里。每层容器都可以配置相应的valve，当只在其作用域内有效。例如engine容器里的valve只对其包含的所有host里的应用有效。<br>配置举例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;Engine name=<span class="string">"Catalina"</span> defaultHost=<span class="string">"localhost"</span>&gt;  </span><br><span class="line">  &lt;Valve className=<span class="string">"MyValve0"</span>/&gt;  </span><br><span class="line">  &lt;Valve className=<span class="string">"MyValve1"</span>/&gt;  </span><br><span class="line">  &lt;Valve className=<span class="string">"MyValve2"</span>/&gt;  </span><br><span class="line">   ……  </span><br><span class="line">  &lt;Host name=<span class="string">"localhost"</span>  appBase=<span class="string">"webapps"</span>&gt;  </span><br><span class="line">  &lt;<span class="regexp">/Host&gt;  </span></span><br><span class="line"><span class="regexp">&lt;/</span>Engine&gt;</span><br></pre></td></tr></table></figure>

<p>当在server.xml文件中配置了一个定制化valve时，会调用pipeline对象的addValve方法，将valve以链表方式组织起来，代码如下;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    public <span class="keyword">void</span> addValve(Valve valve) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Validate that we can add this Valve</span></span><br><span class="line">        <span class="keyword">if</span> (valve <span class="keyword">instanceof</span> Contained)</span><br><span class="line">            ((Contained) valve).setContainer(<span class="keyword">this</span>.container);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Start the new component if necessary</span></span><br><span class="line">        <span class="keyword">if</span> (getState().isAvailable()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (valve <span class="keyword">instanceof</span> Lifecycle) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ((Lifecycle) valve).start();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (LifecycleException e) &#123;</span><br><span class="line">                    log.error(<span class="string">"StandardPipeline.addValve: start: "</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add this Valve to the set associated with this Pipeline</span></span><br><span class="line">        <span class="comment">//将配置的valve添加到链表中，并且每个容器的标准valve在链表的尾端 </span></span><br><span class="line">        <span class="keyword">if</span> (first == <span class="literal">null</span>) &#123;</span><br><span class="line">            first = valve;</span><br><span class="line">            valve.setNext(basic);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Valve current = first;</span><br><span class="line">            <span class="keyword">while</span> (current != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (current.getNext() == basic) &#123;</span><br><span class="line">                    current.setNext(valve);</span><br><span class="line">                    valve.setNext(basic);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                current = current.getNext();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        container.fireContainerEvent(Container.ADD_VALVE_EVENT, valve);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>valve按照容器作用域的配置顺序来组织valve，每个valve都设置了指向下一个valve的next引用。同时，每个容器缺省的标准valve都存在于valve链表尾端，最后被调用。<br>Pipeline内部维护first和basic两个阀，其它相关阀通过getNext来获取。</p>
<p><strong>标准valve的调用逻辑图：</strong><br><img src="/images/dn.net-20161007004829253.png" alt="这里写图片描述"><br>从StandardEngineValve开始， **所有的基础阀的实现最后都会调用其下一级容器，所有的普通阀都会执行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getNext().invoke(request, response);</span><br></pre></td></tr></table></figure>
<p>**，一直到StandardWrapperValve，完成请求处理过程。因为Wrapper是对一个Servlet的包装，所以它的基础阀内部调用的过滤器链的doFilter方法和Servlet的service方法。<br>上述机制保证了请求传递到servlet去处理。</p>
<p>当采用tomcat默认初始配置时，Valve链如下：<br><img src="/images/dn.net-20161007005430411.png" alt="这里写图片描述"><br>这些阀门Valve通过invoke方法彼此串联起来，最终构成的执行顺序十分类似于一个管道。</p>
<h1 id="4-Tomcat中的设计模式"><a href="#4-Tomcat中的设计模式" class="headerlink" title="4.Tomcat中的设计模式"></a>4.Tomcat中的设计模式</h1><h2 id="4-1模板方法模式"><a href="#4-1模板方法模式" class="headerlink" title="4.1模板方法模式"></a>4.1模板方法模式</h2><p><strong>把通用的骨架步骤抽象到父类中，子类去实现特定的某些步骤。</strong><br>举例：<br>如LifecycleBase类中init和start方法，其中的nitInternal和startInternal方法是抽象方法，所有容易都直接或间接继承了LifecycleBase，在初始化和启动时被每个容器会调用其init和start方法，这些抽象方法都是在子类中实现的。</p>
<h2 id="4-2责任链模式"><a href="#4-2责任链模式" class="headerlink" title="4.2责任链模式"></a>4.2责任链模式</h2><h2 id="4-3观察者模式"><a href="#4-3观察者模式" class="headerlink" title="4.3观察者模式"></a>4.3观察者模式</h2><p>Tomcat通过LifecycleListener对组件生命周期组件Lifecycle进行监听，各个组件在其生命期中会有各种行为，而这些行为都会触发相应的事件，Tomcat就是通过侦听这些事件达到对这些行为进行扩展的目的。在看组件的init和start过程中会看到大量如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fireLifecycleEvent(CONFIGURE_START_EVENT, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<p>这样的代码，这就是对某一类型事件的触发，如果你想在其中加入自己的行为，就只用注册相应类型的事件即可。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2018/09/10/%E3%80%90%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80%E3%80%91%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%B8%8E%E6%95%B0%E3%80%81%E5%AD%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/10/%E3%80%90%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80%E3%80%91%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%B8%8E%E6%95%B0%E3%80%81%E5%AD%97/" class="post-title-link" itemprop="url">【计算机理论基础】二进制与数、字</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-10 13:36:12" itemprop="dateCreated datePublished" datetime="2018-09-10T13:36:12+08:00">2018-09-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">计算机科学基础</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/09/10/%E3%80%90%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80%E3%80%91%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%B8%8E%E6%95%B0%E3%80%81%E5%AD%97/" class="post-meta-item leancloud_visitors" data-flag-title="【计算机理论基础】二进制与数、字" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2018/09/10/%E3%80%90%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80%E3%80%91%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%B8%8E%E6%95%B0%E3%80%81%E5%AD%97/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/09/10/%E3%80%90%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80%E3%80%91%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%B8%8E%E6%95%B0%E3%80%81%E5%AD%97/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>计算机底层说到底是一堆电路，一个电路只有2种状态：通和不通。N个电路就可以有2^N次个状态的组合，它们排列组合成一个序列。<br>这个序列被人设的，按照规则进行了解释。<br>一堆无序的排列组合需要赋予人类世界的意义，所以确立了二进制到符号（字符、数字）的规则。<br>符号是被认为携带意义的感知。<br>意义就是一个符号可以被另外的符号解释的潜力。符号之间解释的链，即可达到信息交换的目的。</p>
<p>我们学习就是要理解这种既定的规则。</p>
<p>人类世界沟通和交流用的是语言和符号，不同母语的国家交流需要翻译。计算机与人类传递信息，需要翻译。</p>
<p>主要（目前我的理解深度而言）两大类：</p>
<p>尽管在计算机内部，数字的表象被包含在字符内，也就是字符集中有可以表示数字的字符，但从作用上来说，表象和实质还是有差异。从代码上来看差异：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int a=<span class="number">124</span>;</span><br><span class="line">string b=<span class="string">"124"</span>;</span><br><span class="line">char c=<span class="string">'124'</span>;</span><br><span class="line"><span class="comment">//没写过程序的人看到124，认为他们是一个东西。但是在计算内部，却是3种信息。</span></span><br><span class="line"><span class="comment">//代码写的是人，但是传递给计算机处理的时候，负责解释这些字符的是编译器。</span></span><br></pre></td></tr></table></figure>

<h1 id="理解byte"><a href="#理解byte" class="headerlink" title="理解byte"></a>理解byte</h1><p>计算机中一个电子元件的状态是1bit（通或不通），而人设的规定存储信息的<strong>最小单元</strong>是一个字节即 8 个 bit，即1byte。<br>这里byte的意义有两种：</p>
<p>它组合是：<br>00000000-11111111<br>被解释为10进制的0-256（2^8次方）种变化的信息量。</p>
<h1 id="数的规则"><a href="#数的规则" class="headerlink" title="数的规则"></a>数的规则</h1><p>主要围绕着二进制如何被解释为数，或者反向的数如何用二进制来表达。</p>
<h2 id="数分配的存储资源大小"><a href="#数分配的存储资源大小" class="headerlink" title="数分配的存储资源大小"></a>数分配的存储资源大小</h2><p>Java中八种基本数据类型：short、int、long、float、double、boolean、byte、char。每种类型都按传统规定了存储在计算机当中占据空间的大小，好比限定了装载这些数的盒子。<br>byte b; 1字节<br>short s; 2字节<br>int i; 4字节<br>long l; 8字节<br>float f; 4字节<br>double d; 8字节<br>boolean bool; false/true 1字节<br>char c; 2字节（C语言中是1字节）<br>为什么要这么做呢？这是一个很有意思的问题，根本上说还是在于计算机资源是有限的。人设的规定数据范围和大小，是为了限定申请资源方对计算机资源占用过多，或者说是为了让计算机“物尽其用”，合适的大小在性能上也有一定差异。所以出现的溢出（通俗的说是给装载数的壳子被数给撑爆了），未考虑到场景下的数的大小。<br>计算机资源是有限的，所以无法表征无理数及无限循环小数，只能在精度范围内取近似值。</p>
<h2 id="数的范围"><a href="#数的范围" class="headerlink" title="数的范围"></a>数的范围</h2><p>数的范围是排列组合的范围。<br>分有符号和无符号，有符号的首位做符号位。<br>无符号范围：0 –（2的N次方）-1<br>有符号范围：负的（2的N-1次方）到（2的N-1次方）-1</p>
<p>如short</p>
<h1 id="字的规则"><a href="#字的规则" class="headerlink" title="字的规则"></a>字的规则</h1><p>涉及到编码。网上文章很多，比如<a href="https://www.cnblogs.com/jessonluo/p/4800331.html" target="_blank" rel="noopener">计算机编码总结</a>。<br>也可以看看这篇：<a href="https://blog.csdn.net/hezh1994/article/details/78899683" target="_blank" rel="noopener">彻底弄懂uinicode编码</a></p>
<h1 id="计算机内的信息流转"><a href="#计算机内的信息流转" class="headerlink" title="计算机内的信息流转"></a>计算机内的信息流转</h1><p>最终处理的都是二进制的信号；<br>为了方便计算机和人类信息传递，出现了不同层次的语言（一系列规则）：</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2018/08/15/shell%E4%B8%AD%E5%90%84%E7%A7%8D%E6%8B%AC%E5%8F%B7%E7%9A%84%E4%BD%9C%E7%94%A8%E8%AF%A6%E8%A7%A3()%E3%80%81(())%E3%80%81%5B%5D%E3%80%81%5B%5B%5D%5D%E3%80%81%7B%7D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/15/shell%E4%B8%AD%E5%90%84%E7%A7%8D%E6%8B%AC%E5%8F%B7%E7%9A%84%E4%BD%9C%E7%94%A8%E8%AF%A6%E8%A7%A3()%E3%80%81(())%E3%80%81%5B%5D%E3%80%81%5B%5B%5D%5D%E3%80%81%7B%7D/" class="post-title-link" itemprop="url">shell中各种括号的作用详解()、(())、[]、[[]]、{}</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-08-15 20:26:31" itemprop="dateCreated datePublished" datetime="2018-08-15T20:26:31+08:00">2018-08-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index">
                    <span itemprop="name">Linux管理维护</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/08/15/shell%E4%B8%AD%E5%90%84%E7%A7%8D%E6%8B%AC%E5%8F%B7%E7%9A%84%E4%BD%9C%E7%94%A8%E8%AF%A6%E8%A7%A3()%E3%80%81(())%E3%80%81%5B%5D%E3%80%81%5B%5B%5D%5D%E3%80%81%7B%7D/" class="post-meta-item leancloud_visitors" data-flag-title="shell中各种括号的作用详解()、(())、[]、[[]]、{}" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2018/08/15/shell%E4%B8%AD%E5%90%84%E7%A7%8D%E6%8B%AC%E5%8F%B7%E7%9A%84%E4%BD%9C%E7%94%A8%E8%AF%A6%E8%A7%A3()%E3%80%81(())%E3%80%81%5B%5D%E3%80%81%5B%5B%5D%5D%E3%80%81%7B%7D/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/08/15/shell%E4%B8%AD%E5%90%84%E7%A7%8D%E6%8B%AC%E5%8F%B7%E7%9A%84%E4%BD%9C%E7%94%A8%E8%AF%A6%E8%A7%A3()%E3%80%81(())%E3%80%81%5B%5D%E3%80%81%5B%5B%5D%5D%E3%80%81%7B%7D/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>①<strong>命令组</strong>。括号中的命令将会新开一个子shell顺序执行，所以括号中的变量不能够被脚本余下的部分使用。括号中多个命令之间用分号隔开，最后一个命令可以没有分号，各命令和括号之间不必有空格。</p>
<p>②<strong>命令替换</strong>。等同于<code>cmd</code>，shell扫描一遍命令行，发现了(cmd)结构，便将 (   c   m   d   )    结     构     ，     便     将(cmd)中的cmd执行一次，得到其标准输出，再将此输出放到原来命令。有些shell不支持，如tcsh。</p>
<p>③<strong>用于初始化数组</strong>。如：array=(a b c d)</p>
<p>①<strong>整数扩展</strong>。这种扩展计算是整数型的计算，不支持浮点型。((exp))结构扩展并计算一个算术表达式的值，如果表达式的结果为0，那么返回的退出状态码为1，或者 是”假”，而一个非零值的表达式所返回的退出状态码将为0，或者是”true”。若是逻辑判断，表达式exp为真则为1,假则为0。</p>
<p>②只要括号中的运算符、表达式符合C语言运算规则，都可用在((exp))中，甚至是三目运算符。作不同进位(如二进制、八进制、十六进制)运算时，输出结果全都自动转化成了十进制。如：echo (   (   e   x   p   )   )    中     ，     甚     至     是     三     目     运     算     符     。     作     不     同     进     位    (    如     二     进     制     、     八     进     制     、     十     六     进     制    )    运     算     时     ，     输     出     结     果     全     都     自     动     转     化     成     了     十     进     制     。     如     ：    e   c   h   o((16/#5f)) 结果为95 (16进位转十进制)</p>
<p>③单纯用 (( )) 也可<strong>重定义变量值</strong>，比如 a=5; ((a++)) 可将 $a 重定义为6</p>
<p>④常用于<strong>算术运算比较</strong>，双括号中的变量可以不使用$符号前缀。括号内支持多个表达式用逗号分开。 只要括号中的表达式符合C语言运算规则,比如可以直接使用for((i=0;i&lt;5;i++)), 如果不使用双括号, 则为for i in <code>seq 0 4</code>或者for i in {0..4}。再如可以直接使用if (($i&lt;5)), 如果不使用双括号, 则为if [ $i -lt 5 ]。</p>
<h2 id="二、中括号，方括号"><a href="#二、中括号，方括号" class="headerlink" title="二、中括号，方括号[]"></a>二、中括号，方括号[]</h2><p>①<strong>bash 的内部命令，[和test是等同的</strong>。如果我们不用绝对路径指明，通常我们用的都是bash自带的命令。if/test结构中的左中括号是调用test的命令标识，右中括号是关闭条件判断的。这个命令把它的参数作为比较表达式或者作为文件测试，并且根据比较的结果来返回一个退出状态码。if/test结构中并不是必须右中括号，但是新版的Bash中要求必须这样。</p>
<p>②Test和[]中可用的比较运算符只有==和!=，两者都是用于字符串比较的，不可用于整数比较，整数比较只能使用-eq，-gt这种形式。无论是字符串比较还是整数比较都不支持大于号小于号。如果实在想用，对于字符串比较可以使用转义形式，如果比较”ab”和”bc”：[ ab &lt; bc ]，结果为真，也就是返回状态为0。[ ]中的逻辑与和逻辑或使用-a 和-o 表示。</p>
<p>③<strong>字符范围</strong>。用作正则表达式的一部分，描述一个匹配的字符范围。作为test用途的中括号内不能使用正则。</p>
<p>④在一个array 结构的上下文中，中括号用来<strong>引用数组中每个元素的编号</strong>。</p>
<p>①<strong>[[是 bash 程序语言的关键字</strong>。并不是一个命令，[[ ]] 结构比[ ]结构更加通用。在[[和]]之间所有的字符都不会发生文件名扩展或者单词分割，但是会发生参数扩展和命令替换。</p>
<p>②<strong>支持字符串的模式匹配</strong>，使用=~操作符时甚至支持shell的正则表达式。字符串比较时可以把右边的作为一个模式，而不仅仅是一个字符串，比如[[ hello == hell? ]]，结果为真。[[ ]] 中匹配字符串或通配符，不需要引号。</p>
<p>③使用[[ … ]]条件判断结构，而不是[ … ]，能够防止脚本中的许多逻辑错误。比如，&amp;&amp;、||、&lt;和&gt; 操作符能够正常存在于[[ ]]条件判断结构中，但是如果出现在[ ]结构中的话，会报错。比如可以直接使用if [[ $a != 1 &amp;&amp; $a != 2 ]], 如果不适用双括号, 则为if [ $a -ne 1] &amp;&amp; [ $a != 2 ]或者if [ $a -ne 1 -a $a != 2 ]。</p>
<p>④bash把双中括号中的表达式看作一个单独的元素，并返回一个退出状态码。</p>
<p>例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($i&lt;<span class="number">5</span>) </span><br><span class="line"><span class="keyword">if</span> [ $i -lt <span class="number">5</span> ] </span><br><span class="line"><span class="keyword">if</span> [ $a -ne <span class="number">1</span> -a $a != <span class="number">2</span> ] </span><br><span class="line"><span class="keyword">if</span> [ $a -ne <span class="number">1</span>] &amp;&amp; [ $a != <span class="number">2</span> ] </span><br><span class="line"><span class="keyword">if</span> [[ $a != <span class="number">1</span> &amp;&amp; $a != <span class="number">2</span> ]] </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq <span class="number">0</span> <span class="number">4</span>);<span class="keyword">do</span> echo $i;done </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">`seq 0 4`</span>;<span class="keyword">do</span> echo $i;done </span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++));<span class="keyword">do</span> echo $i;done </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;<span class="number">0.</span><span class="number">.4</span>&#125;;<span class="keyword">do</span> echo $i;done</span><br></pre></td></tr></table></figure>

<h2 id="三、大括号、花括号"><a href="#三、大括号、花括号" class="headerlink" title="三、大括号、花括号 {}"></a>三、大括号、花括号 {}</h2><p>①<strong>大括号拓展</strong>。(通配(globbing))将对大括号中的文件名做扩展。在大括号中，不允许有空白，除非这个空白被引用或转义。第一种：对大括号中的以逗号分割的文件列表进行拓展。如 touch {a,b}.txt 结果为a.txt b.txt。第二种：对大括号中以点点（..）分割的顺序文件列表起拓展作用，如：touch {a..d}.txt 结果为a.txt b.txt c.txt d.txt</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ls &#123;ex1,ex2&#125;.sh </span><br><span class="line">ex1.sh ex2.sh </span><br><span class="line"># ls &#123;ex&#123;1..3&#125;,ex4&#125;.sh </span><br><span class="line">ex1.sh ex2.sh ex3.sh ex4.sh </span><br><span class="line"># ls &#123;ex[1-3],ex4&#125;.sh </span><br><span class="line">ex1.sh ex2.sh ex3.sh ex4.sh</span><br></pre></td></tr></table></figure>

<p>②<strong>代码块</strong>，又被称为内部组，这个结构事实上创建了一个匿名函数 。与小括号中的命令不同，大括号内的命令不会新开一个子shell运行，即脚本余下部分仍可使用括号内变量。括号内的命令间用分号隔开，最后一个也必须有分号。{}的第一个命令和左括号之间必须要有一个空格。</p>
<p>var:−string, v   a   r   :   −   s   t   r   i   n   g    ,{var:+string},var:=string, v   a   r   :=   s   t   r   i   n   g    ,{var:?string}</p>
<p>①var:−string和 v   a   r   :   −   s   t   r   i   n   g     和{var:=string}:若变量var为空，则用在命令行中用string来替换var:−string，否则变量var不为空时，则用变量var的值来替换 v   a   r   :   −   s   t   r   i   n   g     ，     否     则     变     量    v   a   r    不     为     空     时     ，     则     用     变     量    v   a   r    的     值     来     替     换{var:-string}；对于var:=string的替换规则和 v   a   r   :=   s   t   r   i   n   g     的     替     换     规     则     和{var:-string}是一样的，所不同之处是var:=string若var为空时，用string替换 v   a   r   :=   s   t   r   i   n   g     若    v   a   r    为     空     时     ，     用    s   t   r   i   n   g    替     换{var:=string}的同时，把string赋给变量var： ${var:=string}很常用的一种用法是，判断某个变量是否赋值，没有的话则给它赋上一个默认值。</p>
<p>② ${var:+string}的替换规则和上面的相反，即只有当var不是空的时候才替换成string，若var为空时则不替换或者说是替换成变量 var的值，即空值。(因为变量var此时为空，所以这两种说法是等价的)</p>
<p>③var:?string替换规则为：若变量var不为空，则用变量var的值来替换 v   a   r   :   ?   s   t   r   i   n   g     替     换     规     则     为     ：     若     变     量    v   a   r    不     为     空     ，     则     用     变     量    v   a   r    的     值     来     替     换{var:?string}；若变量var为空，则把string输出到标准错误中，并从脚本中退出。我们可利用此特性来检查是否设置了变量的值。</p>
<p>补充扩展：在上面这五种替换结构中string不一定是常值的，可用另外一个变量的值或是一种命令的输出。</p>
<p>模式匹配记忆方法：/# 是去掉左边(在键盘上/#在之左边) 之     左     边    )之右边)/#和%中的单一符号是最小匹配，两个相同符号是最大匹配。</p>
<p>${var%pattern},${var%%pattern},${var/#pattern},${var/#/#pattern}</p>
<p>第一种模式：${variable%pattern}，这种模式时，shell在variable中查找，看它是否一给的模式pattern结尾，如果是，就从命令行把variable中的内容去掉右边最短的匹配模式</p>
<p>第二种模式： ${variable%%pattern}，这种模式时，shell在variable中查找，看它是否一给的模式pattern结尾，如果是，就从命令行把variable中的内容去掉右边最长的匹配模式</p>
<p>第三种模式：${variable/#pattern} 这种模式时，shell在variable中查找，看它是否一给的模式pattern开始，如果是，就从命令行把variable中的内容去掉左边最短的匹配模式</p>
<p>第四种模式： ${variable/#/#pattern} 这种模式时，shell在variable中查找，看它是否一给的模式pattern结尾，如果是，就从命令行把variable中的内容去掉右边最长的匹配模式</p>
<p>这四种模式中都不会改变variable的值，其中，只有在pattern中使用了<em>匹配符号时，%和%%，/#和/#/#才有区别。结构中的pattern支持通配符，</em>表示零个或多个任意字符，?表示仅与一个任意字符匹配，[…]表示匹配中括号里面的字符，[!…]表示不匹配中括号里面的字符。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># var=testcase </span><br><span class="line"># echo $var </span><br><span class="line">testcase </span><br><span class="line"># echo $&#123;var%s*e&#125; </span><br><span class="line">testca </span><br><span class="line"># echo $var </span><br><span class="line">testcase </span><br><span class="line"># echo $&#123;var%%s*e&#125; </span><br><span class="line">te </span><br><span class="line"># echo $&#123;var#?e&#125; </span><br><span class="line">stcase </span><br><span class="line"># echo $&#123;var##?e&#125; </span><br><span class="line">stcase </span><br><span class="line"># echo $&#123;var##*e&#125; </span><br><span class="line"></span><br><span class="line"># echo $&#123;var##*s&#125; </span><br><span class="line">e </span><br><span class="line"># echo $&#123;var##test&#125; </span><br><span class="line"><span class="keyword">case</span></span><br></pre></td></tr></table></figure>

<p>var:num, v   a   r   :   n   u   m    ,{var:num1:num2},var/pattern/pattern, v   a   r    /    p   a   t   t   e   r   n    /    p   a   t   t   e   r   n    ,{var//pattern/pattern}</p>
<p>第一种模式：var:num，这种模式时，shell在var中提取第num个字符到末尾的所有字符。若num为正数，从左边0处开始；若num为负数，从右边开始提取字串，但必须使用在冒号后面加空格或一个数字或整个num加上括号，如 v   a   r   :   n   u   m     ，     这     种     模     式     时     ，    s   h   e   l   l    在    v   a   r    中     提     取     第    n   u   m    个     字     符     到     末     尾     的     所     有     字     符     。     若    n   u   m    为     正     数     ，     从     左     边    0    处     开     始     ；     若    n   u   m    为     负     数     ，     从     右     边     开     始     提     取     字     串     ，     但     必     须     使     用     在     冒     号     后     面     加     空     格     或     一     个     数     字     或     整     个    n   u   m    加     上     括     号     ，     如{var: -2}、var:1−3或 v   a   r   :   1   −   3     或{var:(-2)}。</p>
<p>第二种模式：var:num1:num2，num1是位置，num2是长度。表示从 v   a   r   :   n   u   m   1   :   n   u   m   2     ，    n   u   m   1    是     位     置     ，    n   u   m   2    是     长     度     。     表     示     从var字符串的第num1个位置开始提取长度为 n   u   m   1    个     位     置     开     始     提     取     长     度     为num2的子串。不能为负数。</p>
<p>第三种模式：${var/pattern/pattern}表示将var字符串的第一个匹配的pattern替换为另一个pattern。</p>
<p>第四种模式：${var//pattern/pattern}表示将var字符串中的所有能匹配的pattern替换为另一个pattern。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# var=/home/centos </span><br><span class="line">[root@centos ~]# echo $var </span><br><span class="line">/home/centos </span><br><span class="line">[root@centos ~]# echo $&#123;var:5&#125; </span><br><span class="line">/centos </span><br><span class="line">[root@centos ~]# echo $&#123;var: -6&#125; </span><br><span class="line">centos </span><br><span class="line">[root@centos ~]# echo $&#123;var:(-6)&#125; </span><br><span class="line">centos </span><br><span class="line">[root@centos ~]# echo $&#123;var:1:4&#125; </span><br><span class="line">home </span><br><span class="line">[root@centos ~]# echo $&#123;var/o/h&#125; </span><br><span class="line">/hhme/centos </span><br><span class="line">[root@centos ~]# echo $&#123;var//o/h&#125; </span><br><span class="line">/hhme/cenths</span><br></pre></td></tr></table></figure>

<h2 id="四、符号-后的括号"><a href="#四、符号-后的括号" class="headerlink" title="四、符号$后的括号"></a>四、符号$后的括号</h2><p>（1）${a} 变量a的值, 在不引起歧义的情况下可以省略大括号。</p>
<p>（2）(cmd)命令替换，和‘cmd‘效果相同，结果为shell命令cmd的输，过某些Shell版本不支持 (   c   m   d   )    命     令     替     换     ，     和    ‘   c   m   d   ‘    效     果     相     同     ，     结     果     为    s   h   e   l   l    命     令    c   m   d    的     输     ，     过     某     些    S   h   e   l   l    版     本     不     支     持()形式的命令替换, 如tcsh。</p>
<p>（3）$((expression)) 和<code>exprexpression</code>效果相同, 计算数学表达式exp的数值, 其中exp只要符合C语言的运算规则即可, 甚至三目运算符和逻辑表达式都可以计算。</p>
<h2 id="五、使用"><a href="#五、使用" class="headerlink" title="五、使用"></a>五、使用</h2><p>（1）单小括号，(cmd1;cmd2;cmd3) 新开一个子shell顺序执行命令cmd1,cmd2,cmd3, 各命令之间用分号隔开, 最后一个命令后可以没有分号。</p>
<p>（2）单大括号，{ cmd1;cmd2;cmd3;} 在当前shell顺序执行命令cmd1,cmd2,cmd3, 各命令之间用分号隔开, 最后一个命令后必须有分号, 第一条命令和左括号之间必须用空格隔开。<br>对{}和()而言, 括号中的重定向符只影响该条命令， 而括号外的重定向符影响到括号中的所有命令。</p>
<p>原文地址：<a href="http://www.cnblogs.com/Q--T/archive/2017/09/06/7486872.html" target="_blank" rel="noopener">http://www.cnblogs.com/Q–T/archive/2017/09/06/7486872.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2018/07/28/%E5%9B%BE%E7%81%B5%E6%9C%BA%E7%9A%84%E9%80%BB%E8%BE%91%E7%AD%89%E4%BB%B7%E5%BD%A2%E5%BC%8F%E2%80%94%E2%80%94lambda%E6%BC%94%E7%AE%97%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/28/%E5%9B%BE%E7%81%B5%E6%9C%BA%E7%9A%84%E9%80%BB%E8%BE%91%E7%AD%89%E4%BB%B7%E5%BD%A2%E5%BC%8F%E2%80%94%E2%80%94lambda%E6%BC%94%E7%AE%97%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">图灵机的逻辑等价形式——lambda演算简介</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-28 17:07:31" itemprop="dateCreated datePublished" datetime="2018-07-28T17:07:31+08:00">2018-07-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">计算机科学基础</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/07/28/%E5%9B%BE%E7%81%B5%E6%9C%BA%E7%9A%84%E9%80%BB%E8%BE%91%E7%AD%89%E4%BB%B7%E5%BD%A2%E5%BC%8F%E2%80%94%E2%80%94lambda%E6%BC%94%E7%AE%97%E7%AE%80%E4%BB%8B/" class="post-meta-item leancloud_visitors" data-flag-title="图灵机的逻辑等价形式——lambda演算简介" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2018/07/28/%E5%9B%BE%E7%81%B5%E6%9C%BA%E7%9A%84%E9%80%BB%E8%BE%91%E7%AD%89%E4%BB%B7%E5%BD%A2%E5%BC%8F%E2%80%94%E2%80%94lambda%E6%BC%94%E7%AE%97%E7%AE%80%E4%BB%8B/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/07/28/%E5%9B%BE%E7%81%B5%E6%9C%BA%E7%9A%84%E9%80%BB%E8%BE%91%E7%AD%89%E4%BB%B7%E5%BD%A2%E5%BC%8F%E2%80%94%E2%80%94lambda%E6%BC%94%E7%AE%97%E7%AE%80%E4%BB%8B/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="译者述"><a href="#译者述" class="headerlink" title="译者述"></a>译者述</h1><p>才疏学浅，非数学专业，翻译尽量尊重原文，如有纰漏，海涵。</p>
<h1 id="论文摘要"><a href="#论文摘要" class="headerlink" title="论文摘要"></a>论文摘要</h1><p>这篇论文是一篇简短易懂的lambda演算介绍。λ-calculus（lambda演算）是Alonzo Church开创，最初是作为研究数学函数的可计算性的相关属性的工具，随着它的流行，其逐渐成为函数编程语言家族强有力的理论基础。这篇简介展示了利用lambda演算如何构建算数和逻辑的数学计算，以及如何定义递归函数（尽管lambda演算子中的函数是匿名的，因此它们不能被显示引用，我们仍然可以定义递归函数）。</p>
<h1 id="1-定义Definition"><a href="#1-定义Definition" class="headerlink" title="1 定义Definition"></a>1 定义Definition</h1><p>lambda演算子可以说是世界上最小的通用编程语言。lambda演算子由一个单一转换规则(变量替换，通常被叫做β-conversion，β变换)和一个单一函数定义系统构成。它在1930年代被Alonzo Church作为一个方法引入有效计算能力的概念的形式化中。lambda演算子是通用的，是因为任意可计算函数可以使用此形式表达和求值。因此它等价于图灵机（这也是为什么我费劲翻译原文的原因）。尽管如此，lambda演算子强调的是符号变换规则的使用，却并不关心实际机器是如何实现这些规则的。这是一个更接近软件而不是硬件的方法。</p>
<p>lambda演算子的核心概念是“表达式”（“expression”）。一个“名字”，也被叫做“变量”，是一个标示符，它可以是任意字母a, b, c… 一个表达式可能只是一个名字或者可能是一个函数（function）。函数使用希腊字母λ来来表示函数变量的名字。函数体（body）指定变量名如何排列。身份函数（The identity function），例如：字符串(λx.x）可以代表一个身份函数，字符串中的“λx”告诉我们函数的变量是“x”，“x”是被函数体不做任何改变的返回了。</p>
<p>函数可以被其他的函数使用。比如，函数A被用在了函数B中，可以写为“AB”的形式。注意在本文中，大写的字母被专门用来表示<strong>函数</strong>。实际上，Lambda演算中任何元素都可是函数，就连数字或者逻辑值都使用可以相互作用的函数来表示，它们是通过符号的字符串转换成另一种符号的字符串达到目的的。所以Lambda演算中没有类型一说，任何函数可以作用于其他函数。开发者的责任是保证计算指令的合理性。</p>
<p>表达式被第归的定义如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt; expression &gt; := <span class="xml"><span class="tag">&lt; <span class="attr">name</span> &gt;</span>|<span class="tag">&lt; <span class="attr">function</span> &gt;</span>|<span class="tag">&lt; <span class="attr">application</span> &gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt; <span class="attr">function</span> &gt;</span> := λ <span class="tag">&lt; <span class="attr">name</span> &gt;</span> . <span class="tag">&lt; <span class="attr">expression</span> &gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt; <span class="attr">application</span> &gt;</span> := <span class="tag">&lt; <span class="attr">expression</span> &gt;</span><span class="tag">&lt; <span class="attr">expression</span> &gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">译文形式</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">表达式</span>&gt;</span> := <span class="tag">&lt;<span class="name">标识符</span>&gt;</span>|<span class="tag">&lt;<span class="name">函数</span>&gt;</span>|<span class="tag">&lt;<span class="name">应用</span>&gt;</span>       </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">函数</span>&gt;</span> := λ<span class="tag">&lt;<span class="name">标识符</span>&gt;</span> . <span class="tag">&lt;<span class="name">表达式</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">应用</span>&gt;</span> := <span class="tag">&lt;<span class="name">表达式</span>&gt;</span><span class="tag">&lt;<span class="name">表达式</span>&gt;</span></span></span><br><span class="line"><span class="xml">译者注：应用(application )即给函数一个(实际)参数进行求值</span></span><br></pre></td></tr></table></figure>

<p>表达式可以使用括号来包裹以达到清晰表示的目的，比如“E”为一个表达式，”(E)“是等效的（译者加了引号）。另外，这门语言中仅有的两个关键字是”λ “和”.”。为了避免将带括号的表达式混淆，我们约定：函数应用从左边开始关联（左结合），也就是下方的组合表达式：</p>
<p>E 1E 2E 3 . . . E n  可以被下面连续表达式所表示：  (…((E 1E 2)E 3) . . . E n)</p>
<p>从 λ表达式的定义可见，一种优雅的函数表现形式是之前出现过的的字符串，带括号或者不带括号：</p>
<p>λx.x ≡ (λx.x)</p>
<p>当表达式A和表达式B表达相同意义时，我们使用恒等号“A≡B”来表示。上面已介绍过，“λ”右侧的字符是函数的标识符。而”.”后边的表达式是函数体的定义。</p>
<p>函数可以被用在表达式中，下面是这种方式的一个应用（ application）：<br>(λx.x)y  上边的应用是身份函数使用在了标识符（译者注：没有type一说，不存在变量一说，原文用的 variable）y上。括号的使用避免了混淆。函数应用是以替换函数体内参数x的值(在这个例子里是y正在被处理)的方式被求值，图例1（Figure 1）红线部分展示了函数如何使变量“y”被抽象化（原文“absorbed”），绿色部分则展示了y如何替代了x。它的结果是表达式缩减的，用→箭头指示了，终值为y。</p>
<p><img src="/images/dn.net-20181006220940506-watermark-2-text-aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpbmRhbmNoYW9z-font-5a6L5L2T-fontsize-400-fill-I0JBQkFCMA==-dissolve-70.png" alt="在这里插入图片描述"></p>
<p>由于我们也不能总是借助如图例1一样的图片，我们使用[y/x]的符号来表示在函数体内，所有x被y替换。例如，可以书写为：<br>(λx.x)y → [y/x]x → y</p>
<p>函数内的变量名并不代表符号的任何实际的意义，仅仅是占位符，被用来表示函数运行过程中参数如何被编排。所以以下的字符串代表的是同一个函数：</p>
<p>(λz.z) ≡ (λy.y) ≡ (λt.t) ≡ (λu.u)  这种纯粹的字母替换方式也被叫做 α-变换(α-reduction)。</p>
<h2 id="1-1-自由和约束变量Free-and-bound-variables"><a href="#1-1-自由和约束变量Free-and-bound-variables" class="headerlink" title="1.1 自由和约束变量Free and bound variables"></a>1.1 自由和约束变量Free and bound variables</h2><p>如果我们拥有λ表达式的的管道图（直观的），我们并不用过多考虑变量的名称。就如本章节的内容一样，使用了字母作为符号的λ演算，要避免字母的重复，需要我们小心谨慎从处理。<br>在λ演算中，所有的名字都是本地定义的（和大多数编程语言一样）。在函数”λx.x”中，我们说x自它出现在函数体中就被前置的λx约束了。与之对应的，一个没有被约束的变量叫做自由变量（“free variable”，编者注：没有定性的，既可以是函数、也可以是应用、也可以是表达式），在表达式:<br>(λx.x)(λy.yx)  左侧第一个表达式中的x被约束于第一个λ。第二个表达式中，y则被第二个λ约束，它里面的x则是自由的。需要特别注意的是第二个表达式中的x是独立的，和第一个表达式中的x没有任何关系。图例2中，可以很容易看出函数应用的管道图</p>
<p><img src="/images/dn.net-20181006230526624-watermark-2-text-aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpbmRhbmNoYW9z-font-5a6L5L2T-fontsize-400-fill-I0JBQkFCMA==-dissolve-70.png" alt="在这里插入图片描述"><br>图例2中，我们看到第一行中的符号表达式如何被演绎成一种循环，即表达式中的约束变量如何被移动到新的函数体中。第一个函数“消费”了第二个函数。第二个函数的符号x和余下的表达式没有关联，它是在函数定义中自由变量。<br>形式上的，我们说变量在表达式中是自由变量，通常满足以下条件之一即可：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">• &lt;name&gt; is free <span class="keyword">in</span> &lt;name&gt;.</span><br><span class="line">(Example: a is free <span class="keyword">in</span> a).</span><br><span class="line">• &lt;name&gt; is free <span class="keyword">in</span> λ&lt;name1 &gt;. &lt;exp&gt; <span class="keyword">if</span> the identifier &lt;name&gt;!=<span class="xml"><span class="tag">&lt;<span class="name">name1</span> &gt;</span></span></span><br><span class="line">and &lt;name&gt; is free in &lt;exp&gt;.</span><br><span class="line">(Example: y is free in λx.y).</span><br><span class="line">• &lt;name&gt; is free in E1E2 if &lt;name&gt; is free in E1 or if it is free in E2.</span><br><span class="line">(Example: x is free in (λx.x)x).</span><br></pre></td></tr></table></figure>

<p>变量在表达式中是约束变量，通常满足以下条件之一即可：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">• &lt;name&gt; is bound <span class="keyword">in</span> λ &lt;name1 &gt;. &lt;exp&gt; <span class="keyword">if</span> the identifier &lt;name&gt;=<span class="xml"><span class="tag">&lt;<span class="name">name1</span> &gt;</span></span></span><br><span class="line">or if &lt;name&gt; is bound in &lt;exp&gt;.</span><br><span class="line">(Example: x is bound in (λy.(λx.x))).</span><br><span class="line">• &lt;name&gt; is bound in E1E2 if &lt;name&gt; is bound in E1 or if it is bound</span><br><span class="line">in E2.</span><br><span class="line">(Example: x is bound in (λx.x)x).</span><br></pre></td></tr></table></figure>

<h2 id="1-2替换Substitutions"><a href="#1-2替换Substitutions" class="headerlink" title="1.2替换Substitutions"></a>1.2替换Substitutions</h2><p>刚开始接触λ演算，λ演算中让人疑惑的是我们并没有给函数命名。任何时候我们想要使用一个函数，我们只是写下完整的函数定义，接着开始求值。为了简化符号，我们将使用大写字母、数字和其他以写符号来作为某些函数的代名词（表征）。比如，身份函数能够使用字母”I”来简写（λx.x）。<br>身份函数使用自身则是一个应用：<br>II ≡ (λx.x)(λx.x)</p>
<p>上面表达式中，第一个括号内的函数体中的x和第二个括号中的函数体的x是没有联系的，为了强调它们的差异，我们也可以将上面的表达式重写，使用以下表达式表示：</p>
<p>II ≡ (λx.x)(λz.z)  身份函数作用于自己的值域，也就是再次成为I：  [(λz.z)/x]x → λz.z ≡ I,</p>
<p><img src="/images/dn.net-20181007174924596-watermark-2-text-aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpbmRhbmNoYW9z-font-5a6L5L2T-fontsize-400-fill-I0JBQkFCMA==-dissolve-70.png" alt="在这里插入图片描述"><br>我们执行替换时，要注意避免将自由变量混淆成为约束变量。表达式中包含一个约束变量y，但在函数体外还有一个自由变量y，不应该混淆它们。简要处理将一个y，替换（Alpha转换）为下面形式：</p>
<p>(λx.(λt.xt))y  得到表达式：  (λt.yt)  虽然形式上完全不同却是一个正确的结果。 因此，如果函数 λy. &lt; exp &gt;被运用到E，我们就用E替换掉&lt; exp &gt;中的所有的参数y。如果替换x可能导致E中的自由变量x被转换成约束变量，就在替换前重命名函数中的约束变量y。例如表达式：  (λx.(λy.(x(λx.xy)))) y  我们让第一个x和y关联：  (λy.(x(λx.xy)))  只有第一个x是自由变量，可以被替换。替换前，我们必须重命名变量y以避免和约束变量混淆，于是为：  [y/x] (λt.(x(λx.xt))) → (λt(y(λx.xt)))  （译者注：[y/x]已经定义为：表示x将被y替换）</p>
<p>译者加以下内容[1]以辅助理解：</p>
<p><strong>Alpha转换</strong><br>Alpha是一个重命名操作; 基本上就是说，变量的名称是不重要的：给定Lambda演算中的任意表达式，我们可以修改函数参数的名称，只要我们同时修改函数体内所有对它的自由引用。<br>所以 —— 例如，如果有这样一个表达式：<br>lambda x . if (= x 0) then 1 else x ^ 2<br>我们可以用Alpha转换，将x变成y（写作alpha[x / y]），于是我们有：<br>lambda y . if (= y 0) then 1 else y ^ 2</p>
<p><strong>Beta规约</strong><br>Beta基本上是说，如果你有一个函数应用，你可以对这个函数体中和对应函数标识符相关的部分做替换，替换方法是把标识符用参数值替换。这听起来很费解，但是它用起来却很容易。<br>假设我们有一个函数应用表达式：“ (lambda x . x + 1) 3 “。所谓Beta规约就是，我们可以通过替换函数体（即“x + 1”）来实现函数应用，用数值“3”取代引用的参数“x”。于是Beta规约的结果就是“3 + 1”。<br>一个稍微复杂的例子：(lambda y . (lambda x . x + y)) q。 这是一个挺有意思的表达式，因为应用这个Lambda表达式的结果是另一个Lambda表达式：也就是说，它是一个创建函数的函数。这时候的Beta规约，需要用标识符“q”替换所有的引用参数“y”。所以，其结果是“ lambda x . x + q “。<br>再给一个让你更不爽的例子：“ (lambda x y. x y) (lambda z . z /* z) 3 “。这是一个有两个参数的函数，它(的功能是)把第一个参数应用到第二个参数上。当我们运算时，我们替换第一个函数体中的参数“x”为“lambda z . z /* z “；然后我们用“3”替换参数“y”，得到：“ (lambda z . z /* z) 3 “。 再执行Beta规约，有“3 /* 3”。<br>Beta规则的形式化写法为：<br>lambda x . B e = B[x := e] if free(e) subset free(B[x := e])<br>最后的条件“if free(e) subset free(B[x := e])”说明了为什么我们需要Alpha转换：<strong>我们只有在不引起绑定标识符和自由标识符之间的任何冲突的情况下，才可以做Beta规约：如果标识符“z”在“e”中是自由的，那么我们就需要确保，Beta规约不会导致“z”变成绑定的。如果在“B”中绑定的变量和“e”中的自由变量产生命名冲突，我们就需要用Alpha转换来更改标识符名称，使之不同。</strong><br>例子更能明确这一点：假设我们有一个函数表达式，“ lambda z . (lambda x . x + z) “，现在，假设我们要应用它：<br>(lambda z . (lambda x . x + z)) (x + 2)<br>参数“(x + 2)”中，x是自由的。现在，假设我们不遵守规则直接做Beta规约。我们会得到：<br>lambda x . x + x + 2<br>原先在“x + 2”中自由的的变量现在被绑定了。再假设我们应用该函数：<br>(lambda x . x + x + 2) 3<br>通过Beta规约，我们会得到“3 + 3 + 2”。<br>如果我们按照应有的方式先采用Alpha转换，又该如何？<br>由 alpha[x/y] 有: (lambda z . (lambda y . y + z)) (x + 2)<br>由Beta规约： (lambda y . y + x + 2) 3<br>再由Beta规约： 3 + x + 2 。<br>“3 + x + 2”和“3 + 3 + 2”是非常不同的结果！</p>
<h1 id="2-算数Arithmetic"><a href="#2-算数Arithmetic" class="headerlink" title="2 算数Arithmetic"></a>2 算数Arithmetic</h1><p>编程语言应该具备制定算数计算的能力。在lambda演算中数字是从0开始的，并且以0的后继形式演算出其他数字（“successor of zero”），即“suc(zero)代表1，suc(suc(zero))代表2，以此类推。因为在lambda演算中，我们只能定义函数，所以数字可以以下方函数的方式被定义，0可以被定义为：<br>λs.(λz.z)  函数中有2个参数：s和z。简写为：  λsz.z  明显的在第一个变量s将在演算中被替换，接着是z（。使用这种符号形式，自然数可以如下定义：</p>
<p>0 ≡ λsz.z<br>1 ≡ λsz.s(z)<br>2 ≡ λsz.s(s(z))<br>3 ≡ λsz.s(s(s(z)))</p>
<p>译者加：<br>一个很好的理解办法是将“z”作为是对于零值的命名，而“s”作为后继函数的名称。因此，0是一个仅返回“0”值的函数；1是将后继函数运用到0上一次的函数；2则是将后继函数应用到零的后继上的函数，以此类推。[1]</p>
<p>译者加：<br><img src="/images/rg-api-rest_v1-media-math-render-svg-4234d6babd69a13a183ee913a1efd0c3264da618.png" alt="来自wiki的图片"></p>
<p>以这种方式定义数字的一个好处是，我们能够任意次数的应用一个函数f到一个参数。例如，我们想要应用函数一个带参a的函数f3次，它的值为：<br>3f a → (λsz.s(s(sz)))f a → f(f(f a)).<br>这种定义数字的方式提供了一种其他编程语言中类似“FOR i=1 to 3”的语言结构。数字0被应用于带参a的函数f，则它的值是<br>0f a ≡ (λsz.z)f a → a<br>等价于，将参数a应用于函数0次，返回的是未经改变的a原值。</p>
<p>本章节定义的函数，也可以定义为：<br>S ≡ λnab.a(nab)<br>虽然看起来不太合适，但确实起作用。比如，用0来应用在后继函数上的表达式为：<br>S0 ≡ (λnab.a(nab))0<br>该表达式中，我们将n替换为0，表达式为：<br>λab.a(0ab) → λab.a(b) ≡ 1<br>以此类推:2的值为：<br>S1 ≡ (λnab.a(nab))1 → λab.a(1ab) → λab.a(ab) ≡ 2</p>
<h2 id="2-1-加法Addition"><a href="#2-1-加法Addition" class="headerlink" title="2.1 加法Addition"></a>2.1 加法Addition</h2><p>to do</p>
<h2 id="2-2-乘法-Multiplication"><a href="#2-2-乘法-Multiplication" class="headerlink" title="2.2 乘法 Multiplication"></a>2.2 乘法 Multiplication</h2><p>to do</p>
<h1 id="3-条件语句Conditionals"><a href="#3-条件语句Conditionals" class="headerlink" title="3 条件语句Conditionals"></a>3 条件语句Conditionals</h1><p>to do</p>
<h2 id="3-1逻辑操作Logical-operations"><a href="#3-1逻辑操作Logical-operations" class="headerlink" title="3.1逻辑操作Logical operations"></a>3.1逻辑操作Logical operations</h2><h2 id="3-2一个逻辑测试A-conditional-test"><a href="#3-2一个逻辑测试A-conditional-test" class="headerlink" title="3.2一个逻辑测试A conditional test"></a>3.2一个逻辑测试A conditional test</h2><h2 id="3-3前驱函数The-predecessor-function"><a href="#3-3前驱函数The-predecessor-function" class="headerlink" title="3.3前驱函数The predecessor function"></a>3.3前驱函数The predecessor function</h2><h2 id="3-4等式和不等式Equality-and-inequalities"><a href="#3-4等式和不等式Equality-and-inequalities" class="headerlink" title="3.4等式和不等式Equality and inequalities"></a>3.4等式和不等式Equality and inequalities</h2><h1 id="4递归Recursion"><a href="#4递归Recursion" class="headerlink" title="4递归Recursion"></a>4递归Recursion</h1><p>to do</p>
<h1 id="5给读者习题Projects-for-the-reader"><a href="#5给读者习题Projects-for-the-reader" class="headerlink" title="5给读者习题Projects for the reader"></a>5给读者习题Projects for the reader</h1><p><a href="https://arxiv.org/pdf/1503.09060v1.pdf" target="_blank" rel="noopener">点击下载翻译的源文章</a></p>
<p>其他lambda演算有关的资源：</p>
<p>[1] <a href="http://cgnail.github.io/academic/lambda-index/" target="_blank" rel="noopener">Good Math/Bad Math的Lambda演算系列的中文翻译</a> （有墙需翻）<br><a href="https://blog.csdn.net/houmou/article/details/49617331" target="_blank" rel="noopener">实践中认识lambda演算</a></p>
<p><a href="https://blog.csdn.net/feosun/article/details/2110116" target="_blank" rel="noopener">https://blog.csdn.net/feosun/article/details/2110116</a></p>
<p><a href="http://www.blogjava.net/wxb_nudt/archive/2005/05/15/4311.aspx" target="_blank" rel="noopener">http://www.blogjava.net/wxb_nudt/archive/2005/05/15/4311.aspx</a></p>
<p>编程时函数通常可以有一个参数列表，逻辑学家 Haskell Curry证明可以将一个拥有多个参数的函数转化为只有一个参数的多个函数的连续调用，这一转化过程称为对拥有多个参数的函数的currying/柯里化。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2018/07/21/Appium%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%90%86%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/21/Appium%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%90%86%E8%A7%A3/" class="post-title-link" itemprop="url">Appium的实现理解</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-21 11:54:10" itemprop="dateCreated datePublished" datetime="2018-07-21T11:54:10+08:00">2018-07-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index">
                    <span itemprop="name">自动化测试</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/07/21/Appium%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%90%86%E8%A7%A3/" class="post-meta-item leancloud_visitors" data-flag-title="Appium的实现理解" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2018/07/21/Appium%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%90%86%E8%A7%A3/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/07/21/Appium%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%90%86%E8%A7%A3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文转自：<a href="https://testerhome.com/topics/7352" target="_blank" rel="noopener">TesterHome的文章</a></p>
<p>本文针对appium(version:1.6.4-beta)「比较粗糙」的介绍了下它的源码的实现流程。难免有不妥支出，有任何问题，可直接沟通交流。<br>（本文中没有相应的测试）</p>
<h2 id="Appium的架构"><a href="#Appium的架构" class="headerlink" title="Appium的架构"></a>Appium的架构</h2><p><a href="https://myersguo.github.io/public/appium-packages.png" target="_blank" rel="noopener"></a><br><img src="/images/thub.io-public-appium-packages-.png" alt="appium"><br><a href="https://myersguo.github.io/public/images/appium_ios.png" target="_blank" rel="noopener"></a></p>
<p><img src="/images/thub.io-public-images-appium_ios-.png" alt="appium"><br><a href="https://myersguo.github.io/public/images/apium_android.png" target="_blank" rel="noopener"></a></p>
<p><img src="/images/thub.io-public-images-apium_android-.png" alt="appium"></p>
<p>下载appium的源码，并安装依赖：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="comment">//github.com/appium/appium.git</span></span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p>启动appium:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node .</span><br></pre></td></tr></table></figure>

<p>这个启动命令实际是执行的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node build\main.js</span><br></pre></td></tr></table></figure>
<p>(package.json中指定了main入口)：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"> <span class="string">"main"</span>: <span class="string">"./build/lib/main.js"</span>,</span><br><span class="line">  <span class="string">"bin"</span>: &#123;</span><br><span class="line">    <span class="string">"appium"</span>: <span class="string">"./build/lib/main.js"</span></span><br><span class="line">  &#125;,</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>/build/main.js是由/lib/main.js经babel翻译后的结果，所以，我们来看下/lib/main.js来理解appium的流程。<br>(备注：由于appium源码执行都是执行的编译后的方法，即build目录下，因此如果你想要调试进行测试，需要在各个模块build目录下更改调试,如果更改源码，需要gulp transpile进行编译)</p>
<p><a href="https://myersguo.github.io/public/images/appium_uml.png" target="_blank" rel="noopener"></a><br><img src="/images/thub.io-public-images-appium_uml-.png" alt="appium uml"></p>
<p>appium server端实现了HTTP REST API接口，将client端发来的API请求，解析，发送给执行端。apium server,以及其他的driver（android,ios）都实现了basedriver类。basedriver定义了session的创建，命令的执行方式(cmd执行)。</p>
<p>appium server(appium driver)大致的流程为：</p>
<p>我们看一下<a href="https://github.com/appium/appium/blob/master/lib/main.js" target="_blank" rel="noopener">appium server的源码</a>实现。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; server <span class="keyword">as</span> baseServer &#125; <span class="keyword">from</span> <span class="string">'appium-base-driver'</span>;</span><br><span class="line"><span class="keyword">import</span> getAppiumRouter <span class="keyword">from</span> <span class="string">'./appium'</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span> (<span class="params">args = null</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//解析参数</span></span><br><span class="line">  <span class="keyword">let</span> parser = getParser();</span><br><span class="line">  <span class="keyword">let</span> throwInsteadOfExit = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (args) &#123;</span><br><span class="line">    args = <span class="built_in">Object</span>.assign(&#123;&#125;, getDefaultArgs(), args);</span><br><span class="line">    <span class="keyword">if</span> (args.throwInsteadOfExit) &#123;</span><br><span class="line">      throwInsteadOfExit = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">delete</span> args.throwInsteadOfExit;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    args = parser.parseArgs();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">await</span> logsinkInit(args);</span><br><span class="line">  <span class="keyword">await</span> preflightChecks(parser, args, throwInsteadOfExit);</span><br><span class="line">  <span class="comment">//输出欢迎信息</span></span><br><span class="line">  <span class="keyword">await</span> logStartupInfo(parser, args);</span><br><span class="line">  <span class="comment">//注册接口路由,参见(appium-base-driver\lib\jsonwp\Mjsonwp.js)</span></span><br><span class="line">  <span class="keyword">let</span> router = getAppiumRouter(args);</span><br><span class="line">  <span class="comment">//express server类(appium-base-driver\lib\express\server.js)</span></span><br><span class="line">  <span class="comment">//将注册的路由，传递给express注册.</span></span><br><span class="line">  <span class="keyword">let</span> server = <span class="keyword">await</span> baseServer(router, args.port, args.address);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//是否为appium grid的node节点</span></span><br><span class="line">    <span class="keyword">if</span> (args.nodeconfig !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> registerNode(args.nodeconfig, args.address, args.port);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">await</span> server.close();</span><br><span class="line">    <span class="keyword">throw</span> err;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  process.once(<span class="string">'SIGINT'</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    logger.info(<span class="string">`Received SIGINT - shutting down`</span>);</span><br><span class="line">    <span class="keyword">await</span> server.close();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  process.once(<span class="string">'SIGTERM'</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    logger.info(<span class="string">`Received SIGTERM - shutting down`</span>);</span><br><span class="line">    <span class="keyword">await</span> server.close();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  logServerPort(args.address, args.port);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> server;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment">//路由</span></span><br><span class="line"><span class="comment">//appium.js,下面会讲解路由解析</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAppiumRouter</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> appium = <span class="keyword">new</span> AppiumDriver(args);</span><br><span class="line">  <span class="keyword">return</span> routeConfiguringFunction(appium);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="URL路由解析"><a href="#URL路由解析" class="headerlink" title="URL路由解析"></a>URL路由解析</h4><p>上面说道，路由注册。所有支持的请求都<a href="https://github.com/appium/appium-base-driver/blob/master/lib/mjsonwp/routes.js" target="_blank" rel="noopener">METHOD_MAP</a>这个全局变量里面。它是一个path:commd的对象集合。路由执行过程是：</p>
<p>我们来详细看一下(routeConfiguringFunction)到底做了什么(appium-base-driver\lib\mjsonwp\Mjsonwp.js):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">routeConfiguringFunction</span> (<span class="params">driver</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!driver.sessionExists) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Drivers used with MJSONWP must implement `sessionExists`'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!(driver.executeCommand || driver.execute)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Drivers used with MJSONWP must implement `executeCommand` or `execute`'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// return a function which will add all the routes to the driver</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">app</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//[METHOD_MAP](#route_config),是所有的路由配置,key为path,value为method的数组</span></span><br><span class="line">   <span class="comment">//对METHOD_MAP的配置进行绑定</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> [path, methods] <span class="keyword">of</span> _.toPairs(METHOD_MAP)) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> [method, spec] <span class="keyword">of</span> _.toPairs(methods)) &#123;</span><br><span class="line">        <span class="comment">// set up the express route handler</span></span><br><span class="line">        buildHandler(app, method, path, spec, driver, isSessionCommand(spec.command));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//路由绑定</span></span><br><span class="line"><span class="comment">//示例：</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  '/wd/hub/session': &#123;</span></span><br><span class="line"><span class="comment">    POST: &#123;command: 'createSession', payloadParams: &#123;required: ['desiredCapabilities'], optional: ['requiredCapabilities', 'capabilities']&#125;&#125;</span></span><br><span class="line"><span class="comment">  &#125;,</span></span><br><span class="line"><span class="comment">即:</span></span><br><span class="line"><span class="comment">method: POST</span></span><br><span class="line"><span class="comment">path: /wd/hub/session</span></span><br><span class="line"><span class="comment">spec: array</span></span><br><span class="line"><span class="comment">driver: appium</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildHandler</span> (<span class="params">app, method, path, spec, driver, isSessCmd</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> asyncHandler = <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> jsonObj = req.body;</span><br><span class="line">    <span class="keyword">let</span> httpResBody = &#123;&#125;;</span><br><span class="line">    <span class="keyword">let</span> httpStatus = <span class="number">200</span>;</span><br><span class="line">    <span class="keyword">let</span> newSessionId;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">//判断是否是创建session命令(包含createSession,getStatus,getSessions) </span></span><br><span class="line">      <span class="comment">//是否有session</span></span><br><span class="line">      <span class="keyword">if</span> (isSessCmd &amp;&amp; !driver.sessionExists(req.params.sessionId)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> errors.NoSuchDriverError();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//设置了代理则透传</span></span><br><span class="line">      <span class="keyword">if</span> (isSessCmd &amp;&amp; driverShouldDoJwpProxy(driver, req, spec.command)) &#123;</span><br><span class="line">        <span class="keyword">await</span> doJwpProxy(driver, req, res);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//命令是否支持</span></span><br><span class="line">      <span class="keyword">if</span> (!spec.command) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> errors.NotImplementedError();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//POST参数检查 </span></span><br><span class="line">      <span class="keyword">if</span> (spec.payloadParams &amp;&amp; spec.payloadParams.wrap) &#123;</span><br><span class="line">        jsonObj = wrapParams(spec.payloadParams, jsonObj);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (spec.payloadParams &amp;&amp; spec.payloadParams.unwrap) &#123;</span><br><span class="line">        jsonObj = unwrapParams(spec.payloadParams, jsonObj);</span><br><span class="line">      &#125;</span><br><span class="line">      checkParams(spec.payloadParams, jsonObj);</span><br><span class="line">      <span class="comment">//构造参数</span></span><br><span class="line">      <span class="keyword">let</span> args = makeArgs(req.params, jsonObj, spec.payloadParams || []);</span><br><span class="line">      <span class="keyword">let</span> driverRes;</span><br><span class="line">      <span class="keyword">if</span> (validators[spec.command]) &#123;</span><br><span class="line">        validators[spec.command](...args);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//!!!!执行命令</span></span><br><span class="line">      <span class="comment">//捕获返回值</span></span><br><span class="line">      <span class="keyword">if</span> (driver.executeCommand) &#123;</span><br><span class="line">        driverRes = <span class="keyword">await</span> driver.executeCommand(spec.command, ...args);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        driverRes = <span class="keyword">await</span> driver.execute(spec.command, ...args);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// unpack createSession response</span></span><br><span class="line">      <span class="keyword">if</span> (spec.command === <span class="string">'createSession'</span>) &#123;</span><br><span class="line">        newSessionId = driverRes[<span class="number">0</span>];</span><br><span class="line">        driverRes = driverRes[<span class="number">1</span>];</span><br><span class="line">      &#125;</span><br><span class="line">      ...</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      [httpStatus, httpResBody] = getResponseForJsonwpError(actualErr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (_.isString(httpResBody)) &#123;</span><br><span class="line">      res.status(httpStatus).send(httpResBody);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (newSessionId) &#123;</span><br><span class="line">        httpResBody.sessionId = newSessionId;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        httpResBody.sessionId = req.params.sessionId || <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      res.status(httpStatus).json(httpResBody);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// add the method to the app</span></span><br><span class="line">  app[method.toLowerCase()](path, (req, res) =&gt; &#123;</span><br><span class="line">    B.resolve(asyncHandler(req, res)).done();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/appium/appium/blob/master/lib/appium.js" target="_blank" rel="noopener">lib\appium.js</a></p>
<p>上面说了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appium server</span><br></pre></td></tr></table></figure>
<p>已经启动了，第一件事情，当然是创建<strong><em>session</em></strong>,然后把command交给这个session的不同driver去执行了。<br>appium先根据caps进行session创建（</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getDriverForCaps</span><br></pre></td></tr></table></figure>
<p>）,然后保存InnerDriver到当前session,以后每次执行命令(executeDCommand)会判断是否为appiumdriver的命令，不是则转给相应的driver去执行命令(android,ios等)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> createSession (caps, reqCaps) &#123;</span><br><span class="line">  caps = _.defaults(_.clone(caps), <span class="keyword">this</span>.args.defaultCapabilities);</span><br><span class="line">  <span class="keyword">let</span> InnerDriver = <span class="keyword">this</span>.getDriverForCaps(caps);</span><br><span class="line">  <span class="keyword">this</span>.printNewSessionAnnouncement(InnerDriver, caps);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.args.sessionOverride &amp;&amp; !!<span class="keyword">this</span>.sessions &amp;&amp; _.keys(<span class="keyword">this</span>.sessions).length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> id <span class="keyword">of</span> _.keys(<span class="keyword">this</span>.sessions)) &#123;</span><br><span class="line">      log.info(<span class="string">`    Deleting session '<span class="subst">$&#123;id&#125;</span>'`</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="keyword">this</span>.deleteSession(id);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (ign) &#123;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> curSessions;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    curSessions = <span class="keyword">this</span>.curSessionDataForDriver(InnerDriver);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> errors.SessionNotCreatedError(e.message);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> d = <span class="keyword">new</span> InnerDriver(<span class="keyword">this</span>.args);</span><br><span class="line">  <span class="keyword">let</span> [innerSessionId, dCaps] = <span class="keyword">await</span> d.createSession(caps, reqCaps, curSessions);</span><br><span class="line">  <span class="keyword">this</span>.sessions[innerSessionId] = d;</span><br><span class="line">  <span class="keyword">this</span>.attachUnexpectedShutdownHandler(d, innerSessionId);</span><br><span class="line">  d.startNewCommandTimeout();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [innerSessionId, dCaps];</span><br><span class="line">&#125;</span><br><span class="line">  <span class="keyword">async</span> executeCommand (cmd, ...args) &#123;</span><br><span class="line">  <span class="keyword">if</span> (isAppiumDriverCommand(cmd)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.executeCommand(cmd, ...args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> sessionId = args[args.length - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.sessions[sessionId].executeCommand(cmd, ...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在basedriver中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">executeDCommand</span><br></pre></td></tr></table></figure>
<p>其实是调用类的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd</span><br></pre></td></tr></table></figure>
<p>定义的方法。</p>
<p>我们以</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uiautomator2</span><br></pre></td></tr></table></figure>
<p>(\appium-uiautomator2-driver\build\lib)为例看一下它的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd</span><br></pre></td></tr></table></figure>
<p>执行情况。</p>
<p>以</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getAttribute</span><br></pre></td></tr></table></figure>
<p>(appium-uiautomator2-driver\lib\commands\element.js)为例说明：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">commands.getAttribute = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">attribute, elementId</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">this</span>.uiautomator2.jwproxy.command(<span class="string">`/element/<span class="subst">$&#123;elementId&#125;</span>/attribute/<span class="subst">$&#123;attribute&#125;</span>`</span>, <span class="string">'GET'</span>, &#123;&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong><em>appium 通过adb forward将主机的HTTP请求转发到设备中</em></strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> <span class="keyword">this</span>.adb.forwardPort(<span class="keyword">this</span>.opts.systemPort, DEVICE_PORT);</span><br><span class="line"><span class="comment">//主机端口号:8200,8299</span></span><br><span class="line"><span class="comment">//设备端口号：6790</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2018/07/21/spotbugs%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%9A%84bug%E6%8F%8F%E8%BF%B0%E6%A6%82%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/21/spotbugs%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%9A%84bug%E6%8F%8F%E8%BF%B0%E6%A6%82%E8%BF%B0/" class="post-title-link" itemprop="url">spotbugs官方文档的bug描述概述</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-21 11:53:11" itemprop="dateCreated datePublished" datetime="2018-07-21T11:53:11+08:00">2018-07-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">Java编程语言</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/07/21/spotbugs%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%9A%84bug%E6%8F%8F%E8%BF%B0%E6%A6%82%E8%BF%B0/" class="post-meta-item leancloud_visitors" data-flag-title="spotbugs官方文档的bug描述概述" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2018/07/21/spotbugs%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%9A%84bug%E6%8F%8F%E8%BF%B0%E6%A6%82%E8%BF%B0/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/07/21/spotbugs%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%9A%84bug%E6%8F%8F%E8%BF%B0%E6%A6%82%E8%BF%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>spotbugs已经取代和继承了曾今的findbugs，已经按个人理解对bug的类别进行排序，重要的在前，不重要的在后。bug描述里的废话被我删了。<br>文档参考：<a href="http://spotbugs.readthedocs.io/en/latest/bugDescriptions.html###" target="_blank" rel="noopener">http://spotbugs.readthedocs.io/en/latest/bugDescriptions.html/#/#/#</a><br><img src="/images/dn.net-20180205154612867-watermark-2-text-aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2luZGFuY2hhb3M=-font-5a6L5L2T-fontsize-400-fill-I0JBQkFCMA==-dissolve-70-gravity-SouthEast.png" alt="这里写图片描述"></p>
<p>code that is vulnerable to attacks from untrusted code<br>代码有漏洞，可能被攻击。<br>必须要重要。</p>
<p>code flaws having to do with threads, locks, and volatiles<br>可能导致线程、死锁及不稳定的<br>必须很重要。</p>
<p>code that is not necessarily incorrect but may be inefficient<br>可能代码正确但是性能会有问题的地方<br>必须很重要。</p>
<p>A use of untrusted input in a way that could create a remotely exploitable security vulnerability.<br>非安全输入，可导致远程利用的安全漏洞。<br>很重要</p>
<p>Violations of recommended and essential coding practice. Examples include hash code and equals problems, cloneable idiom, dropped exceptions, Serializable problems, and misuse of finalize.</p>
<p>不是特别重要。</p>
<p>Probable bug - an apparent coding mistake resulting in code that was probably not what the developer intended.<br>逻辑大概就是：这个地方的正确性值得商榷，你最好来确认下会不会潜在的出现不是你预期的行为。<br>不是特别重要。</p>
<p>Experimental and not fully vetted bug patterns<br>看官方文档里的子bug类别描述，大概意思是说老兄，这个地方本程序查不出来，要么是类太大了之类，bug匹配模式不太适用，你自己再确认下。<br>不太重要。</p>
<p>code that is confusing, anomalous, or written in a way that leads itself to errors. Examples include dead local stores, switch fall through, unconfirmed casts, and redundant null check of value known to be null. More false positives accepted.<br>不是很重要，看公司要求。</p>
<p>code flaws having to do with internationalization and locale<br>代码没有遵守必要的本地化和国际化<br>这个要看公司要求</p>
<p>Bogus random noise: intended to be useful as a control in data mining experiments, not in finding actual bugs in software<br>据描述的意思，意思就是兄弟，你不用管，这是spotbugs自己搞事。<br>完全不重要</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2018/07/21/%E5%BE%AE%E4%BF%A1%E9%89%B4%E6%9D%83%E7%8E%AF%E5%A2%83%E7%9A%84%E5%86%85%E7%BD%91%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/21/%E5%BE%AE%E4%BF%A1%E9%89%B4%E6%9D%83%E7%8E%AF%E5%A2%83%E7%9A%84%E5%86%85%E7%BD%91%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">微信鉴权环境的内网部署方案</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-21 11:52:54" itemprop="dateCreated datePublished" datetime="2018-07-21T11:52:54+08:00">2018-07-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index">
                    <span itemprop="name">Linux管理维护</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/07/21/%E5%BE%AE%E4%BF%A1%E9%89%B4%E6%9D%83%E7%8E%AF%E5%A2%83%E7%9A%84%E5%86%85%E7%BD%91%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88/" class="post-meta-item leancloud_visitors" data-flag-title="微信鉴权环境的内网部署方案" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2018/07/21/%E5%BE%AE%E4%BF%A1%E9%89%B4%E6%9D%83%E7%8E%AF%E5%A2%83%E7%9A%84%E5%86%85%E7%BD%91%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/07/21/%E5%BE%AE%E4%BF%A1%E9%89%B4%E6%9D%83%E7%8E%AF%E5%A2%83%E7%9A%84%E5%86%85%E7%BD%91%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文适用范围：<br>一、微信开发相关业务，涉及到微信第三方开发者鉴权、公众号鉴权业务；<br>二、没有固定IP的内网部署环境，尤其是测试环境。IP经常变动，导致鉴权失效。<br>三、本文写作时尚未解决主动定时拉取token的问题（跳板机的正向代理）</p>
<h1 id="开放平台主动推送ticket到内网的解决办法"><a href="#开放平台主动推送ticket到内网的解决办法" class="headerlink" title="开放平台主动推送ticket到内网的解决办法"></a>开放平台主动推送ticket到内网的解决办法</h1><p>解决方案核心思路：<br>使用带有固定IP的外网服务器，此处称：跳板服务器，作为内网服务器的端口转发服务器。和鉴权有关的域名解析到该服务器。<br>使用到的工具为nginx，具体的操作自己百度。<br>脚本实现：<br>1、内网一个服务器定时，30分钟获取一次外部IP地址，推送到跳板服务器的文本当中；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">#设置环境变量</span><br><span class="line">source /etc/profile</span><br><span class="line">curl http:\/\/www.baidu.com\/s?wd\=ip|grep <span class="string">"本机IP"</span>|awk -F <span class="string">"&lt;/span&gt;"</span> <span class="string">'&#123;print $1&#125;'</span>|awk -F <span class="string">";"</span> <span class="string">'&#123;print $2&#125;'</span> &gt; ip.txt</span><br><span class="line">ip_local=<span class="string">`cat ip.txt`</span></span><br><span class="line">sshpass -p $&#123;PASSWORD&#125; ssh -p $&#123;PORT&#125;-tt root@IP <span class="string">"echo $&#123;ip_local&#125; &gt; ip.txt"</span></span><br></pre></td></tr></table></figure>

<p>获取本地IP的方法不止一种，我提供的是最复杂的。<br>2、跳板服务器定时任务，30分钟获取一次文本中IP地址情况，同nginx中的配置进行比较，不相等则批量替换IP地址后reload配置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">#设置环境变量</span><br><span class="line">source /etc/profile</span><br><span class="line">newIP=<span class="string">`sed -n 1p /home/user/ip.txt`</span></span><br><span class="line">echo $&#123;newIP&#125;</span><br><span class="line">temp_old_IP=<span class="string">`grep proxy_pass /etc/nginx/conf.d/mk.conf |tail -n 1|awk -F ':' '&#123;print $2&#125;'`</span></span><br><span class="line">#echo $temp_old_IP</span><br><span class="line">old_IP=$&#123;temp_old_IP:2:$&#123;#temp_old_IP&#125;&#125;</span><br><span class="line">#echo $&#123;old_IP&#125;</span><br><span class="line"><span class="keyword">if</span> [[ $&#123;newIP&#125; != $&#123;old_IP&#125; ]] &amp;&amp; [[ -n $&#123;newIP&#125; ]]</span><br><span class="line">then</span><br><span class="line">        sed -i <span class="string">"s/$&#123;old_IP&#125;/$&#123;newIP&#125;/g"</span> /etc/nginx/conf.d/mk-internal-T*conf</span><br><span class="line">        cd /usr/sbin/</span><br><span class="line">        ./nginx -s reload</span><br><span class="line">        echo <span class="string">`date`</span> <span class="string">'New IP: '</span> $&#123;newIP&#125; &gt;&gt; <span class="regexp">/home/u</span>ser/ip_logs.log</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        echo <span class="string">`date`</span> <span class="string">'IP No Change: '</span> $&#123;old_IP&#125; &gt;&gt; <span class="regexp">/home/u</span>ser/ip_logs.log</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>需要注意的是：<br>1、内网路由器需支持虚拟服务器的配置，将路由器的外网端口映射给内网服务器。<br>2、使用nginx的跳板服务器，需要<strong>定时</strong>获取到公司外部的IP地址变化，如发生变化则reload nginx的服务。我写了一个shell脚本，在内部测试服务器上运行，30分钟侦测一次外网IP，并将IP输入到跳板服务器上。跳板服务器，也定时去取这个IP并和nginx内的IP对比，不等就替换reload。<br>3、内网服务器也可以部署nginx再转一次，做到内网一个端口多次使用，前提是跳板服务器过去的请求带上域名。<br>4、如果链接带https，这个方案也是可行的。这里有一个坑，一般tomcat部署https，会把tomcat服务器端口在配置中redirect给443端口。这时候，就需要把这个redirect从tomcat配置中移走，让firewall去转发，否则从跳板过来的请求，会陷入死循环的redirect。（跳版443端口接收到请求，redirect给内网的外网IP—-&gt;映射给内网的tomcat端口—-&gt;redirect给tomcat的端口，如果tomcat再redirect给443，则会回到链路请求的开始，直到达到请求的限制次数）。</p>
<h1 id="内网主动拉取token设置IP白名单的问题"><a href="#内网主动拉取token设置IP白名单的问题" class="headerlink" title="内网主动拉取token设置IP白名单的问题"></a>内网主动拉取token设置IP白名单的问题</h1><p>最合理的解决方案自然是最底层的，服务器请求<a href="https://open.weixin.qq.com/" target="_blank" rel="noopener">https://open.weixin.qq.com/</a>的数据包走代理服务器（拥有固定IP），但是这种办法只是理论上，我们技术团队目前并没有找到具体如何操作（限于透出产出比较低）。<br>我基于能力范围，找到IP变动导致的微信开放平台手动添加白名单的替代方法。<br>思路：webdriver驱动浏览器，自动录入ip白名单。<br>实现代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># chromedriver同级目录下</span><br><span class="line"><span class="keyword">from</span> splinter <span class="keyword">import</span> Browser</span><br><span class="line"><span class="keyword">import</span> datetime, time</span><br><span class="line"><span class="keyword">from</span> urllib2 <span class="keyword">import</span> urlopen</span><br><span class="line"><span class="keyword">import</span> schedule</span><br><span class="line"></span><br><span class="line">def changIP(ip):</span><br><span class="line">    browser = Browser(<span class="string">'chrome'</span>, )</span><br><span class="line">    browser.driver.set_window_size(<span class="number">1600</span>, <span class="number">1000</span>)</span><br><span class="line">    browser.visit(<span class="string">"https://open.weixin.qq.com/"</span>)</span><br><span class="line">    browser.find_by_id(<span class="string">"loginBarBt"</span>).click()</span><br><span class="line">    browser.find_by_name(<span class="string">"account"</span>).fill(u<span class="string">"$&#123;account&#125;"</span>)</span><br><span class="line">    browser.find_by_name(<span class="string">"passwd"</span>).fill(u<span class="string">"$&#123;password&#125;"</span>)</span><br><span class="line">    browser.find_by_text(<span class="string">"登录"</span>)[<span class="number">2</span>].click()</span><br><span class="line"></span><br><span class="line">    # MK内网T6</span><br><span class="line">    browser.find_by_xpath(<span class="string">"//*[@data-param='appid=wxfb1fb56deb2664a8']"</span>).click()</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    browser.windows.current = browser.windows[<span class="number">1</span>]</span><br><span class="line">    n = <span class="number">200</span></span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        browser.evaluate_script(<span class="string">'window.scrollTo(0,%d)'</span> % n)</span><br><span class="line">        <span class="keyword">if</span> browser.is_element_present_by_id(<span class="string">'js_fastmodify_ip'</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    browser.find_by_id(<span class="string">'js_fastmodify_ip'</span>).first.click()</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    browser.find_by_xpath(<span class="string">"/html/body/div[6]/div/div[2]/textarea"</span>).fill(u<span class="string">"%s"</span> % ip)</span><br><span class="line">    browser.find_by_text(<span class="string">'确定'</span>).click()</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    # 关闭当前标签页</span><br><span class="line">    browser.driver.close()</span><br><span class="line">    browser.windows.current = browser.windows[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    # 退出浏览器</span><br><span class="line">    browser.quit()</span><br><span class="line">#定时任务</span><br><span class="line">def job():</span><br><span class="line">    new_ip = urlopen(<span class="string">'http://ip.42.pl/raw'</span>).read()</span><br><span class="line">    f = open(<span class="string">'local_IP.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line">    old_ip_line = f.readlines()</span><br><span class="line">    f.close()</span><br><span class="line">    # 日志</span><br><span class="line">    log = open(<span class="string">'local_IP_log.txt'</span>, <span class="string">'a'</span>)</span><br><span class="line">    logtime = time.strftime(<span class="string">"%Y-%m-%d %H:%M:%S"</span>, time.localtime())</span><br><span class="line">    <span class="keyword">for</span> ip <span class="keyword">in</span> old_ip_line:</span><br><span class="line">        old_ip = ip</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> new_ip != old_ip:</span><br><span class="line">        logs=logtime+<span class="string">"=== IP change to "</span> + new_ip + <span class="string">'\n'</span></span><br><span class="line">        log.write(logs)</span><br><span class="line">        log.close()</span><br><span class="line">        f = open(<span class="string">'local_IP.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">        f.write(new_ip)</span><br><span class="line">        f.close()</span><br><span class="line">        changIP(new_ip)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        logs=logtime+<span class="string">"=== IP do not change "</span> + <span class="string">'\n'</span></span><br><span class="line">        log.write(logs)</span><br><span class="line">        log.close()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    schedule.every(<span class="number">15</span>).minutes.do(job)</span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">        schedule.run_pending()</span><br><span class="line">        time.sleep(<span class="number">300</span>)</span><br></pre></td></tr></table></figure>

<p>代码示意，实际上我们内网维护了大概有4个公共平台，改四次，还是蛮划算的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="windanchaos"
    src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">windanchaos</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">96</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/windanchaos" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;windanchaos" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/windanchaos" title="Gitee &amp;rarr; https:&#x2F;&#x2F;gitee.com&#x2F;windanchaos" rel="noopener" target="_blank"><i class="fa fa-fw fa-gitee"></i>Gitee</a>
      </span>
      <span class="links-of-author-item">
        <a href="/mailto:454722630@qq.com" title="E-Mail &amp;rarr; mailto:454722630@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/windanchaos" title="Weibo &amp;rarr; https:&#x2F;&#x2F;weibo.com&#x2F;windanchaos" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/windanchaos" title="CSDN &amp;rarr; https:&#x2F;&#x2F;blog.csdn.net&#x2F;windanchaos" rel="noopener" target="_blank"><i class="fa fa-fw fa-CSDN"></i>CSDN</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">备案/许可证编号 </a>
      <img src="http://www.beian.gov.cn/portal/download" style="display: inline-block;"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=19036728" rel="noopener" target="_blank">蜀ICP备19036728号 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">windanchaos</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.5.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>






  <script>
  function leancloudSelector(url) {
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = visitors.getAttribute('id').trim();
      var title = visitors.getAttribute('data-flag-title').trim();

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.log('Failed to save visitor count', error);
              })
          } else {
              Counter('post', '/classes/Counter', { title: title, url: url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.log('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return element.getAttribute('id').trim();
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            leancloudSelector(url).innerText = time;
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=0indNw0niJU8jN2a1E43bDW7-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': '0indNw0niJU8jN2a1E43bDW7-gzGzoHsz',
            'X-LC-Key': 'toErPcjDI3431WvXQVKoy0rC',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        const localhost = /http:\/\/(localhost|127.0.0.1|0.0.0.0)/;
        if (localhost.test(document.URL)) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>






        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  
















  

  


<script>
NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: '0indNw0niJU8jN2a1E43bDW7-gzGzoHsz',
    appKey: 'toErPcjDI3431WvXQVKoy0rC',
    placeholder: "Just go go",
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: 'zh-cn' || 'zh-cn',
    path: location.pathname,
    recordIP: false,
    serverURLs: ''
  });
}, window.Valine);
</script>

</body>
</html>
