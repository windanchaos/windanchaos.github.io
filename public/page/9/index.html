<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="宇弦">
<meta property="og:url" content="https:&#x2F;&#x2F;blog.windanchaos.tech&#x2F;page&#x2F;9&#x2F;index.html">
<meta property="og:site_name" content="宇弦">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://blog.windanchaos.tech/page/9/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>宇弦</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">宇弦</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-首页">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-分类">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-归档">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-关于">

    <a href="/about/me.html" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/windanchaos" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2017/01/11/GIT%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/11/GIT%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">GIT学习实践笔记</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-01-11 21:04:46" itemprop="dateCreated datePublished" datetime="2017-01-11T21:04:46+08:00">2017-01-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" itemprop="url" rel="index">
                    <span itemprop="name">持续集成</span>
                  </a>
                </span>
            </span>

          
            <span id="/2017/01/11/GIT%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5%E7%AC%94%E8%AE%B0/" class="post-meta-item leancloud_visitors" data-flag-title="GIT学习实践笔记" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2017/01/11/GIT%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5%E7%AC%94%E8%AE%B0/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/01/11/GIT%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>分支管理<br>git pull origin A:B<br>git branch –set-upstream-to=origin/develop develop<br>实践：<br>拉取远程代码到本地：<br>git pull origin release/Mandy_final:Mandy_final<br>要更新代码，使用：git pull origin Mandy_final<br>提示“fatal: Couldn’t find remote ref Mandy_final”<br>不知道原因，假设git pull 分支的时候，origin 之后的分知名不是本地的，而是远端的。<br>验证假设：<br>git branch –set-upstream-to=origin/release/Mandy_final Mandy_final<br>git pull命令直接到代码<br>git pull origin Mandy_final还是之前提示。<br>因此我自动发版脚本中的拉取代码的<strong>前提</strong>是要保证本地分支名必须和远端分支名保持一致：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin <span class="string">`git status |awk '&#123;print $4&#125;'|head -1`</span></span><br></pre></td></tr></table></figure>

<p><strong>git fetch：相当于是从远程获取最新版本到本地，不会自动merge</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Git fetch origin master</span><br><span class="line">git log -p master..origin/master</span><br><span class="line">git merge origin/master</span><br></pre></td></tr></table></figure>

<p><strong>git pull：相当于是从远程获取最新版本并merge到本地</strong><br>执行分支拉取最好使用git fetch ，否则在多个分支当中切换会导致不必要的merge错误。</p>
<p>git branch -r<br>git branch -a<br>git checkout -b mybranch origin/mybranch</p>
<p>git status</p>
<p>/#清理本地分支（远程仓库已经不存在的分支）<br>git remote prune origin</p>
<p>/#本地所有修改的。没有的提交的，都返回到原来的状态<br>git checkout .</p>
<p>/#把所有没有提交的修改暂存到stash里面。可用git stash pop恢复。<br>git stash</p>
<p>/#返回到某个节点，不保留修改。<br>git reset –hard HASH</p>
<p>/#返回到某个节点。保留修改<br>git reset –soft HASH</p>
<p>/#查看时间段的修改<br>git log –since=”2016-11-11” –before=”2017-01-06” filepath</p>
<p>/#查看最近修改.-p 选项展开显示每次提交的内容差异，用 -2 则仅显示最近的两次更新<br>git log –since=”2016-12-25” -p File |grep diff | awk ‘{print $4}’ |awk -F ‘b/’ ‘{print $2}’<br>以上命令，列出了时间之后，某文件夹下修改过的文件列表。在具体使用中，这个命令解决了静态资源部署的问题，消除了每次更新发版，不管静态文件是否修改过，都要全部上传到cdn的问题。</p>
<p>/#回退历史版本<br>git reset –hard 3628164（commit号）</p>
<p><strong>git add -A和 git add . git add -u在功能上看似很相近，但还是存在一点差别</strong><br>git add . ：他会监控工作区的状态树，使用它会把工作时的所有变化提交到暂存区，包括文件内容修改(modified)以及新文件(new)，但不包括被删除的文件。<br>git add -u ：他仅监控已经被add的文件（即tracked file），他会将被修改的文件提交到暂存区。add -u 不会提交新文件（untracked file）。（git add –update的缩写）<br>git add -A ：是上面两个功能的合集（git add –all的缩写）</p>
<p>Git diff 可以查看当前没有add 的内容修改（不在缓冲区的文件变化）</p>
<p>git diff –cached查看已经add但没有commit 的改动（在缓冲区的文件变化）</p>
<p>git diff HEAD 是上面两条命令的合并</p>
<p><strong>放弃本地修改</strong><br>git checkout . //放弃本地修改，没有提交的可以回到未修改前版本<br>git clean是从工作目录中移除没有track的文件.<br>通常的参数是git clean -df:<br>-d表示同时移除目录,-f表示force,因为在git的配置文件中, clean.requireForce=true,如果不加-f,clean将会拒绝执行.</p>
<p><strong>不同分支的同一个文件覆盖</strong></p>
<p>如何从其他分支merge指定文件到当前分支，git checkout 是个合适的工具。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout source_branch &lt;path&gt;...</span><br></pre></td></tr></table></figure>

<p>example:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git branch</span><br><span class="line">  * A  </span><br><span class="line">    B</span><br><span class="line"></span><br><span class="line">git checkout B message.html message.css message.js other.js</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2017/01/11/ubuntu%20%E5%AE%89%E8%A3%85pygit2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/11/ubuntu%20%E5%AE%89%E8%A3%85pygit2/" class="post-title-link" itemprop="url">ubuntu 安装pygit2</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-01-11 16:42:44" itemprop="dateCreated datePublished" datetime="2017-01-11T16:42:44+08:00">2017-01-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B5%8B%E8%AF%95%E7%9A%84%E6%A1%86%E6%9E%B6%E5%92%8C%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">测试的框架和技术</span>
                  </a>
                </span>
            </span>

          
            <span id="/2017/01/11/ubuntu%20%E5%AE%89%E8%A3%85pygit2/" class="post-meta-item leancloud_visitors" data-flag-title="ubuntu 安装pygit2" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2017/01/11/ubuntu%20%E5%AE%89%E8%A3%85pygit2/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/01/11/ubuntu%20%E5%AE%89%E8%A3%85pygit2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考：<a href="http://www.pygit2.org/install.html" target="_blank" rel="noopener">http://www.pygit2.org/install.html</a></p>
<p>依赖包：<br>Python 2.7, 3.2+ or PyPy 2.6+ (including the development headers)<br>Libgit2 v0.25.x<br>cffi 1.0+<br>six<br>tox (optional)</p>
<p>安装依赖包：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install libssh2-1-dev</span><br><span class="line">sudo apt-<span class="keyword">get</span> install libgit2-dev</span><br><span class="line">sudo apt-<span class="keyword">get</span> install python-tox python-cffi python-six</span><br></pre></td></tr></table></figure>

<p>安装：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="comment">//github.com/libgit2/libgit2/archive/v0.25.0.tar.gz</span></span><br><span class="line">tar xzf v0<span class="number">.25</span><span class="number">.0</span>.tar.gz</span><br><span class="line">cd libgit2<span class="number">-0.25</span><span class="number">.0</span>/</span><br><span class="line">cmake .</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>

<p>cmake .的时候会告诉你缺啥啥，缺啥装啥。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2016/12/15/Python%20Django%E5%AD%A6%E4%B9%A0%E5%92%8C%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/15/Python%20Django%E5%AD%A6%E4%B9%A0%E5%92%8C%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">Python Django学习和实践</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-15 22:44:23" itemprop="dateCreated datePublished" datetime="2016-12-15T22:44:23+08:00">2016-12-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">Java编程语言</span>
                  </a>
                </span>
            </span>

          
            <span id="/2016/12/15/Python%20Django%E5%AD%A6%E4%B9%A0%E5%92%8C%E5%AE%9E%E8%B7%B5/" class="post-meta-item leancloud_visitors" data-flag-title="Python Django学习和实践" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2016/12/15/Python%20Django%E5%AD%A6%E4%B9%A0%E5%92%8C%E5%AE%9E%E8%B7%B5/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016/12/15/Python%20Django%E5%AD%A6%E4%B9%A0%E5%92%8C%E5%AE%9E%E8%B7%B5/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>教程来源于：<a href="http://python.usyiyi.cn/" target="_blank" rel="noopener">python官方文档中文站</a><br>Django的mvc中的Model</p>
<p>python manage.py migrate<br>初始化mode.py中定义的app数据库</p>
<p>python manage.py makemigrations appname<br>修订数据库模型</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2016/12/06/%E6%B5%8F%E8%A7%88%E5%99%A8%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E7%BD%91%E9%A1%B5%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/06/%E6%B5%8F%E8%A7%88%E5%99%A8%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E7%BD%91%E9%A1%B5%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">浏览器调试工具网页性能分析中的使用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-06 22:54:09" itemprop="dateCreated datePublished" datetime="2016-12-06T22:54:09+08:00">2016-12-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B5%8B%E8%AF%95%E7%9A%84%E6%A1%86%E6%9E%B6%E5%92%8C%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">测试的框架和技术</span>
                  </a>
                </span>
            </span>

          
            <span id="/2016/12/06/%E6%B5%8F%E8%A7%88%E5%99%A8%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E7%BD%91%E9%A1%B5%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/" class="post-meta-item leancloud_visitors" data-flag-title="浏览器调试工具网页性能分析中的使用" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2016/12/06/%E6%B5%8F%E8%A7%88%E5%99%A8%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E7%BD%91%E9%A1%B5%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016/12/06/%E6%B5%8F%E8%A7%88%E5%99%A8%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7%E7%BD%91%E9%A1%B5%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>IE、chrome、firefox等按F12可以掉出它们自带的页面调试工具，作为测试当然不能非常精通在页面上修改样式，调试页面jsp，js，但是却可以很轻松的使用它来分析网页的性能优化项。</p>
<h1 id="基础篇"><a href="#基础篇" class="headerlink" title="基础篇"></a>基础篇</h1><p>现在的网络模式粗糙的理解，就是BS结构（客户/服务端），一个负责请求展现，一个负责响应提供内容。这个过程包括底层网络的三次握手，TCP/IP的通信巴拉巴拉的一些列低级的我们不需要了解过细的活动（大牛除外），这些活动浏览器会有记录。</p>
<p>客户端/服务器传输过程很多内容，可以阅读<a href="http://blog.csdn.net/lmh12506/article/details/7794512" target="_blank" rel="noopener">深入理解HTTP协议、HTTP协议原理分析</a> ，</p>
<p>网络通信的链接四个基一步骤：<br>1、浏览器与服务器建立连接；这个建立链接，简单说通信双方需要相互确认对方的存在以及合法身份，所以会有<a href="http://blog.csdn.net/whuslei/article/details/6667471/" target="_blank" rel="noopener">TCP的3次握手</a> ，<br>2、浏览器向服务器请求文档；简单理解就是url（统一资源定位符的英文缩写），资源定位符自然请求过去就是在请求文档咯，泪崩吧。<br>3 、服务器响应浏览器请求；把资源吐出来给浏览器，浏览器接收并显示。<br>4、 断开连接。</p>
<p>在客户端和服务端通信的过程中，还需要了解：<br>1、客户端请求方法，最常用的： GET，POST。get简单说，直接拿资源，服务器拿现货提供；post简单说，附带上请求信息去告诉服务器自己要拿的东西，服务器现炒现卖。<br>2、动态资源和静态资源：简单的说动态资源就是服务器上非现成的资源，如某商品的列表订单信息（有人买卖自然的变化的，需要实时去查）；静态资源就是现成的，如各种css\html\js\jsp文件。<br>3、缓存。静态资源可以缓存来加快网络二次请求的响应速度。缓存也是可以在服务器上（至少apache可以）控制过期。<br>4、XHR（XMLHtmlRequest），一种结构化的对象，用于在后台与服务器交换数据。可理解为服务吐出来的动态资源的一种形式。</p>
<h1 id="实践篇"><a href="#实践篇" class="headerlink" title="实践篇"></a>实践篇</h1><p>以下，记录一次使用浏览器调试工具分析我们商城后台各类资源加载性能，发现问题，促成问题改善和优化。</p>
<h2 id="发现问题"><a href="#发现问题" class="headerlink" title="发现问题"></a>发现问题</h2><p>虽然是主打移动微信电商，但是商户的管理端使用的还是PC电脑，浏览器，每天测试商户后台，我有个习惯，就是使用chrome的第三方插件清理缓存（当然是关闭浏览器自动的清），一次发版前，产品+前端+后端一起把登陆主页给优化了，简单的说界面比上一个版本更好看，内容也更丰富。当然这个是优化项，没有提交给测试这边验证。但是……我发现这页面加载很久，开始因为是网络和测试服务器性能不行也没深究，但是多几次我就觉得不太对劲，F12打开一看，加载10s+了，这性能自然是不行的。然后反馈研发，推动修改。</p>
<h2 id="分析问题"><a href="#分析问题" class="headerlink" title="分析问题"></a>分析问题</h2><p>下面以另一个商品管理页面作为实例（写文章的时候还没修改），手动清空浏览器缓存，打开F12，刷新并访问首页。<br>非常明晰的时间加载曲线展现，如下图（仅示意）：<br><img src="/images/dn.net-20161206231134554-watermark-2-text-aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2luZGFuY2hhb3M=-font-5a6L5L2T-fontsize-400-fill-I0JBQkFCMA==-dissolve-70-gravity-SouthEast.png" alt="这里写图片描述"><br>图中显示了2个时间消耗大户都在800ms以上。<br>点击开文件的响应内容包含了若干object，都是按商品的productID分类的，这个数据是从后台数据库查询得到的动态数据（xhr），点开一个object的内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"pId"</span>:<span class="number">5989</span>,<span class="string">"name"</span>:<span class="string">"聚实惠测试商品01"</span>,<span class="string">"status"</span>:<span class="string">"shelve_on"</span>,<span class="string">"imgUrl"</span>:<span class="string">"http://×××××××××××.aliyuncs.com/sgc/200015/image/145c1974fdaa4a9f81d20614a4af1327.jpg"</span>,<span class="string">"shopId"</span>:<span class="literal">null</span>,<span class="string">"inventory"</span>:<span class="number">1464</span>,<span class="string">"maxPrice"</span>:<span class="number">1.11</span>,<span class="string">"minPrice"</span>:<span class="number">1.11</span>,<span class="string">"createdWhen"</span>:<span class="string">"2016-12-01 11:10:55"</span>,<span class="string">"modifyWhen"</span>:<span class="literal">null</span>,<span class="string">"salesNum"</span>:<span class="number">0</span>,<span class="string">"pv"</span>:<span class="number">2</span>,<span class="string">"uv"</span>:<span class="number">2</span>,<span class="string">"itemCatId"</span>:<span class="literal">null</span>,<span class="string">"shortDesc"</span>:<span class="string">"聚实惠测试商品01"</span>,<span class="string">"salesLimited"</span>:<span class="literal">null</span>,<span class="string">"saleStartTime"</span>:<span class="literal">null</span>,<span class="string">"saleStartSeconds"</span>:<span class="literal">null</span>,<span class="string">"stockReduceType"</span>:<span class="literal">null</span>,<span class="string">"freightType"</span>:<span class="literal">null</span>,<span class="string">"shippingFee"</span>:<span class="literal">null</span>,<span class="string">"shippingTemplateId"</span>:<span class="literal">null</span>,<span class="string">"displayInventory"</span>:<span class="literal">false</span>,<span class="string">"displaySoldQty"</span>:<span class="literal">false</span>,<span class="string">"shareImg"</span>:<span class="literal">null</span>,<span class="string">"shareTitle"</span>:<span class="literal">null</span>,<span class="string">"shareContent"</span>:<span class="literal">null</span>,<span class="string">"imgs"</span>:<span class="literal">null</span>,<span class="string">"delSkuIds"</span>:<span class="literal">null</span>,<span class="string">"productCode"</span>:<span class="literal">null</span>,<span class="string">"modifyWhenDate"</span>:<span class="literal">null</span>,<span class="string">"productSizeTemplateId"</span>:<span class="literal">null</span>,<span class="string">"taxRate"</span>:<span class="literal">null</span>,<span class="string">"toInactive"</span>:<span class="literal">false</span>,<span class="string">"spec"</span>:<span class="literal">null</span>,<span class="string">"maxquto"</span>:<span class="number">121.00</span>,<span class="string">"minquto"</span>:<span class="number">121.00</span>,<span class="string">"onStatus"</span>:<span class="literal">null</span>,<span class="string">"offStatus"</span>:<span class="literal">null</span>,<span class="string">"selectedIds"</span>:<span class="literal">null</span>,<span class="string">"defaultImg"</span>:<span class="literal">null</span>,<span class="string">"indexCode"</span>:<span class="literal">null</span>,<span class="string">"selIds"</span>:<span class="literal">null</span>,<span class="string">"groupId"</span>:<span class="literal">null</span>,<span class="string">"sortNo"</span>:<span class="literal">null</span>,<span class="string">"skus"</span>:<span class="literal">null</span>,<span class="string">"querySelInType"</span>:<span class="literal">null</span>,<span class="string">"commissionRate"</span>:<span class="number">0.2000</span>,<span class="string">"commissionTemplateId"</span>:<span class="literal">null</span>,<span class="string">"notQueryPids"</span>:<span class="literal">null</span>,<span class="string">"imgShape"</span>:<span class="literal">null</span>,<span class="string">"orderStatus"</span>:<span class="literal">null</span>,<span class="string">"oldStockType"</span>:<span class="literal">null</span>,<span class="string">"shelveOnWhen"</span>:<span class="literal">null</span>,<span class="string">"shelveOffWhen"</span>:<span class="literal">null</span>,<span class="string">"minFrontPrice"</span>:<span class="literal">null</span>,<span class="string">"minBackPrice"</span>:<span class="literal">null</span>,<span class="string">"maxFrontPrice"</span>:<span class="literal">null</span>,<span class="string">"maxBackPrice"</span>:<span class="literal">null</span>,<span class="string">"qrCodeUrl"</span>:<span class="string">"http://XXXXXXXX200015/product/productDetailPage?pId="</span>,<span class="string">"groupIds"</span>:<span class="literal">null</span>,<span class="string">"statusComments"</span>:<span class="string">"上架"</span>,<span class="string">"rectImgUrl"</span>:<span class="string">"1abc808b34884fcbb78b187e533bfaa1.jpg"</span>,<span class="string">"activityId"</span>:<span class="literal">null</span>,<span class="string">"activityUniqueId"</span>:<span class="literal">null</span>,<span class="string">"activityName"</span>:<span class="literal">null</span>,<span class="string">"fansQuantity"</span>:<span class="literal">null</span>,<span class="string">"fansCount"</span>:<span class="literal">null</span>,<span class="string">"activityStartTime"</span>:<span class="literal">null</span>,<span class="string">"activityEndSeconds"</span>:<span class="literal">null</span>,<span class="string">"activityLabel"</span>:<span class="literal">null</span>,<span class="string">"activityLabelStyle"</span>:<span class="literal">null</span>,<span class="string">"activityMinPrice"</span>:<span class="literal">null</span>,<span class="string">"activitySalesLimited"</span>:<span class="number">0</span>,<span class="string">"activityRemark"</span>:<span class="literal">null</span>,<span class="string">"noticeActivityId"</span>:<span class="literal">null</span>,<span class="string">"noticeActivityUniqueId"</span>:<span class="literal">null</span>,<span class="string">"noticeActivityName"</span>:<span class="literal">null</span>,<span class="string">"noticeActivityStartTime"</span>:<span class="literal">null</span>,<span class="string">"noticeActivityEndSeconds"</span>:<span class="literal">null</span>,<span class="string">"noticeActivityLabel"</span>:<span class="literal">null</span>,<span class="string">"noticeActivityMinPrice"</span>:<span class="literal">null</span>,<span class="string">"noticeActivitySalesLimited"</span>:<span class="number">0</span>,<span class="string">"groupActivityId"</span>:<span class="literal">null</span>,<span class="string">"groupActivityUniqueId"</span>:<span class="literal">null</span>,<span class="string">"groupActivityName"</span>:<span class="literal">null</span>,<span class="string">"groupActivityStartTime"</span>:<span class="literal">null</span>,<span class="string">"groupActivityEndSeconds"</span>:<span class="literal">null</span>,<span class="string">"groupActivityLabel"</span>:<span class="literal">null</span>,<span class="string">"groupActivityLabelStyle"</span>:<span class="literal">null</span>,<span class="string">"groupActivitySalesLimited"</span>:<span class="literal">null</span>,<span class="string">"groupActivityRemark"</span>:<span class="literal">null</span>,<span class="string">"fulfilActivityLadders"</span>:<span class="literal">null</span>,<span class="string">"fulfilActivityDiscountList"</span>:<span class="literal">null</span>,<span class="string">"fulfilActivityPointsList"</span>:<span class="literal">null</span>,<span class="string">"fulfilActivityCouponList"</span>:<span class="literal">null</span>,<span class="string">"crowdActivityLadders"</span>:<span class="literal">null</span>,<span class="string">"quantityLimited"</span>:<span class="number">0</span>,<span class="string">"productGivePoints"</span>:<span class="literal">null</span>,<span class="string">"productSizeRowString"</span>:<span class="literal">null</span>,<span class="string">"productSizeRowData"</span>:[],<span class="string">"pids"</span>:<span class="literal">null</span>,<span class="string">"packageDiscountAmout"</span>:<span class="literal">null</span>,<span class="string">"imprestPrice"</span>:<span class="literal">null</span>,<span class="string">"imprestFrontPrice"</span>:<span class="literal">null</span>,<span class="string">"imprestBackPrice"</span>:<span class="literal">null</span>,<span class="string">"currentPrice"</span>:<span class="literal">null</span>,<span class="string">"crowdCurrentPersons"</span>:<span class="literal">null</span>,<span class="string">"crowdMaxPersons"</span>:<span class="literal">null</span>,<span class="string">"returnImprest"</span>:<span class="literal">null</span>,<span class="string">"payLimitHours"</span>:<span class="literal">null</span>,<span class="string">"showCartFlag"</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>

<p>商品列表中展现的内容最多不会超过20个属性（商品名称及ID 价格 访问量 总库存 总销量 创建时间），反回来的object里面怎么会有那么多内容呢？然后大概一看，查了一大堆null的空数据出来。说明在执行查询操作的时候多查了不需要的内容。然后，作为一个测试，这个模块是谁开发的，找到他询问，得知他原来的方法已经被很多人修改过……于是不禁想到，研发都很懒，有现成的他是不会自己去搞的，复用人家的方法（一个方法只做一件事的原则被彻底放弃或者遗忘），改改……经过多轮功能和版本的迭代，一个曾经单纯的干净十足的方法，变成了一个拖泥带水的方法……</p>
<h2 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h2><p>首页加载慢的问题是如何被解决的？<br>1、我发现问题，向对应研发提出性能慢的问题；研发表示没有办法，是某某地方查询数据库慢导致的，现在有点忙。我告诉他我的想法，作为首页，性能不能太低，否则会被用户觉得产品low。他同意但是事情太多，没有说要马上解决。基于发现的这个性能问题，我把后台快速的清理一遍，看是否还有类似的情况，清理完毕，问题提交到了bug管理系统，作为一个重要但不紧急的事项。<br>2、在我反馈后大概2小时，产品经理发觉有点慢，过来找我问情况，我告诉他原因，和我对这个问题的处理方式，又说了我的想法。产品经理应该是认同的，迅速口头把问题反馈给老大，咨询意见（这就是优秀的产品经理和蹩脚测试的区别——发版也不是理由），老大的想法和我一样。然后我继续准备发版的各项工作，研发-老大碰了一会得到解决方案。发版完成后，这个问题的修复作为hotfix被发到生产环境。性能提升到加载5s+。</p>
<p>商品查询sql性能问题应该如何被解决？<br>1、首先是代码编写原则问题，说白了是研发管理问题。没有普及科学规范的编码规范。所以这个问题要在源头上解决的话需要上升到管理层，督促开发遵守基本的代码编码规范。——开会，宣贯，清查，批评，通报批评，惩罚。。。<br>2、修复该问题。<br>3、类似遗留的代码需要清理。有一定工作量，需要和开发任务平衡。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2016/12/06/%E5%85%AC%E5%8F%B8%E5%8F%91%E7%89%88shell%E8%84%9A%E6%9C%AC%E9%87%8D%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/06/%E5%85%AC%E5%8F%B8%E5%8F%91%E7%89%88shell%E8%84%9A%E6%9C%AC%E9%87%8D%E6%9E%84/" class="post-title-link" itemprop="url">公司发版shell脚本重构</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-06 18:12:14" itemprop="dateCreated datePublished" datetime="2016-12-06T18:12:14+08:00">2016-12-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index">
                    <span itemprop="name">Linux管理维护</span>
                  </a>
                </span>
            </span>

          
            <span id="/2016/12/06/%E5%85%AC%E5%8F%B8%E5%8F%91%E7%89%88shell%E8%84%9A%E6%9C%AC%E9%87%8D%E6%9E%84/" class="post-meta-item leancloud_visitors" data-flag-title="公司发版shell脚本重构" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2016/12/06/%E5%85%AC%E5%8F%B8%E5%8F%91%E7%89%88shell%E8%84%9A%E6%9C%AC%E9%87%8D%E6%9E%84/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016/12/06/%E5%85%AC%E5%8F%B8%E5%8F%91%E7%89%88shell%E8%84%9A%E6%9C%AC%E9%87%8D%E6%9E%84/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="重构前代码"><a href="#重构前代码" class="headerlink" title="重构前代码"></a>重构前代码</h1><p>代码关键字被批量替换。仅供参考。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">sitesPath=<span class="string">"/ggcall/sites/"</span></span><br><span class="line">DATE=$(date +%Y%m%d%H%M)</span><br><span class="line">softfile=<span class="string">"/home/ggstar/Arhasgg/"</span></span><br><span class="line">sitesbackup=<span class="string">"/home/ggstar/sitesbackup/"</span></span><br><span class="line">githome=<span class="string">"/home/ggstar/Arhasgg/"</span></span><br><span class="line">#设置环境变量</span><br><span class="line">source /etc/profile</span><br><span class="line">echo <span class="string">"请确认使用该命令，已经从git库拉取了最新的代码，使用了正确的分支"</span></span><br><span class="line">cd $githome</span><br><span class="line">echo <span class="string">"git分支名称："</span>+<span class="string">`git branch |awk '&#123;print $4&#125;'|head -3`</span></span><br><span class="line">echo <span class="string">"编译工程，静默方式，过程如果报错会提示，提示需检查错误后重新编译！"</span></span><br><span class="line">echo <span class="string">"默认gg-sdk-wx未编译，如更新需本地上传/home/ggstar/.m2/repository/com/gg/sdk/gg-sdk-wx/0.0.1/gg-sdk-wx-0.0.1.jar"</span></span><br><span class="line">echo <span class="string">"依赖包编译"</span></span><br><span class="line">cd $githome<span class="string">"gg-aggregator"</span></span><br><span class="line">mvn -q -ff clean install</span><br><span class="line"></span><br><span class="line">echo <span class="string">"编译gg-passport"</span></span><br><span class="line">cd $githome<span class="string">"gg-passport"</span></span><br><span class="line">mvn -q -ff clean install -P st</span><br><span class="line">cd $githome<span class="string">"gg-openApi"</span></span><br><span class="line">echo <span class="string">"编译gg-opanApi"</span></span><br><span class="line">mvn -q -ff clean install -P st</span><br><span class="line">echo <span class="string">"编译gg-imgr-webbent"</span></span><br><span class="line">cd $githome<span class="string">"gg-imgr-webent"</span></span><br><span class="line">mvn -q -ff clean install -P st</span><br><span class="line">echo <span class="string">"编译gg-wm-webent"</span></span><br><span class="line">cd $githome<span class="string">"gg-wm-webent"</span></span><br><span class="line">mvn -q -ff clean install -P st</span><br><span class="line">echo <span class="string">"编译gg-img-webent"</span></span><br><span class="line">cd $githome<span class="string">"gg-img-webent"</span></span><br><span class="line">mvn -q -ff clean install -P st</span><br><span class="line">echo <span class="string">"编译gg-job-webent"</span></span><br><span class="line">cd $githome<span class="string">"gg-job-webent"</span></span><br><span class="line">mvn -q -ff clean install -P st</span><br><span class="line">echo <span class="string">"编译gg-sn-webent"</span></span><br><span class="line">cd $githome<span class="string">"gg-sn-webent"</span></span><br><span class="line">mvn -q -ff clean install -P st</span><br><span class="line">echo <span class="string">"编译gg-app-webent"</span></span><br><span class="line">cd $githome<span class="string">"gg-app-webent"</span></span><br><span class="line">mvn -q -ff clean install -P st</span><br><span class="line">echo <span class="string">"编译gg-yum-webent"</span></span><br><span class="line">cd $githome<span class="string">"gg-yum-webent"</span></span><br><span class="line">mvn -q -ff clean install -P st</span><br><span class="line">echo <span class="string">"编译发布完成"</span></span><br><span class="line"></span><br><span class="line">#删除需要更新的原文件</span><br><span class="line"><span class="keyword">if</span> [ -f $softfile<span class="string">"gg-imgr-webent/target/gg-imgr-webent.war"</span> ]; then</span><br><span class="line">#echo "back-un--to--"$sitesbackup</span><br><span class="line">#tar -zcf $sitesbackup"imgr"/$DATE.tar.gz -P $sitesPath"imgr/ROOT"</span><br><span class="line">#echo "备份完成!"</span><br><span class="line">echo <span class="string">"imgr update---------------------"</span></span><br><span class="line">cd $sitesPath<span class="string">"imgr/ROOT"</span></span><br><span class="line">rm -fr <span class="string">`ls $sitesPath"imgr/ROOT" -I shopInfo`</span></span><br><span class="line">echo <span class="string">"删除完成！"</span></span><br><span class="line">unzip -q $softfile<span class="string">"gg-imgr-webent/target/gg-imgr-webent.war"</span> -d $sitesPath<span class="string">"imgr/ROOT"</span></span><br><span class="line">echo <span class="string">"imgr解压完成！"</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f $softfile<span class="string">"gg-passport/target/gg-passport.war"</span> ]; then</span><br><span class="line"></span><br><span class="line">#echo "back-un-------------"</span><br><span class="line">#tar -zcf $sitesbackup"passport"/$DATE.tar.gz -P $sitesPath"passport/ROOT"</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo <span class="string">"passport update---------------------"</span></span><br><span class="line">cd $sitesPath<span class="string">"passport/ROOT"</span></span><br><span class="line"></span><br><span class="line">rm -fr <span class="string">`ls $sitesPath"passport/ROOT" -I shopInfo`</span></span><br><span class="line">echo <span class="string">"删除完成！"</span></span><br><span class="line">unzip -q $softfile<span class="string">"gg-passport/target/gg-passport.war"</span> -d $sitesPath<span class="string">"passport/ROOT"</span></span><br><span class="line">echo <span class="string">"passport解压完成！"</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f $softfile<span class="string">"gg-job-webent/target/gg-job-webent.war"</span> ]; then</span><br><span class="line">#echo "back-un-------------"</span><br><span class="line">#tar -zcf $sitesbackup"job"/$DATE.tar.gz -P $sitesPath"job/ROOT"</span><br><span class="line"></span><br><span class="line">echo <span class="string">"job update------------"</span></span><br><span class="line">cd $sitesPath<span class="string">"job/ROOT"</span></span><br><span class="line">rm -fr <span class="string">`ls $sitesPath"job/ROOT" -I shopInfo`</span></span><br><span class="line">echo <span class="string">"删除完成！"</span></span><br><span class="line">unzip -q $softfile<span class="string">"gg-job-webent/target/gg-job-webent.war"</span> -d $sitesPath<span class="string">"job/ROOT"</span></span><br><span class="line">echo <span class="string">"job解压完成！"</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f $softfile<span class="string">"gg-wm-webent/target/gg-wm-webent.war"</span> ]; then</span><br><span class="line"></span><br><span class="line">#echo "back-un-------------"</span><br><span class="line">#tar -zcf $sitesbackup"wm"/$DATE.tar.gz -P $sitesPath"wm/ROOT"</span><br><span class="line"></span><br><span class="line">echo <span class="string">"wm update-----------------"</span></span><br><span class="line">cd $sitesPath<span class="string">"wm/ROOT"</span></span><br><span class="line">rm -fr <span class="string">`ls $sitesPath"wm/ROOT" -I shopInfo`</span></span><br><span class="line">echo <span class="string">"删除完成！"</span></span><br><span class="line">unzip -q $softfile<span class="string">"gg-wm-webent/target/gg-wm-webent.war"</span> -d $sitesPath<span class="string">"wm/ROOT"</span></span><br><span class="line">echo <span class="string">"wm解压完成！"</span></span><br><span class="line">fi</span><br><span class="line">#司南</span><br><span class="line"><span class="keyword">if</span> [ -f $softfile<span class="string">"gg-sn-webent/target/gg-sn-webent.war"</span> ]; then</span><br><span class="line"></span><br><span class="line">#echo "back-un-------------"</span><br><span class="line">#tar -zcf $sitesbackup"sn"/$DATE.tar.gz -P $sitesPath"sn/ROOT"</span><br><span class="line"></span><br><span class="line">echo <span class="string">"sn update-----------------"</span></span><br><span class="line">cd $sitesPath<span class="string">"sn/ROOT"</span></span><br><span class="line">rm -fr <span class="string">`ls $sitesPath"sn/ROOT" -I shopInfo`</span></span><br><span class="line">echo <span class="string">"删除完成！"</span></span><br><span class="line">unzip -q $softfile<span class="string">"gg-sn-webent/target/gg-sn-webent.war"</span> -d $sitesPath<span class="string">"sn/ROOT"</span></span><br><span class="line">echo <span class="string">"sn解压完成！"</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">#img</span><br><span class="line"><span class="keyword">if</span> [ -f $softfile<span class="string">"gg-img-webent/target/gg-img-webent.war"</span> ]; then</span><br><span class="line"></span><br><span class="line">#echo "back-un-------------"</span><br><span class="line">#tar -zcf $sitesbackup"img"/$DATE.tar.gz -P $sitesPath"img/ROOT"</span><br><span class="line"></span><br><span class="line">echo <span class="string">"img update-----------------"</span></span><br><span class="line">cd $sitesPath<span class="string">"img/ROOT"</span></span><br><span class="line">rm -fr <span class="string">`ls $sitesPath"img/ROOT" -I shopInfo`</span></span><br><span class="line">echo <span class="string">"删除完成！"</span></span><br><span class="line">unzip -q $softfile<span class="string">"gg-img-webent/target/gg-img-webent.war"</span> -d $sitesPath<span class="string">"img/ROOT"</span></span><br><span class="line">echo <span class="string">"img解压完成！"</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">#yum</span><br><span class="line"><span class="keyword">if</span> [ -f $softfile<span class="string">"gg-yum-webent/target/gg-yum-webent.war"</span> ]; then</span><br><span class="line">echo <span class="string">"yum update-----------------"</span></span><br><span class="line">cd $sitesPath<span class="string">"yum/ROOT"</span></span><br><span class="line">rm -fr <span class="string">`ls $sitesPath"yum/ROOT" -I shopInfo`</span></span><br><span class="line">echo <span class="string">"删除完成！"</span></span><br><span class="line">unzip -q $softfile<span class="string">"gg-yum-webent/target/gg-yum-webent.war"</span> -d $sitesPath<span class="string">"yum/ROOT"</span></span><br><span class="line">echo <span class="string">"yum解压完成！"</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#webapp</span><br><span class="line"><span class="keyword">if</span> [ -f $softfile<span class="string">"gg-app-webent/target/gg-app-webent.war"</span> ]; then</span><br><span class="line">echo <span class="string">"app update-----------------"</span></span><br><span class="line">cd $sitesPath<span class="string">"app/ROOT"</span></span><br><span class="line">rm -fr <span class="string">`ls $sitesPath"app/ROOT" -I shopInfo`</span></span><br><span class="line">echo <span class="string">"删除完成！"</span></span><br><span class="line">unzip -q $softfile<span class="string">"gg-app-webent/target/gg-app-webent.war"</span> -d $sitesPath<span class="string">"app/ROOT"</span></span><br><span class="line">echo <span class="string">"app解压完成！"</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">#openApiAPI</span><br><span class="line"><span class="keyword">if</span> [ -f $softfile<span class="string">"gg-openApiApi/target/gg-openApi.war"</span> ]; then</span><br><span class="line">echo <span class="string">"openApi update-----------------"</span></span><br><span class="line">cd $sitesPath<span class="string">"openApi/ROOT"</span></span><br><span class="line">rm -fr <span class="string">`ls $sitesPath"openApi/ROOT" -I shopInfo`</span></span><br><span class="line">echo <span class="string">"删除完成！"</span></span><br><span class="line">unzip -q $softfile<span class="string">"gg-openApiApi/target/gg-openApi.war"</span> -d $sitesPath<span class="string">"openApi/ROOT"</span></span><br><span class="line">echo <span class="string">"openApiAPI解压完成！"</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">#mock</span><br><span class="line">#if [ -f $softfile"gg-mock-webent/target/gg-mock-webent.war" ]; then</span><br><span class="line">#echo "mock update-----------------"</span><br><span class="line">#cd $sitesPath"mock/ROOT"</span><br><span class="line">#rm -fr `ls $sitesPath"mock/ROOT" -I shopInfo`</span><br><span class="line">#echo "删除完成！"</span><br><span class="line">#unzip -q $softfile"gg-mock-webent/target/gg-mock-webent.war" -d $sitesPath"mock/ROOT"</span><br><span class="line">#echo "mock解压完成！"</span><br><span class="line">#fi</span><br><span class="line"></span><br><span class="line">#结束tomcat进程</span><br><span class="line">kill <span class="number">-9</span> $&#123;k&#125;<span class="string">`ps -fe |grep tomcat |awk '&#123;print $2&#125;'|head -3`</span></span><br><span class="line">#开启tomcat</span><br><span class="line">cd /ggcall/servers/apache-tomcat<span class="number">-8.5</span><span class="number">.4</span><span class="number">-80</span>/bin</span><br><span class="line">./startup.sh</span><br><span class="line">#log</span><br><span class="line">#echo "Logs if ERROR show~~"</span><br><span class="line">#tail -f /ggcall/servers/apache-tomcat-8.5.4-80/logs/catalina.out</span><br></pre></td></tr></table></figure>

<h1 id="重构后代码"><a href="#重构后代码" class="headerlink" title="重构后代码"></a>重构后代码</h1><p>代码当中还增加了rpc的编译和发布内容。脚本代码数明显降低。使用了若干新学技能。<br>包括shell的（流程控制while、if、awk命令、&amp;&amp;命令状态、let和expr语句执行代数运算、数组、定向&gt;、nohub + &amp;）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">githome=<span class="string">"/home/ggstar/Arhasgg/"</span></span><br><span class="line">sitesPath=<span class="string">"/ggcall/sites/"</span></span><br><span class="line">DATE=$(date +%Y%m%d%H%M)</span><br><span class="line">softfile=<span class="string">"/home/ggstar/Arhasgg/"</span></span><br><span class="line">sitesbackup=<span class="string">"/home/ggstar/sitesbackup/"</span></span><br><span class="line"></span><br><span class="line">#设置环境变量</span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line">webents=(gg-aggregator gg-img-webent gg-wm-msger gg-app-webent gg-job-webent gg-openApi gg-wm-webent gg-yum-webent gg-imgr-webent gg-passport gg-sn-webent gg-imgr-rpc gg-yum-rpc)</span><br><span class="line">longth=$&#123;#webents&#125;</span><br><span class="line">RPM=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">#git拉取代码</span><br><span class="line">echo <span class="string">"请确认使用该命令，已经从git库拉取了最新的代码，使用了正确的分支"</span></span><br><span class="line">cd $&#123;githome&#125;</span><br><span class="line">#echo "git分支名称："+`git branch |awk '&#123;print $4&#125;'|head -3`</span><br><span class="line">echo <span class="string">"git分支名称："</span>+<span class="string">`git status |awk '&#123;print $4&#125;' |head -1`</span></span><br><span class="line">echo <span class="string">"拉取当前分支代码"</span></span><br><span class="line">git pull origin <span class="string">`git status |awk '&#123;print $4&#125;'|head -1|awk -F 'in/' '&#123;print $2&#125;'`</span></span><br><span class="line">echo <span class="string">"编译工程，静默方式，过程如果报错会提示，提示需检查错误后重新编译！"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> [ $RPM -lt $longth ]  &amp;&amp; [ $? -eq <span class="number">0</span>  ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    cd $&#123;githome&#125;$&#123;webents[$RPM]&#125; &amp;&amp; echo <span class="string">"编译$&#123;webents[$RPM]&#125;"</span></span><br><span class="line">    mvn -q -ff clean install -P st &amp;&amp; echo <span class="string">"$&#123;webents[$RPM]&#125;编译完成！"</span></span><br><span class="line">    <span class="keyword">let</span> RPM++</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">#更新rpc</span><br><span class="line">longthpub=<span class="string">`expr $longth - 3`</span></span><br><span class="line">RPM=$longthpub</span><br><span class="line"><span class="keyword">while</span> [ $RPM -lt $longth ]  &amp;&amp; [ $? -eq <span class="number">0</span>  ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ -f $softfile<span class="string">"$&#123;webents[$RPM]&#125;/target/$&#123;webents[$RPM]&#125;.jar"</span> ]; then</span><br><span class="line">                webentname=<span class="string">`echo <span class="subst">$&#123;webents[$RPM]&#125;</span>`</span></span><br><span class="line">                siteName=<span class="string">`echo <span class="subst">$&#123;webentname#*-&#125;</span>`</span></span><br><span class="line">        #判断是否存在webent，不存在则新建</span><br><span class="line">                <span class="keyword">if</span> [ ! -d  $sitesPath$&#123;siteName&#125;  ]; then</span><br><span class="line">                        mkdir -p $sitesPath$&#123;siteName&#125;</span><br><span class="line">                        #echo $&#123;webents[$RPM]&#125;|awk -F '-' '&#123;print $2&#125;'</span><br><span class="line">                fi</span><br><span class="line">                #执行代码更新操作</span><br><span class="line">                echo <span class="string">"$siteName更新---------------------"</span></span><br><span class="line">                kill <span class="number">-9</span> $&#123;k&#125;<span class="string">`ps -fe |grep $siteName |awk '&#123;print $2&#125;'|head -2`</span></span><br><span class="line">                cd $sitesPath$&#123;siteName&#125; &amp;&amp; rm -fr <span class="string">`ls $sitesPath<span class="subst">$&#123;siteName&#125;</span>`</span> &amp;&amp; echo <span class="string">"删除完成！"</span></span><br><span class="line">                cp -r $softfile<span class="string">"$&#123;webents[$RPM]&#125;/target/lib"</span> $softfile<span class="string">"$&#123;webents[$RPM]&#125;/target/$&#123;webents[$RPM]&#125;.jar"</span>  $sitesPath$&#123;siteName&#125; &amp;&amp; echo <span class="string">"$siteName解压完成！"</span></span><br><span class="line">                sleep <span class="number">10</span></span><br><span class="line">                nohup  java -Xms512m -Xmx1024m -jar $&#123;webents[$RPM]&#125;.jar &gt; $&#123;webents[$RPM]&#125;<span class="string">".log"</span> &amp;</span><br><span class="line">        fi</span><br><span class="line">        <span class="keyword">let</span> RPM++</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">#更新webent</span><br><span class="line">RPM=<span class="number">1</span></span><br><span class="line">longthpub=<span class="string">`expr $longth - 2`</span></span><br><span class="line"><span class="keyword">while</span> [ $RPM -lt $longthpub ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ -f $softfile<span class="string">"$&#123;webents[$RPM]&#125;/target/$&#123;webents[$RPM]&#125;.war"</span> ]; then</span><br><span class="line">                siteName=<span class="string">`echo <span class="subst">$&#123;webents[$RPM]&#125;</span>|awk -F '-' '&#123;print $2&#125;'`</span></span><br><span class="line">        #判断是否存在webent，不存在则新建</span><br><span class="line">                <span class="keyword">if</span> [ ! -d  $sitesPath$&#123;siteName&#125;<span class="string">"/ROOT"</span>  ]; then</span><br><span class="line">                        mkdir -p $sitesPath$&#123;siteName&#125;<span class="string">"/ROOT"</span></span><br><span class="line">            #echo $&#123;webents[$RPM]&#125;|awk -F '-' '&#123;print $2&#125;'</span><br><span class="line">                fi</span><br><span class="line">        #执行代码更新操作</span><br><span class="line">        echo <span class="string">"$siteName 更新---------------------"</span></span><br><span class="line">        cd $sitesPath$&#123;siteName&#125;<span class="string">"/ROOT"</span> &amp;&amp; rm -fr <span class="string">`ls $sitesPath<span class="subst">$&#123;siteName&#125;</span>"/ROOT" -I shopInfo`</span> &amp;&amp; echo <span class="string">"删除完成！"</span></span><br><span class="line">        unzip -q $softfile<span class="string">"$&#123;webents[$RPM]&#125;/target/$&#123;webents[$RPM]&#125;.war"</span> -d $sitesPath$&#123;siteName&#125;<span class="string">"/ROOT"</span> &amp;&amp; echo <span class="string">"$siteName解压完成！"</span></span><br><span class="line"></span><br><span class="line">        fi</span><br><span class="line">        <span class="keyword">let</span> RPM++</span><br><span class="line">done</span><br><span class="line">#结束tomcat进程</span><br><span class="line">kill <span class="number">-9</span> $&#123;k&#125;<span class="string">`ps -fe |grep tomcat |awk '&#123;print $2&#125;'|head -3`</span></span><br><span class="line">#开启tomcat</span><br><span class="line">cd /ggcall/servers/apache-tomcat<span class="number">-8.5</span><span class="number">.4</span><span class="number">-80</span>/bin</span><br><span class="line">./startup.sh</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2016/12/06/git%E5%9C%A8%E8%B7%9F%E8%B8%AAbug%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/06/git%E5%9C%A8%E8%B7%9F%E8%B8%AAbug%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">git在跟踪bug中的使用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-06 18:06:48" itemprop="dateCreated datePublished" datetime="2016-12-06T18:06:48+08:00">2016-12-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B5%8B%E8%AF%95%E7%9A%84%E6%A1%86%E6%9E%B6%E5%92%8C%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">测试的框架和技术</span>
                  </a>
                </span>
            </span>

          
            <span id="/2016/12/06/git%E5%9C%A8%E8%B7%9F%E8%B8%AAbug%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/" class="post-meta-item leancloud_visitors" data-flag-title="git在跟踪bug中的使用" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2016/12/06/git%E5%9C%A8%E8%B7%9F%E8%B8%AAbug%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016/12/06/git%E5%9C%A8%E8%B7%9F%E8%B8%AAbug%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>系统趋于稳定，修改的bug通过git来管理，通过git的提交日志及提交文件变更识别潜在的风险。<br>工具SourceTree，当然eclipse也可以胜任（体验差一点）<br><img src="/images/dn.net-20161206182515499-watermark-2-text-aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2luZGFuY2hhb3M=-font-5a6L5L2T-fontsize-400-fill-I0JBQkFCMA==-dissolve-70-gravity-SouthEast.png" alt="这里写图片描述"><br>要达到识别代码变更需具备基本的代码阅读能力，包括：java、js、jsp、html、css<br>未完待续</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2016/11/24/%E5%9F%BA%E4%BA%8Egit%20maven%E7%9A%84%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F%E7%B3%BB%E5%88%97%E4%BA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/11/24/%E5%9F%BA%E4%BA%8Egit%20maven%E7%9A%84%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F%E7%B3%BB%E5%88%97%E4%BA%8C/" class="post-title-link" itemprop="url">基于git maven的自动构建系统系列二</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-11-24 23:44:36" itemprop="dateCreated datePublished" datetime="2016-11-24T23:44:36+08:00">2016-11-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">python编程语言</span>
                  </a>
                </span>
            </span>

          
            <span id="/2016/11/24/%E5%9F%BA%E4%BA%8Egit%20maven%E7%9A%84%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F%E7%B3%BB%E5%88%97%E4%BA%8C/" class="post-meta-item leancloud_visitors" data-flag-title="基于git maven的自动构建系统系列二" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2016/11/24/%E5%9F%BA%E4%BA%8Egit%20maven%E7%9A%84%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F%E7%B3%BB%E5%88%97%E4%BA%8C/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016/11/24/%E5%9F%BA%E4%BA%8Egit%20maven%E7%9A%84%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F%E7%B3%BB%E5%88%97%E4%BA%8C/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这篇文章的主要目的是记录使用python来编写公司发版系统的想法、过程。</p>
<h1 id="一、构思"><a href="#一、构思" class="headerlink" title="一、构思"></a>一、构思</h1><h2 id="主要特征"><a href="#主要特征" class="headerlink" title="主要特征"></a>主要特征</h2><p>该系统拥有web界面<br>代码发布功能：可以在web中实现各个webent单独发布、整体发布<br>git历史查看功能：查看git提交历史、查看每次提交修改文件。所以需要定时自动更新日志。<br>两次发布版本差异对比功能</p>
<h2 id="实践能力"><a href="#实践能力" class="headerlink" title="实践能力"></a>实践能力</h2><p>一个python的web框架<br>python调度操作git、maven、执行脚本<br>python写入和读取数据库<br>python/git版本对比</p>
<h1 id="二、计划"><a href="#二、计划" class="headerlink" title="二、计划"></a>二、计划</h1><p>1、寻找一款python的web框架。定为django。<br>2、学习并实践该框架<br>3、设计系统的MVC<br>4、各个功能编码实现和测试</p>
<h1 id="三、执行"><a href="#三、执行" class="headerlink" title="三、执行"></a>三、执行</h1><h2 id="django的安装"><a href="#django的安装" class="headerlink" title="django的安装"></a>django的安装</h2><p>安装的方法丰富多彩，很简单。参考github上<a href="https://github.com/django/django" target="_blank" rel="noopener">django/django</a><br>或者参考官方网站的安装办法。</p>
<h2 id="django的学习"><a href="#django的学习" class="headerlink" title="django的学习"></a>django的学习</h2><p>主要参考官网的翻译资料：<a href="http://python.usyiyi.cn/translate/django_182/index.html" target="_blank" rel="noopener">http://python.usyiyi.cn/translate/django_182/index.html</a><br>这里从文章发出到现在（2017/1/8），持续有40多天，期间断断续续的看，断断续续的边学边练习里面的例子。插播了很多其他事情，尤其是一些无聊的手机游戏，双休要跟老婆见面，时间蛮少了，坚持下来确实有点苦难，还好基础看完了。继续加油！下面硬着头皮继续下一个阶段的学习实践。</p>
<h2 id="发版系统的原型"><a href="#发版系统的原型" class="headerlink" title="发版系统的原型"></a>发版系统的原型</h2><ol>
<li>编译完成后，shell代码要将编译结果发布到tomcat容器中，容器路径在server.xml中配置了。其实这个地方理论上来将是没有必要的，个人认为，编译阶段就可以定义好编译的路径。研究下maven，把现在的shell流程简化。参考：<a href="http://blog.csdn.net/rj042/article/details/6834557" target="_blank" rel="noopener">http://blog.csdn.net/rj042/article/details/6834557</a>。后发现pom.xml修改会影响研发的windows下编译发布路径，维持现状。</li>
</ol>
<h2 id="编码阶段"><a href="#编码阶段" class="headerlink" title="编码阶段"></a>编码阶段</h2><p>在我的django工程目录下新建自己的网站：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#新建项目</span><br><span class="line">django-admin startproject mydemo</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#新建网站</span><br><span class="line">cd mydemo</span><br><span class="line">python3<span class="number">.5</span> manage.py startapp gitlog</span><br></pre></td></tr></table></figure>

<p>执行完<br>chaosbom@chaosbomPC:~/PycharmProjects/mydemo$ tree<br>.<br>├── gitlog<br>│ ├── admin.py<br>│ ├── apps.py<br>│ ├── <strong>init</strong>.py<br>│ ├── migrations<br>│ │ └── <strong>init</strong>.py<br>│ ├── models.py<br>│ ├── tests.py<br>│ └── views.py<br>├── manage.py<br>└── mydemo<br>├── <strong>init</strong>.py<br>├── <strong>pycache</strong><br>│ ├── <strong>init</strong>.cpython-35.pyc<br>│ └── settings.cpython-35.pyc<br>├── settings.py<br>├── urls.py<br>└── wsgi.py</p>
<p>编辑gitlog/model.py</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"># Create your models here.</span><br><span class="line"></span><br><span class="line">#maven编译使用的配置表</span><br><span class="line">class Profiles(models.Model):</span><br><span class="line">    P= models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    add_date = models.DateTimeField(<span class="string">'date published'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#管理webents的表，记录webent上次发版的时间以及上次发版使用的配置</span><br><span class="line">class Webents(models.Model):</span><br><span class="line">    name= models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line">    lastPubStatus=models.ForeignKey(Profiles,<span class="keyword">default</span>=<span class="number">1</span>)</span><br><span class="line">    lastPubDate=models.DateTimeField(<span class="string">'date published'</span>)</span><br><span class="line">    add_date = models.DateTimeField(<span class="string">'date published'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#author提交人，message提交备注，commitsFile修改文件，git提交的nvalue唯一号</span><br><span class="line">class Commits(models.Model):</span><br><span class="line">    author= models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    message = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    commitsFile = models.CharField(max_length=<span class="number">2000</span>)</span><br><span class="line">    nvalue=models.CharField(max_length=<span class="number">2000</span>)</span><br><span class="line">    commit_date = models.DateTimeField()</span><br></pre></td></tr></table></figure>

<p>编辑mydemo/settings.py：该Django 项目的设置/配置。至于它如何运作的，此处略。仅修改以下对应内容。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'gitlog'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    # 'default': &#123;</span><br><span class="line">    #     'ENGINE': 'django.db.backends.sqlite3',</span><br><span class="line">    #     'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),</span><br><span class="line">    # &#125;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'你的mysql数据库名称'</span>,</span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,</span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'你的密码'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="string">'PORT'</span>: <span class="string">'3306'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着让模型自动在数据库中生成表:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3<span class="number">.5</span> manage.py check</span><br><span class="line">python3<span class="number">.5</span> manage.py makemigrations gitlog</span><br><span class="line">python3<span class="number">.5</span> manage.py migrate</span><br></pre></td></tr></table></figure>

<p>登陆数据库查看，已经能够看到模型对应的数据库。</p>
<p>初始化数据库：<br>使用python的脚本来更新。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date, datetime, timedelta</span><br><span class="line"><span class="keyword">import</span> mysql.connector</span><br><span class="line"></span><br><span class="line">cnx = mysql.connector.connect(user=<span class="string">'root'</span>,password=<span class="string">'yb198697'</span>, database=<span class="string">'gitlog'</span>)</span><br><span class="line">cursor = cnx.cursor()</span><br><span class="line"></span><br><span class="line">tomorrow = datetime.now().date() + timedelta(days=<span class="number">1</span>)</span><br><span class="line">today=datetime.now().date()+ timedelta(days=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">profiles=[<span class="string">'product'</span>,<span class="string">'st'</span> ,<span class="string">'stKa'</span> ,<span class="string">'st-https'</span> ,<span class="string">'nowx'</span>]</span><br><span class="line">add_profile=(<span class="string">"INSERT INTO gitlog_profiles "</span></span><br><span class="line">               <span class="string">"(P, add_date) "</span></span><br><span class="line">               <span class="string">"VALUES (%s, %s)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> profile <span class="keyword">in</span> profiles:</span><br><span class="line">    data_profiles=(profile, today)</span><br><span class="line">    cursor.execute(add_profile,data_profiles)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">webents=[<span class="string">'mk-aggregator'</span> ,<span class="string">'mk-img-webent'</span> ,<span class="string">'mk-wm-msger'</span> ,<span class="string">'mk-app-webent'</span> ,<span class="string">'mk-job-webent'</span> ,<span class="string">'mk-openApi'</span> ,<span class="string">'mk-wm-webent'</span> ,</span><br><span class="line">         <span class="string">'mk-yum-webent'</span> ,<span class="string">'mk-imgr-webent'</span> ,<span class="string">'mk-passport'</span> ,<span class="string">'mk-sn-webent'</span> ,<span class="string">'mk-intf-webent'</span> ,<span class="string">'mk-imgr-rpc'</span> ,<span class="string">'mk-yum-rpc'</span> ,</span><br><span class="line">         <span class="string">'mk-mdata-rpc'</span>]</span><br><span class="line">add_webent=(<span class="string">"INSERT INTO gitlog_webents "</span></span><br><span class="line">               <span class="string">"(name, lastPubStatus_id,lastPubDate,add_date) "</span></span><br><span class="line">               <span class="string">"VALUES (%s, %s, %s, %s)"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> webent <span class="keyword">in</span> webents:</span><br><span class="line">    data_webents=(webent,<span class="number">37</span>, tomorrow,tomorrow)</span><br><span class="line">    cursor.execute(add_webent,data_webents)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Make sure data is committed to the database</span><br><span class="line">cnx.commit()</span><br><span class="line"></span><br><span class="line">cursor.close()</span><br><span class="line">cnx.close()</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2016/11/23/%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%EF%BC%9A%E5%85%AC%E5%8F%B8%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83%E4%BD%93%E7%B3%BB%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/11/23/%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%EF%BC%9A%E5%85%AC%E5%8F%B8%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83%E4%BD%93%E7%B3%BB%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">写在前面：公司代码发布体系总结</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-11-23 22:25:08" itemprop="dateCreated datePublished" datetime="2016-11-23T22:25:08+08:00">2016-11-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index">
                    <span itemprop="name">Linux管理维护</span>
                  </a>
                </span>
            </span>

          
            <span id="/2016/11/23/%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%EF%BC%9A%E5%85%AC%E5%8F%B8%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83%E4%BD%93%E7%B3%BB%E6%80%BB%E7%BB%93/" class="post-meta-item leancloud_visitors" data-flag-title="写在前面：公司代码发布体系总结" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2016/11/23/%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%EF%BC%9A%E5%85%AC%E5%8F%B8%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83%E4%BD%93%E7%B3%BB%E6%80%BB%E7%BB%93/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016/11/23/%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%EF%BC%9A%E5%85%AC%E5%8F%B8%E4%BB%A3%E7%A0%81%E5%8F%91%E5%B8%83%E4%BD%93%E7%B3%BB%E6%80%BB%E7%BB%93/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本人是测试人员，包括我在内，团队中有2名测试，整个研发不含测试大概10名（后台前端）。除了负责测试工作，还兼任负责发布公司测试环境及生产环境的代码。</p>
<h2 id="代码环境及架构"><a href="#代码环境及架构" class="headerlink" title="代码环境及架构"></a>代码环境及架构</h2><p>公司所属行业为微信电商，使用java流行的MVC框架（这个我还不是很懂，不知道用了Spring哪些东西），这个了解过，只是并不深入，可以参考我的另一篇入门摘抄的<a href="http://blog.csdn.net/windanchaos/article/details/51742146" target="_blank" rel="noopener">java web基础</a>。言归正传：<br>后台编程语言：java、UI框架kendo ui<br>web容器：tomcat<br>微信端：js、html、vue、css、jsp等<br>代码管理：git<br>构建工具：maven<br>部署操作系统：CentOS7<br>数据库：MySQL<br>其他数据库或工具：Redis、Memche、RPC、activemq、阿里云sso<br>桌面开发工具：eclipse</p>
<h2 id="代码发布的主要流程"><a href="#代码发布的主要流程" class="headerlink" title="代码发布的主要流程"></a>代码发布的主要流程</h2><p>Created with Raphaël 2.1.0           研发编码/修改      发版到测试环境      测试确认       发版到生产环境        yes      no</p>
<p>流程中两次发版目前都是执行我手动写的脚本。</p>
<p>Created with Raphaël 2.1.0      发版需求      git pull代码      maven编译构建      发布代码到tomcat      重启tomcat      开始测试</p>
<p>当然git由于有分支管理，发布的代码需要根据实际情况进行切换。这里git的分支管理就不再赘述。</p>
<p>由于手工发版实属重复劳动，后来约定定时测试环境每日定时发版2次，一次是中午12点10分，一次是晚上7点30.使用Linux的<a href="http://www.jb51.net/LINUXjishu/40015.html" target="_blank" rel="noopener">crontab</a>。解放后的双手就是生产力。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">crontab -e #编辑任务，进入文本编辑窗口，输入以下内容。两个脚本分别是拉取代/构建maven项目和发版代码用</span><br><span class="line"><span class="number">10</span> <span class="number">12</span> * * <span class="number">1</span><span class="number">-5</span> bash ~<span class="regexp">/mvn.sh &amp;&amp; bash ~/u</span>pdateSites.sh</span><br><span class="line"><span class="number">30</span> <span class="number">19</span> * * <span class="number">1</span><span class="number">-5</span> bash ~<span class="regexp">/mvn.sh &amp;&amp; bash ~/u</span>pdateSites.sh</span><br></pre></td></tr></table></figure>

<p>PS:此处有坑一个，mvn.sh和updateSites.sh中存在git和mvn这两个非系统自带命令，使用crontab定时运行会缺乏环境变量，导致不能执行。解决办法：在脚本中添加：source /etc/profile。</p>
<p>生产环境的代码严格执行测试环境的代码为基准，所以发布的代码直接从tomcat的webent下面打包，唯一的不同是执行打包的时候会讲配置文件替换为生产。配置文件在代码库中做了统一的管理。<br>Created with Raphaël 2.1.0      发起发版任务      配置文件check      配置文件替换      代码打包      sftp方式拉取代码包      备份源代码发布代码包      发布代码包      上线回归测试</p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>这简单。<br>sudo apt-get install git</p>
<p>网上教程多，此处略。</p>
<p>这个也简单，取apache官网下载，按照通常的maven安装教程安装部署即可。<br>难的地方：maven在执行构建过程中可能遇到pom.xml的配置不正确，导致编译不通过。笔者在初次接触maven的时候并不清楚我们自己的代码具体结构是怎么样的，后来熟悉后知道，maven构建主要有两部分：基础通用的被其他webent依赖调用的先编译，webent单独编译。这里省略若干艰辛的探索过程。。。<br>PS:小技巧，maven的repository可以把本地windows的repository上传到～/.m2目录下，省的再编译下载（我们的有1G大）</p>
<p>sftp是Secure File Transfer Protocol的缩写，安全文件传送协议。可以为传输文件提供一种安全的加密方法。sftp 与 ftp 有着几乎一样的语法和功能。SFTP 为 SSH的一部份，是一种传输档案至 Blogger 伺服器的安全方式。</p>
<p>简单说：客户机生成秘钥2个，一个是私钥，一个是公钥。公钥用于分发需要登录的服务器，公钥（对称公钥）方法解决了每次都输入密码的问题：使用客户端生成密钥钥对，将公钥添加到服务器的信任公钥表中，即完成了服务器对客户端信任的添加，再次使用SCP或者SFTP则不需要密码。。具体操作参考<a href="http://jingyan.baidu.com/article/e5c39bf56245ae39d7603331.html%E2%80%8B" target="_blank" rel="noopener">百度经验</a>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2016/11/07/Ubuntu%E5%AF%86%E7%A0%81%E6%AD%A3%E7%A1%AE%EF%BC%8C%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8E%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/11/07/Ubuntu%E5%AF%86%E7%A0%81%E6%AD%A3%E7%A1%AE%EF%BC%8C%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8E%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2/" class="post-title-link" itemprop="url">Ubuntu密码正确，一直处于登录界面</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-11-07 21:04:37" itemprop="dateCreated datePublished" datetime="2016-11-07T21:04:37+08:00">2016-11-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index">
                    <span itemprop="name">Linux管理维护</span>
                  </a>
                </span>
            </span>

          
            <span id="/2016/11/07/Ubuntu%E5%AF%86%E7%A0%81%E6%AD%A3%E7%A1%AE%EF%BC%8C%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8E%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2/" class="post-meta-item leancloud_visitors" data-flag-title="Ubuntu密码正确，一直处于登录界面" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2016/11/07/Ubuntu%E5%AF%86%E7%A0%81%E6%AD%A3%E7%A1%AE%EF%BC%8C%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8E%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016/11/07/Ubuntu%E5%AF%86%E7%A0%81%E6%AD%A3%E7%A1%AE%EF%BC%8C%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8E%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>if you had used “apt-get update”….<br>the new update contains some bugs for nvidia drivers….<br>To slove:<br>1.get the nvidia software</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -l |grep nvidia</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rc  nvidia<span class="number">-304</span>                               <span class="number">304.132</span><span class="number">-0</span>ubuntu0<span class="number">.16</span><span class="number">.04</span><span class="number">.2</span>                      amd64        NVIDIA legacy binary driver - version <span class="number">304.132</span></span><br><span class="line">rc  nvidia-opencl-icd<span class="number">-304</span>                      <span class="number">304.132</span><span class="number">-0</span>ubuntu0<span class="number">.16</span><span class="number">.04</span><span class="number">.2</span>                      amd64        NVIDIA OpenCL ICD</span><br><span class="line">rc  nvidia-settings                            <span class="number">361.42</span><span class="number">-0</span>ubuntu1                               amd64        Tool <span class="keyword">for</span> configuring the NVIDIA graphics driver</span><br></pre></td></tr></table></figure>

<p>2.remove nvidia all</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> remove nvidia-opencl-icd-304 nvidia-304 nvidia-settings</span><br></pre></td></tr></table></figure>

<p>3.restart your computer</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init <span class="number">6</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.windanchaos.tech/2016/11/03/%E5%9F%BA%E4%BA%8Egit%20maven%E7%9A%84%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F%E7%B3%BB%E5%88%97%E4%B8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="windanchaos">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宇弦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2016/11/03/%E5%9F%BA%E4%BA%8Egit%20maven%E7%9A%84%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F%E7%B3%BB%E5%88%97%E4%B8%80/" class="post-title-link" itemprop="url">基于git maven的自动构建系统系列一</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-11-03 22:02:41" itemprop="dateCreated datePublished" datetime="2016-11-03T22:02:41+08:00">2016-11-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-23 23:11:57" itemprop="dateModified" datetime="2019-11-23T23:11:57+08:00">2019-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E7%AE%A1%E7%90%86%E7%BB%B4%E6%8A%A4/" itemprop="url" rel="index">
                    <span itemprop="name">Linux管理维护</span>
                  </a>
                </span>
            </span>

          
            <span id="/2016/11/03/%E5%9F%BA%E4%BA%8Egit%20maven%E7%9A%84%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F%E7%B3%BB%E5%88%97%E4%B8%80/" class="post-meta-item leancloud_visitors" data-flag-title="基于git maven的自动构建系统系列一" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2016/11/03/%E5%9F%BA%E4%BA%8Egit%20maven%E7%9A%84%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F%E7%B3%BB%E5%88%97%E4%B8%80/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016/11/03/%E5%9F%BA%E4%BA%8Egit%20maven%E7%9A%84%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F%E7%B3%BB%E5%88%97%E4%B8%80/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>受《<a href="http://wenku.baidu.com/link?url=yfoL8R4aoZb5b56nqYOjW7sEvYxExTaLyRovWFcD3slJoym1P7qKpdcuzelEU52J4jpp_eGWa5rtMGwJhkkrQ5YA8ilmM16GoTBP8F-48NC" target="_blank" rel="noopener">分布式自动化版本发布系统</a>》启发，决定对我们公司现有的shell脚本发版进行升级。业余时间研究，主要达到以下目的：</p>
<p>前二个做完，可以了解python的一些基本语法数据类型，把更新记录写入到数据库便于日常查看。<br>第三个，续用当前测试环境发布代码的shell脚本。</p>
<h1 id="python3-5-and-mysql5-7"><a href="#python3-5-and-mysql5-7" class="headerlink" title="python3.5 and mysql5.7"></a>python3.5 and mysql5.7</h1><h2 id="mysql5-7-install"><a href="#mysql5-7-install" class="headerlink" title="mysql5.7 install"></a>mysql5.7 install</h2><p>参考：<a href="http://dev.mysql.com/downloads/repo/apt/" target="_blank" rel="noopener">官网安装方法</a>。<br>首先：下载<a href="http://dev.mysql.com/get/mysql-apt-config_0.8.0-1_all.deb" target="_blank" rel="noopener">MySQL APT Repository</a>。参考<a href="http://dev.mysql.com/doc/mysql-apt-repo-quick-guide/en/" target="_blank" rel="noopener">链接</a>的方法，设置MySQL APT Repository。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i mysql-apt-config_0<span class="number">.8</span><span class="number">.0</span><span class="number">-1</span>_all.deb</span><br><span class="line">sudo apt-<span class="keyword">get</span> update</span><br><span class="line">sudo apt-<span class="keyword">get</span> install mysql-server</span><br></pre></td></tr></table></figure>

<p><em>第一个命令需要选择自己将要安装的mysql版本。</em><br>启动mysql<br>安装mysql workbench。</p>
<h2 id="Connector-Python-install"><a href="#Connector-Python-install" class="headerlink" title="Connector/Python install"></a>Connector/Python install</h2><p>参考：<a href="https://dev.mysql.com/doc/connector-python/en/connector-python-installation.html" target="_blank" rel="noopener">官方网站</a></p>
<h2 id="基本的python数据库操作"><a href="#基本的python数据库操作" class="headerlink" title="基本的python数据库操作"></a>基本的python数据库操作</h2><p>以下操作完成了对git log记录数据库。不足之处在于，没有找到pygit2的方法去追加git 日志，先跳过去了。<br>大部分代码参考：<a href="http://www.pygit2.org/objects.html" target="_blank" rel="noopener">pygit2官网document</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time,datetime</span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">as</span> config</span><br><span class="line"><span class="keyword">from</span> pygit2 <span class="keyword">import</span> Repository</span><br><span class="line"><span class="keyword">from</span> pygit2 <span class="keyword">import</span> GIT_SORT_NONE,GIT_SORT_TOPOLOGICAL, GIT_SORT_REVERSE,GIT_SORT_TIME</span><br><span class="line"><span class="keyword">import</span> mysql.connector</span><br><span class="line"></span><br><span class="line">cnx = mysql.connector.connect(**config)</span><br><span class="line">#存储日志的列表[[logA],[logB]...[logN]]</span><br><span class="line">argslog=[]</span><br><span class="line">cursor = cnx.cursor()</span><br><span class="line">repo = Repository(<span class="string">'homeOfyourGit/.git'</span>)</span><br><span class="line"><span class="keyword">for</span> commit <span class="keyword">in</span> repo.walk(repo.head.target,GIT_SORT_TOPOLOGICAL | GIT_SORT_REVERSE):</span><br><span class="line">    #logA..N</span><br><span class="line">    logtmp=[]</span><br><span class="line">    logtmp.append(commit.tree.id.hex)</span><br><span class="line">    logtmp.append(commit.message)</span><br><span class="line">    logtmp.append(datetime.datetime.utcfromtimestamp(commit.author.time))</span><br><span class="line">    logtmp.append(commit.author.name)</span><br><span class="line">    print(logtmp)</span><br><span class="line">    argslog.append(logtmp)</span><br><span class="line"></span><br><span class="line">add_log=<span class="string">"INSERT INTO gitlog.gitlog (nvalue,comments,date,Author) VALUES (%s,%s,%s,%s)"</span></span><br><span class="line">cursor.executemany(add_log, argslog)</span><br><span class="line">cursor.close()</span><br><span class="line">cnx.commit()</span><br><span class="line">cnx.close()</span><br></pre></td></tr></table></figure>

<p>更新数据涉及到一个增量更新git的log日志问题，pygit2中没有找到类似的api。所以考虑有时间作为新旧数据判断依据。<br>这里面的难点（对于小白的我来说），是如何比较时间。开始直接比较：<br>/#下面 datetimelog 是tuple类型的<br>dataNewtime= datetimelog<br>/#commit.author.time是long型自然是无法比较的，发现这个是使用了commit.author.time - dataNewtime，编译器提示发现类型不正确。</p>
<p>正确代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time,datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">as</span> config</span><br><span class="line"><span class="keyword">from</span> pygit2 <span class="keyword">import</span> Repository</span><br><span class="line"><span class="keyword">from</span> pygit2 <span class="keyword">import</span> GIT_SORT_NONE,GIT_SORT_TOPOLOGICAL, GIT_SORT_REVERSE,GIT_SORT_TIME</span><br><span class="line"><span class="keyword">import</span> mysql.connector</span><br><span class="line"></span><br><span class="line">cnx = mysql.connector.connect(user=<span class="string">'root'</span>,password=<span class="string">'????'</span>,host=<span class="string">'127.0.0.1'</span>,database=<span class="string">'gitlog'</span>)</span><br><span class="line">argslog=[]</span><br><span class="line">cursor = cnx.cursor()</span><br><span class="line">cursor.execute(<span class="string">"SELECT UNIX_TIMESTAMP(date) FROM gitlog.gitlog order by gitlog.date desc limit 1"</span>)</span><br><span class="line"><span class="keyword">for</span> (datetimelog) <span class="keyword">in</span> cursor:</span><br><span class="line">    #既然是数组，取数组第一个值</span><br><span class="line">    dataNewtime= datetimelog[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">repo = Repository(<span class="string">'/home/chaosbom/git/ArhasMK/.git'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> commit <span class="keyword">in</span> repo.walk(repo.head.target,GIT_SORT_TOPOLOGICAL | GIT_SORT_REVERSE):</span><br><span class="line">    #时间比数据库里的新则更新进去</span><br><span class="line">    <span class="keyword">if</span>(commit.author.time &gt; dataNewtime):</span><br><span class="line">        logtmp=[]</span><br><span class="line">        logtmp.append(commit.tree.id.hex)</span><br><span class="line">        logtmp.append(commit.message)</span><br><span class="line">        logtmp.append(datetime.datetime.utcfromtimestamp(commit.author.time))</span><br><span class="line">        logtmp.append(commit.author.name)</span><br><span class="line">        print(logtmp)</span><br><span class="line">        argslog.append(logtmp)</span><br><span class="line">        log=(commit.tree.id.hex,commit.message,datetime.datetime.utcfromtimestamp(commit.author.time).strftime(<span class="string">"%Y-%m-%d %H:%M:%S"</span>),commit.author.name)</span><br><span class="line">        add_log=<span class="string">"INSERT INTO gitlog.gitlog (nvalue,comments,date,Author) VALUES (%s,%s,%s,%s)"</span></span><br><span class="line">        cursor.executemany(add_log, argslog)</span><br><span class="line">cursor.close()</span><br><span class="line">cnx.commit()</span><br><span class="line">cnx.close()</span><br></pre></td></tr></table></figure>

<p>测试后，新增记录被更新到数据库，当然记录很简单，解决的时候百度了很多次。</p>
<h1 id="python调用shell"><a href="#python调用shell" class="headerlink" title="python调用shell"></a>python调用shell</h1><p>在百度中看了数篇关于python调用shell的入门文章。推荐使用Python subprocess模块。<br><a href="http://www.jb51.net/article/48086.htm" target="_blank" rel="noopener">Python subprocess模块学习总结</a></p>
<p>python调用shell命令易如反掌，现在需要考虑的是如何使python调用的脚本联动起来。</p>
<h1 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h1><h2 id="python在ubuntu下的编译器"><a href="#python在ubuntu下的编译器" class="headerlink" title="python在ubuntu下的编译器"></a>python在ubuntu下的编译器</h2><p>本次实验使用了：</p>
<h2 id="python连接mysql使用config"><a href="#python连接mysql使用config" class="headerlink" title="python连接mysql使用config"></a>python连接mysql使用config</h2><p>未解决，使用的时候类型不匹配错误。</p>
<h2 id="计划和实际"><a href="#计划和实际" class="headerlink" title="计划和实际"></a>计划和实际</h2><p>写这篇文章的时候是希望使用python来自动处理目前公司的发版流程，基于实际考虑，我编写的shell脚本已经足够应付发版工作，再深究下去并不是非常必要，目前发版的不足回头总结再弥补也来得及。那么问题来了，用python去实现的必要性？首先明确一点，我使用python的目的是学习和研究。其次，目前对于web系统的了解程度还不够深入，没有真正的学习过一个web框架。所以还是要做一个发布的系统出来。这个内容留到下一篇文章再继续了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="windanchaos"
    src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">windanchaos</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">96</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/windanchaos" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;windanchaos" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/windanchaos" title="Gitee &amp;rarr; https:&#x2F;&#x2F;gitee.com&#x2F;windanchaos" rel="noopener" target="_blank"><i class="fa fa-fw fa-gitee"></i>Gitee</a>
      </span>
      <span class="links-of-author-item">
        <a href="/mailto:454722630@qq.com" title="E-Mail &amp;rarr; mailto:454722630@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/windanchaos" title="Weibo &amp;rarr; https:&#x2F;&#x2F;weibo.com&#x2F;windanchaos" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/windanchaos" title="CSDN &amp;rarr; https:&#x2F;&#x2F;blog.csdn.net&#x2F;windanchaos" rel="noopener" target="_blank"><i class="fa fa-fw fa-CSDN"></i>CSDN</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">备案/许可证编号 </a>
      <img src="http://www.beian.gov.cn/portal/download" style="display: inline-block;"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=19036728" rel="noopener" target="_blank">蜀ICP备19036728号 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">windanchaos</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.5.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>






  <script>
  function leancloudSelector(url) {
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = visitors.getAttribute('id').trim();
      var title = visitors.getAttribute('data-flag-title').trim();

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.log('Failed to save visitor count', error);
              })
          } else {
              Counter('post', '/classes/Counter', { title: title, url: url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.log('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return element.getAttribute('id').trim();
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            leancloudSelector(url).innerText = time;
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=0indNw0niJU8jN2a1E43bDW7-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': '0indNw0niJU8jN2a1E43bDW7-gzGzoHsz',
            'X-LC-Key': 'toErPcjDI3431WvXQVKoy0rC',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        const localhost = /http:\/\/(localhost|127.0.0.1|0.0.0.0)/;
        if (localhost.test(document.URL)) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>






        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  
















  

  


<script>
NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: '0indNw0niJU8jN2a1E43bDW7-gzGzoHsz',
    appKey: 'toErPcjDI3431WvXQVKoy0rC',
    placeholder: "Just go go",
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: 'zh-cn' || 'zh-cn',
    path: location.pathname,
    recordIP: false,
    serverURLs: ''
  });
}, window.Valine);
</script>

</body>
</html>
